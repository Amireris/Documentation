<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en-US">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=11"/>
<meta name="generator" content="Doxygen 1.9.5"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>Topo: USTopoSearch_prod.py Source File</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr id="projectrow">
  <td id="projectlogo"><img alt="Logo" src="1656618600822.jpg"/></td>
  <td id="projectalign">
   <div id="projectname">Topo
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.9.5 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
var searchBox = new SearchBox("searchBox", "search/",'.html');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */
</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(document).ready(function(){initNavTree('_u_s_topo_search__prod_8py_source.html',''); initResizable(); });
/* @license-end */
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<div id="MSearchResults">
<div class="SRPage">
<div id="SRIndex">
<div id="SRResults"></div>
<div class="SRStatus" id="Loading">Loading...</div>
<div class="SRStatus" id="Searching">Searching...</div>
<div class="SRStatus" id="NoMatches">No Matches</div>
</div>
</div>
</div>
</div>

<div class="header">
  <div class="headertitle"><div class="title">USTopoSearch_prod.py</div></div>
</div><!--header-->
<div class="contents">
<a href="_u_s_topo_search__prod_8py.html">Go to the documentation of this file.</a><div class="fragment"><div class="line"><a id="l00001" name="l00001"></a><span class="lineno"><a class="line" href="namespace_u_s_topo_search__prod.html">    1</a></span><span class="comment">#-------------------------------------------------------------------------------</span></div>
<div class="line"><a id="l00002" name="l00002"></a><span class="lineno">    2</span><span class="comment"># Name:        USGS Topo retrieval</span></div>
<div class="line"><a id="l00003" name="l00003"></a><span class="lineno">    3</span><span class="comment"># Purpose:</span></div>
<div class="line"><a id="l00004" name="l00004"></a><span class="lineno">    4</span><span class="comment">#</span></div>
<div class="line"><a id="l00005" name="l00005"></a><span class="lineno">    5</span><span class="comment"># Author:      LiuJ</span></div>
<div class="line"><a id="l00006" name="l00006"></a><span class="lineno">    6</span><span class="comment">#</span></div>
<div class="line"><a id="l00007" name="l00007"></a><span class="lineno">    7</span><span class="comment"># Created:     14/10/2014</span></div>
<div class="line"><a id="l00008" name="l00008"></a><span class="lineno">    8</span><span class="comment"># Copyright:   (c) LiuJ 2014</span></div>
<div class="line"><a id="l00009" name="l00009"></a><span class="lineno">    9</span><span class="comment"># Licence:     &lt;your licence&gt;</span></div>
<div class="line"><a id="l00010" name="l00010"></a><span class="lineno">   10</span><span class="comment">#-------------------------------------------------------------------------------</span></div>
<div class="line"><a id="l00011" name="l00011"></a><span class="lineno">   11</span> </div>
<div class="line"><a id="l00012" name="l00012"></a><span class="lineno">   12</span><span class="comment"># changes 11/13/2016: change all maps to fixed scale 1:24000</span></div>
<div class="line"><a id="l00013" name="l00013"></a><span class="lineno">   13</span><span class="keyword">import</span> time,json</div>
<div class="line"><a id="l00014" name="l00014"></a><span class="lineno">   14</span><span class="keyword">import</span> arcpy, os, sys</div>
<div class="line"><a id="l00015" name="l00015"></a><span class="lineno">   15</span><span class="keyword">import</span> csv</div>
<div class="line"><a id="l00016" name="l00016"></a><span class="lineno">   16</span><span class="keyword">import</span> xml.etree.ElementTree <span class="keyword">as</span> ET</div>
<div class="line"><a id="l00017" name="l00017"></a><span class="lineno">   17</span><span class="keyword">import</span> operator</div>
<div class="line"><a id="l00018" name="l00018"></a><span class="lineno">   18</span><span class="keyword">import</span> shutil, zipfile</div>
<div class="line"><a id="l00019" name="l00019"></a><span class="lineno">   19</span><span class="keyword">import</span> logging</div>
<div class="line"><a id="l00020" name="l00020"></a><span class="lineno">   20</span><span class="keyword">import</span> traceback</div>
<div class="line"><a id="l00021" name="l00021"></a><span class="lineno">   21</span><span class="keyword">import</span> cx_Oracle, glob, urllib</div>
<div class="line"><a id="l00022" name="l00022"></a><span class="lineno">   22</span><span class="keyword">import</span> re</div>
<div class="line"><a id="l00023" name="l00023"></a><span class="lineno">   23</span><span class="keyword">import</span> ConfigParser</div>
<div class="line"><a id="l00024" name="l00024"></a><span class="lineno">   24</span> </div>
<div class="line"><a id="l00025" name="l00025"></a><span class="lineno">   25</span><span class="keyword">from</span> PyPDF2 <span class="keyword">import</span> PdfFileReader, PdfFileWriter</div>
<div class="line"><a id="l00026" name="l00026"></a><span class="lineno">   26</span><span class="keyword">from</span> PyPDF2.generic <span class="keyword">import</span> NameObject, createStringObject, ArrayObject, FloatObject</div>
<div class="line"><a id="l00027" name="l00027"></a><span class="lineno">   27</span><span class="keyword">from</span> reportlab.platypus <span class="keyword">import</span> SimpleDocTemplate, Paragraph, Spacer, Frame,Table</div>
<div class="line"><a id="l00028" name="l00028"></a><span class="lineno">   28</span><span class="keyword">from</span> reportlab.lib.styles <span class="keyword">import</span> getSampleStyleSheet,ParagraphStyle</div>
<div class="line"><a id="l00029" name="l00029"></a><span class="lineno">   29</span><span class="keyword">from</span> reportlab.lib.units <span class="keyword">import</span> inch</div>
<div class="line"><a id="l00030" name="l00030"></a><span class="lineno">   30</span><span class="keyword">from</span> reportlab.lib.pagesizes <span class="keyword">import</span> portrait, letter</div>
<div class="line"><a id="l00031" name="l00031"></a><span class="lineno">   31</span><span class="keyword">from</span> reportlab.pdfgen <span class="keyword">import</span> canvas</div>
<div class="line"><a id="l00032" name="l00032"></a><span class="lineno">   32</span><span class="keyword">from</span> time <span class="keyword">import</span> strftime</div>
<div class="line"><a id="l00033" name="l00033"></a><span class="lineno">   33</span> </div>
<div class="line"><a id="l00034" name="l00034"></a><span class="lineno">   34</span><span class="keywordflow">print</span> (<span class="stringliteral">&quot;#0 &quot;</span> + time.strftime(<span class="stringliteral">&#39;%Y-%m-%d %H:%M:%S&#39;</span>, time.localtime()))</div>
<div class="line"><a id="l00035" name="l00035"></a><span class="lineno"><a class="line" href="namespace_u_s_topo_search__prod.html#aad73e36e1dd8ba632d2d64b5b27c8a80">   35</a></span>arcpy.env.overwriteOutput = <span class="keyword">True</span></div>
<div class="line"><a id="l00036" name="l00036"></a><span class="lineno">   36</span> </div>
<div class="line"><a id="l00037" name="l00037"></a><span class="lineno"><a class="line" href="namespace_u_s_topo_search__prod.html#abf2fdbd132aebef3a75b8c5b2e7778c0">   37</a></span><span class="keyword">def </span><a class="code hl_function" href="namespace_u_s_topo_search__prod.html#abf2fdbd132aebef3a75b8c5b2e7778c0">server_loc_config</a>(configpath,environment):</div>
<div class="line"><a id="l00038" name="l00038"></a><span class="lineno">   38</span>    configParser = ConfigParser.RawConfigParser()</div>
<div class="line"><a id="l00039" name="l00039"></a><span class="lineno">   39</span>    configParser.read(configpath)</div>
<div class="line"><a id="l00040" name="l00040"></a><span class="lineno">   40</span>    <span class="keywordflow">if</span> environment == <span class="stringliteral">&#39;test&#39;</span>:</div>
<div class="line"><a id="l00041" name="l00041"></a><span class="lineno">   41</span>        reportcheck = configParser.get(<span class="stringliteral">&#39;server-config&#39;</span>,<span class="stringliteral">&#39;reportcheck_test&#39;</span>)</div>
<div class="line"><a id="l00042" name="l00042"></a><span class="lineno">   42</span>        reportviewer = configParser.get(<span class="stringliteral">&#39;server-config&#39;</span>,<span class="stringliteral">&#39;reportviewer_test&#39;</span>)</div>
<div class="line"><a id="l00043" name="l00043"></a><span class="lineno">   43</span>        reportinstant = configParser.get(<span class="stringliteral">&#39;server-config&#39;</span>,<span class="stringliteral">&#39;instant_test&#39;</span>)</div>
<div class="line"><a id="l00044" name="l00044"></a><span class="lineno">   44</span>        reportnoninstant = configParser.get(<span class="stringliteral">&#39;server-config&#39;</span>,<span class="stringliteral">&#39;noninstant_test&#39;</span>)</div>
<div class="line"><a id="l00045" name="l00045"></a><span class="lineno">   45</span>        upload_viewer = configParser.get(<span class="stringliteral">&#39;url-config&#39;</span>,<span class="stringliteral">&#39;uploadviewer&#39;</span>)</div>
<div class="line"><a id="l00046" name="l00046"></a><span class="lineno">   46</span>        server_config = {<span class="stringliteral">&#39;reportcheck&#39;</span>:reportcheck,<span class="stringliteral">&#39;viewer&#39;</span>:reportviewer,<span class="stringliteral">&#39;instant&#39;</span>:reportinstant,<span class="stringliteral">&#39;noninstant&#39;</span>:reportnoninstant,<span class="stringliteral">&#39;viewer_upload&#39;</span>:upload_viewer}</div>
<div class="line"><a id="l00047" name="l00047"></a><span class="lineno">   47</span>        <span class="keywordflow">return</span> server_config</div>
<div class="line"><a id="l00048" name="l00048"></a><span class="lineno">   48</span>    <span class="keywordflow">elif</span> environment == <span class="stringliteral">&#39;prod&#39;</span>:</div>
<div class="line"><a id="l00049" name="l00049"></a><span class="lineno">   49</span>        reportcheck = configParser.get(<span class="stringliteral">&#39;server-config&#39;</span>,<span class="stringliteral">&#39;reportcheck_prod&#39;</span>)</div>
<div class="line"><a id="l00050" name="l00050"></a><span class="lineno">   50</span>        reportviewer = configParser.get(<span class="stringliteral">&#39;server-config&#39;</span>,<span class="stringliteral">&#39;reportviewer_prod&#39;</span>)</div>
<div class="line"><a id="l00051" name="l00051"></a><span class="lineno">   51</span>        reportinstant = configParser.get(<span class="stringliteral">&#39;server-config&#39;</span>,<span class="stringliteral">&#39;instant_prod&#39;</span>)</div>
<div class="line"><a id="l00052" name="l00052"></a><span class="lineno">   52</span>        reportnoninstant = configParser.get(<span class="stringliteral">&#39;server-config&#39;</span>,<span class="stringliteral">&#39;noninstant_prod&#39;</span>)</div>
<div class="line"><a id="l00053" name="l00053"></a><span class="lineno">   53</span>        upload_viewer = configParser.get(<span class="stringliteral">&#39;url-config&#39;</span>,<span class="stringliteral">&#39;uploadviewer_prod&#39;</span>)</div>
<div class="line"><a id="l00054" name="l00054"></a><span class="lineno">   54</span>        server_config = {<span class="stringliteral">&#39;reportcheck&#39;</span>:reportcheck,<span class="stringliteral">&#39;viewer&#39;</span>:reportviewer,<span class="stringliteral">&#39;instant&#39;</span>:reportinstant,<span class="stringliteral">&#39;noninstant&#39;</span>:reportnoninstant,<span class="stringliteral">&#39;viewer_upload&#39;</span>:upload_viewer}</div>
<div class="line"><a id="l00055" name="l00055"></a><span class="lineno">   55</span>        <span class="keywordflow">return</span> server_config</div>
<div class="line"><a id="l00056" name="l00056"></a><span class="lineno">   56</span>    <span class="keywordflow">else</span>:</div>
<div class="line"><a id="l00057" name="l00057"></a><span class="lineno">   57</span>        <span class="keywordflow">return</span> <span class="stringliteral">&#39;invalid server configuration&#39;</span></div>
<div class="line"><a id="l00058" name="l00058"></a><span class="lineno">   58</span> </div>
<div class="line"><a id="l00059" name="l00059"></a><span class="lineno"><a class="line" href="namespace_u_s_topo_search__prod.html#a26dc023affb68a675d2fc047155d2331">   59</a></span><span class="keyword">def </span><a class="code hl_function" href="namespace_u_s_topo_search__prod.html#a26dc023affb68a675d2fc047155d2331">createAnnotPdf</a>(geom_type, myShapePdf):</div>
<div class="line"><a id="l00060" name="l00060"></a><span class="lineno">   60</span>    <span class="comment"># input variables</span></div>
<div class="line"><a id="l00061" name="l00061"></a><span class="lineno">   61</span>    <span class="comment"># geom_type = &#39;POLYLINE&#39;      # or POLYGON</span></div>
<div class="line"><a id="l00062" name="l00062"></a><span class="lineno">   62</span> </div>
<div class="line"><a id="l00063" name="l00063"></a><span class="lineno">   63</span>    <span class="comment"># part 1: read geometry pdf to get the vertices and rectangle to use</span></div>
<div class="line"><a id="l00064" name="l00064"></a><span class="lineno">   64</span>    source  = PdfFileReader(open(myShapePdf,<span class="stringliteral">&#39;rb&#39;</span>))</div>
<div class="line"><a id="l00065" name="l00065"></a><span class="lineno">   65</span>    geomPage = source.getPage(0)</div>
<div class="line"><a id="l00066" name="l00066"></a><span class="lineno">   66</span>    mystr = geomPage.getObject()[<span class="stringliteral">&#39;/Contents&#39;</span>].getData()</div>
<div class="line"><a id="l00067" name="l00067"></a><span class="lineno">   67</span>    <span class="comment"># to pinpoint the string part: 1.19997 791.75999 m 1.19997 0.19466 l 611.98627 0.19466 l 611.98627 791.75999 l 1.19997 791.75999 l</span></div>
<div class="line"><a id="l00068" name="l00068"></a><span class="lineno">   68</span>    <span class="comment"># the format seems to follow x1 y1 m x2 y2 l x3 y3 l x4 y4 l x5 y5 l</span></div>
<div class="line"><a id="l00069" name="l00069"></a><span class="lineno">   69</span>    geomString = mystr.split(<span class="stringliteral">&#39;S\r\n&#39;</span>)[0].split(<span class="stringliteral">&#39;M\r\n&#39;</span>)[1]</div>
<div class="line"><a id="l00070" name="l00070"></a><span class="lineno">   70</span>    coordsString = [value <span class="keywordflow">for</span> value <span class="keywordflow">in</span> geomString.split(<span class="stringliteral">&#39; &#39;</span>) <span class="keywordflow">if</span> value <span class="keywordflow">not</span> <span class="keywordflow">in</span> [<span class="stringliteral">&#39;m&#39;</span>,<span class="stringliteral">&#39;l&#39;</span>,<span class="stringliteral">&#39;&#39;</span>]]</div>
<div class="line"><a id="l00071" name="l00071"></a><span class="lineno">   71</span> </div>
<div class="line"><a id="l00072" name="l00072"></a><span class="lineno">   72</span>    <span class="comment"># part 2: update geometry in the map</span></div>
<div class="line"><a id="l00073" name="l00073"></a><span class="lineno">   73</span>    <span class="keywordflow">if</span> geom_type.upper() == <span class="stringliteral">&#39;POLYGON&#39;</span>:</div>
<div class="line"><a id="l00074" name="l00074"></a><span class="lineno">   74</span>        pdf_geom = PdfFileReader(open(annot_poly,<span class="stringliteral">&#39;rb&#39;</span>))</div>
<div class="line"><a id="l00075" name="l00075"></a><span class="lineno">   75</span>    <span class="keywordflow">elif</span> geom_type.upper() == <span class="stringliteral">&#39;POLYLINE&#39;</span>:</div>
<div class="line"><a id="l00076" name="l00076"></a><span class="lineno">   76</span>        pdf_geom = PdfFileReader(open(annot_line,<span class="stringliteral">&#39;rb&#39;</span>))</div>
<div class="line"><a id="l00077" name="l00077"></a><span class="lineno">   77</span>    page_geom = pdf_geom.getPage(0)</div>
<div class="line"><a id="l00078" name="l00078"></a><span class="lineno">   78</span> </div>
<div class="line"><a id="l00079" name="l00079"></a><span class="lineno">   79</span>    annot = page_geom[<span class="stringliteral">&#39;/Annots&#39;</span>][0]</div>
<div class="line"><a id="l00080" name="l00080"></a><span class="lineno">   80</span>    updateVertices = <span class="stringliteral">&quot;annot.getObject().update({NameObject(&#39;/Vertices&#39;):ArrayObject([FloatObject(&quot;</span>+coordsString[0]+<span class="stringliteral">&quot;)&quot;</span></div>
<div class="line"><a id="l00081" name="l00081"></a><span class="lineno">   81</span>    <span class="keywordflow">for</span> item <span class="keywordflow">in</span> coordsString[1:]:</div>
<div class="line"><a id="l00082" name="l00082"></a><span class="lineno">   82</span>        updateVertices = updateVertices + <span class="stringliteral">&#39;,FloatObject(&#39;</span>+item+<span class="stringliteral">&#39;)&#39;</span></div>
<div class="line"><a id="l00083" name="l00083"></a><span class="lineno">   83</span>    updateVertices = updateVertices + <span class="stringliteral">&quot;])})&quot;</span></div>
<div class="line"><a id="l00084" name="l00084"></a><span class="lineno">   84</span>    exec(updateVertices)</div>
<div class="line"><a id="l00085" name="l00085"></a><span class="lineno">   85</span> </div>
<div class="line"><a id="l00086" name="l00086"></a><span class="lineno">   86</span>    xcoords = []</div>
<div class="line"><a id="l00087" name="l00087"></a><span class="lineno">   87</span>    ycoords = []</div>
<div class="line"><a id="l00088" name="l00088"></a><span class="lineno">   88</span>    <span class="keywordflow">for</span> i <span class="keywordflow">in</span> range(0,len(coordsString)-1):</div>
<div class="line"><a id="l00089" name="l00089"></a><span class="lineno">   89</span>        <span class="keywordflow">if</span> i%2 == 0:</div>
<div class="line"><a id="l00090" name="l00090"></a><span class="lineno">   90</span>            xcoords.append(float(coordsString[i]))</div>
<div class="line"><a id="l00091" name="l00091"></a><span class="lineno">   91</span>        <span class="keywordflow">else</span>:</div>
<div class="line"><a id="l00092" name="l00092"></a><span class="lineno">   92</span>            ycoords.append(float(coordsString[i]))</div>
<div class="line"><a id="l00093" name="l00093"></a><span class="lineno">   93</span> </div>
<div class="line"><a id="l00094" name="l00094"></a><span class="lineno">   94</span>    <span class="comment"># below rect seems to be geom bounding box coordinates: xmin, ymin, xmax,ymax</span></div>
<div class="line"><a id="l00095" name="l00095"></a><span class="lineno">   95</span>    annot.getObject().update({NameObject(<span class="stringliteral">&#39;/Rect&#39;</span>):ArrayObject([FloatObject(min(xcoords)), FloatObject(min(ycoords)), FloatObject(max(xcoords)), FloatObject(max(ycoords))])})</div>
<div class="line"><a id="l00096" name="l00096"></a><span class="lineno">   96</span>    annot.getObject().pop(<span class="stringliteral">&#39;/AP&#39;</span>)  <span class="comment"># this is to get rid of the ghost shape</span></div>
<div class="line"><a id="l00097" name="l00097"></a><span class="lineno">   97</span> </div>
<div class="line"><a id="l00098" name="l00098"></a><span class="lineno">   98</span>    annot.getObject().update({NameObject(<span class="stringliteral">&#39;/T&#39;</span>):createStringObject(<span class="stringliteral">u&#39;ERIS&#39;</span>)})</div>
<div class="line"><a id="l00099" name="l00099"></a><span class="lineno">   99</span> </div>
<div class="line"><a id="l00100" name="l00100"></a><span class="lineno">  100</span>    output = PdfFileWriter()</div>
<div class="line"><a id="l00101" name="l00101"></a><span class="lineno">  101</span>    output.addPage(page_geom)</div>
<div class="line"><a id="l00102" name="l00102"></a><span class="lineno">  102</span>    annotPdf = os.path.join(scratch, <span class="stringliteral">&quot;annot.pdf&quot;</span>)</div>
<div class="line"><a id="l00103" name="l00103"></a><span class="lineno">  103</span>    outputStream = open(annotPdf,<span class="stringliteral">&quot;wb&quot;</span>)</div>
<div class="line"><a id="l00104" name="l00104"></a><span class="lineno">  104</span>    <span class="comment"># output.setPageMode(&#39;/UseOutlines&#39;)</span></div>
<div class="line"><a id="l00105" name="l00105"></a><span class="lineno">  105</span>    output.write(outputStream)</div>
<div class="line"><a id="l00106" name="l00106"></a><span class="lineno">  106</span>    outputStream.close()</div>
<div class="line"><a id="l00107" name="l00107"></a><span class="lineno">  107</span>    output = <span class="keywordtype">None</span></div>
<div class="line"><a id="l00108" name="l00108"></a><span class="lineno">  108</span>    <span class="keywordflow">return</span> annotPdf</div>
<div class="line"><a id="l00109" name="l00109"></a><span class="lineno">  109</span> </div>
<div class="line"><a id="l00110" name="l00110"></a><span class="lineno"><a class="line" href="namespace_u_s_topo_search__prod.html#af5daa83a32a5322129ee46ab6d259df5">  110</a></span><span class="keyword">def </span><a class="code hl_function" href="namespace_u_s_topo_search__prod.html#af5daa83a32a5322129ee46ab6d259df5">annotatePdf</a>(mapPdf, myAnnotPdf):</div>
<div class="line"><a id="l00111" name="l00111"></a><span class="lineno">  111</span>    pdf_intermediate = PdfFileReader(open(mapPdf,<span class="stringliteral">&#39;rb&#39;</span>))</div>
<div class="line"><a id="l00112" name="l00112"></a><span class="lineno">  112</span>    page= pdf_intermediate.getPage(0)</div>
<div class="line"><a id="l00113" name="l00113"></a><span class="lineno">  113</span> </div>
<div class="line"><a id="l00114" name="l00114"></a><span class="lineno">  114</span>    pdf = PdfFileReader(open(myAnnotPdf,<span class="stringliteral">&#39;rb&#39;</span>))</div>
<div class="line"><a id="l00115" name="l00115"></a><span class="lineno">  115</span>    FIMpage = pdf.getPage(0)</div>
<div class="line"><a id="l00116" name="l00116"></a><span class="lineno">  116</span>    page.mergePage(FIMpage)</div>
<div class="line"><a id="l00117" name="l00117"></a><span class="lineno">  117</span> </div>
<div class="line"><a id="l00118" name="l00118"></a><span class="lineno">  118</span>    output = PdfFileWriter()</div>
<div class="line"><a id="l00119" name="l00119"></a><span class="lineno">  119</span>    output.addPage(page)</div>
<div class="line"><a id="l00120" name="l00120"></a><span class="lineno">  120</span> </div>
<div class="line"><a id="l00121" name="l00121"></a><span class="lineno">  121</span>    annotatedPdf = mapPdf[:-4]+<span class="stringliteral">&#39;_a.pdf&#39;</span></div>
<div class="line"><a id="l00122" name="l00122"></a><span class="lineno">  122</span>    outputStream = open(annotatedPdf,<span class="stringliteral">&quot;wb&quot;</span>)</div>
<div class="line"><a id="l00123" name="l00123"></a><span class="lineno">  123</span>    <span class="comment"># output.setPageMode(&#39;/UseOutlines&#39;)</span></div>
<div class="line"><a id="l00124" name="l00124"></a><span class="lineno">  124</span>    output.write(outputStream)</div>
<div class="line"><a id="l00125" name="l00125"></a><span class="lineno">  125</span>    outputStream.close()</div>
<div class="line"><a id="l00126" name="l00126"></a><span class="lineno">  126</span>    output = <span class="keywordtype">None</span></div>
<div class="line"><a id="l00127" name="l00127"></a><span class="lineno">  127</span>    <span class="keywordflow">return</span> annotatedPdf</div>
<div class="line"><a id="l00128" name="l00128"></a><span class="lineno">  128</span> </div>
<div class="line"><a id="l00129" name="l00129"></a><span class="lineno"><a class="line" href="namespace_u_s_topo_search__prod.html#a7c2621556ca96c02e4312e2987ec1baa">  129</a></span><span class="keyword">def </span><a class="code hl_function" href="namespace_u_s_topo_search__prod.html#a7c2621556ca96c02e4312e2987ec1baa">myFirstPage</a>(canvas, doc):</div>
<div class="line"><a id="l00130" name="l00130"></a><span class="lineno">  130</span>    canvas.saveState()</div>
<div class="line"><a id="l00131" name="l00131"></a><span class="lineno">  131</span>    canvas.drawImage(<span class="stringliteral">r&quot;\\cabcvan1gis006\GISData\Topo_USA\python\mxd\ERIS_2018_ReportCover_Second Page_F.jpg&quot;</span>,0,0, int(PAGE_WIDTH),int(PAGE_HEIGHT))</div>
<div class="line"><a id="l00132" name="l00132"></a><span class="lineno">  132</span>    canvas.setStrokeColorRGB(0.67,0.8,0.4)</div>
<div class="line"><a id="l00133" name="l00133"></a><span class="lineno">  133</span>    canvas.line(50,100,int(PAGE_WIDTH-30),100)</div>
<div class="line"><a id="l00134" name="l00134"></a><span class="lineno">  134</span>    Footer = []</div>
<div class="line"><a id="l00135" name="l00135"></a><span class="lineno">  135</span>    style = styles[<span class="stringliteral">&quot;Normal&quot;</span>]</div>
<div class="line"><a id="l00136" name="l00136"></a><span class="lineno">  136</span>    Disclaimer = []</div>
<div class="line"><a id="l00137" name="l00137"></a><span class="lineno">  137</span>    <span class="comment"># style = styles[&quot;Italic&quot;]</span></div>
<div class="line"><a id="l00138" name="l00138"></a><span class="lineno">  138</span>    <span class="comment"># p1 = Paragraph(&#39;&lt;para alignment=&quot;justify&quot;&gt;&lt;font name=Helvetica size = 8&gt;Topographic Maps included in this report are produced by the USGS and are to be used for research purposes including a phase I report.  Maps are not to be resold as commercial property.&lt;/font&gt;&lt;/para&gt;&#39;, style)</span></div>
<div class="line"><a id="l00139" name="l00139"></a><span class="lineno">  139</span>    <span class="comment"># Disclaimer.append(p1)</span></div>
<div class="line"><a id="l00140" name="l00140"></a><span class="lineno">  140</span>    <span class="comment"># #p2 = Paragraph(&#39;&lt;para alignment=&quot;justify&quot;&gt;&lt;font name=Helvetica-Bold size=8&gt;No warranty of Accuracy or Liability for ERIS: &lt;/font&gt;&lt;font name=Helvetica size=8&gt;The information contained in this report has been produced by EcoLog Environmental Risk Information Services Ltd (&quot;ERIS&quot;) using Topographic Maps produced by the USGS. This maps contained herein does not purport to be and does not constitute a guarantee of the accuracy of the information contained herein. Although ERIS has endeavored to present you with information that is accurate, EcoLog ERIS disclaims, any and all liability for any errors, omissions, or inaccuracies in such information and data, whether attributable to inadvertence, negligence or otherwise, and for any consequences arising therefrom. Liability on the part of EcoLog ERIS is limited to the monetary value paid for this report.&lt;/font&gt;&lt;/para&gt;&#39;,style)</span></div>
<div class="line"><a id="l00141" name="l00141"></a><span class="lineno">  141</span>    <span class="comment"># p2 = Paragraph(&quot;&lt;para alignment=&#39;justify&#39;&gt;&lt;font name=Helvetica-Bold size=8&gt;No warranty of Accuracy or Liability for ERIS: &lt;/font&gt;&lt;font name=Helvetica size=8&gt;The information contained in this report has been produced by ERIS Information Inc. (in the US) and ERIS Information Limited Partnership (in Canada), both doing business as &#39;ERIS&#39;, using Topographic Maps produced by the USGS. This maps contained herein does not purport to be and does not constitute a guarantee of the accuracy of the information contained herein. Although ERIS has endeavored to present you with information that is accurate, ERIS disclaims, any and all liability for any errors, omissions, or inaccuracies in such information and data, whether attributable to inadvertence, negligence or otherwise, and for any consequences arising therefrom. Liability on the part of ERIS is limited to the monetary value paid for this report.&lt;/font&gt;&lt;/para&gt;&quot;,style)</span></div>
<div class="line"><a id="l00142" name="l00142"></a><span class="lineno">  142</span>    <span class="comment"># Disclaimer.append(p2)</span></div>
<div class="line"><a id="l00143" name="l00143"></a><span class="lineno">  143</span>    <span class="comment"># Frame(65,70,int(PAGE_WIDTH-130),155).addFromList(Disclaimer,canvas)</span></div>
<div class="line"><a id="l00144" name="l00144"></a><span class="lineno">  144</span>    canvas.setFont(<span class="stringliteral">&#39;Helvetica&#39;</span>, 8)</div>
<div class="line"><a id="l00145" name="l00145"></a><span class="lineno">  145</span>    canvas.drawString(54, 180, <span class="stringliteral">&quot;Topographic Maps included in this report are produced by the USGS and are to be used for research purposes including a phase I report.&quot;</span>)</div>
<div class="line"><a id="l00146" name="l00146"></a><span class="lineno">  146</span>    canvas.drawString(54, 170,<span class="stringliteral">&quot;Maps are not to be resold as commercial property.&quot;</span>)</div>
<div class="line"><a id="l00147" name="l00147"></a><span class="lineno">  147</span>    canvas.drawString(54, 160,<span class="stringliteral">&quot;No warranty of Accuracy or Liability for ERIS: The information contained in this report has been produced by ERIS Information Inc.(in the US)&quot;</span>)</div>
<div class="line"><a id="l00148" name="l00148"></a><span class="lineno">  148</span>    canvas.drawString(54, 150,<span class="stringliteral">&quot;and ERIS Information Limited Partnership (in Canada), both doing business as &#39;ERIS&#39;, using Topographic Maps produced by the USGS.&quot;</span>)</div>
<div class="line"><a id="l00149" name="l00149"></a><span class="lineno">  149</span>    canvas.drawString(54, 140,<span class="stringliteral">&quot;This maps contained herein does not purport to be and does not constitute a guarantee of the accuracy of the information contained herein.&quot;</span>)</div>
<div class="line"><a id="l00150" name="l00150"></a><span class="lineno">  150</span>    canvas.drawString(54,130,<span class="stringliteral">&quot;Although ERIS has endeavored to present you with information that is accurate, ERIS disclaims, any and all liability for any errors, omissions, &quot;</span>)</div>
<div class="line"><a id="l00151" name="l00151"></a><span class="lineno">  151</span>    canvas.drawString(54,120,<span class="stringliteral">&quot;or inaccuracies in such information and data, whether attributable to inadvertence, negligence or otherwise, and for any consequences&quot;</span>)</div>
<div class="line"><a id="l00152" name="l00152"></a><span class="lineno">  152</span>    canvas.drawString(54,110,<span class="stringliteral">&quot;arising therefrom. Liability on the part of ERIS is limited to the monetary value paid for this report.&quot;</span>)</div>
<div class="line"><a id="l00153" name="l00153"></a><span class="lineno">  153</span>    canvas.restoreState()</div>
<div class="line"><a id="l00154" name="l00154"></a><span class="lineno">  154</span>    p=<span class="keywordtype">None</span></div>
<div class="line"><a id="l00155" name="l00155"></a><span class="lineno">  155</span>    Footer = <span class="keywordtype">None</span></div>
<div class="line"><a id="l00156" name="l00156"></a><span class="lineno">  156</span>    Disclaimer = <span class="keywordtype">None</span></div>
<div class="line"><a id="l00157" name="l00157"></a><span class="lineno">  157</span>    style = <span class="keywordtype">None</span></div>
<div class="line"><a id="l00158" name="l00158"></a><span class="lineno">  158</span>    del canvas</div>
<div class="line"><a id="l00159" name="l00159"></a><span class="lineno">  159</span> </div>
<div class="line"><a id="l00160" name="l00160"></a><span class="lineno"><a class="line" href="namespace_u_s_topo_search__prod.html#ad3a195c7e937aa78014835dfe8448284">  160</a></span><span class="keyword">def </span><a class="code hl_function" href="namespace_u_s_topo_search__prod.html#ad3a195c7e937aa78014835dfe8448284">goSummaryPage</a>(summaryPdf, data):</div>
<div class="line"><a id="l00161" name="l00161"></a><span class="lineno">  161</span>    logger.debug(<span class="stringliteral">&quot;Coming into go(summaryPDF)&quot;</span>)</div>
<div class="line"><a id="l00162" name="l00162"></a><span class="lineno">  162</span>    doc = SimpleDocTemplate(summaryPdf, pagesize = letter)</div>
<div class="line"><a id="l00163" name="l00163"></a><span class="lineno">  163</span>    <span class="comment"># doc.pagesize = portrait(letter)</span></div>
<div class="line"><a id="l00164" name="l00164"></a><span class="lineno">  164</span> </div>
<div class="line"><a id="l00165" name="l00165"></a><span class="lineno">  165</span>    logger.debug(<span class="stringliteral">&quot;#1&quot;</span>)</div>
<div class="line"><a id="l00166" name="l00166"></a><span class="lineno">  166</span>    Story = [Spacer(1,0.5*inch)]</div>
<div class="line"><a id="l00167" name="l00167"></a><span class="lineno">  167</span>    logger.debug(<span class="stringliteral">&quot;#2&quot;</span>)</div>
<div class="line"><a id="l00168" name="l00168"></a><span class="lineno">  168</span>    style = styles[<span class="stringliteral">&quot;Normal&quot;</span>]</div>
<div class="line"><a id="l00169" name="l00169"></a><span class="lineno">  169</span>    logger.debug(<span class="stringliteral">&quot;#2-1&quot;</span>)</div>
<div class="line"><a id="l00170" name="l00170"></a><span class="lineno">  170</span> </div>
<div class="line"><a id="l00171" name="l00171"></a><span class="lineno">  171</span>    p = <span class="keywordtype">None</span></div>
<div class="line"><a id="l00172" name="l00172"></a><span class="lineno">  172</span>    <span class="keywordflow">try</span>:</div>
<div class="line"><a id="l00173" name="l00173"></a><span class="lineno">  173</span>        p = Paragraph(<span class="stringliteral">&#39;&lt;para alignment=&quot;justify&quot;&gt;&lt;font name=Helvetica size = 11&gt;We have searched USGS collections of current topographic maps and historical topographic maps for the project property. Below is a list of maps found for the project property and adjacent area. Maps are from 7.5 and 15 minute topographic map series, if available.&lt;/font&gt;&lt;/para&gt;&#39;</span>,style)</div>
<div class="line"><a id="l00174" name="l00174"></a><span class="lineno">  174</span>    <span class="keywordflow">except</span> Exception <span class="keyword">as</span> e:</div>
<div class="line"><a id="l00175" name="l00175"></a><span class="lineno">  175</span>        logger.error(e)</div>
<div class="line"><a id="l00176" name="l00176"></a><span class="lineno">  176</span>        logger.error(style)</div>
<div class="line"><a id="l00177" name="l00177"></a><span class="lineno">  177</span>        logger.error(p)</div>
<div class="line"><a id="l00178" name="l00178"></a><span class="lineno">  178</span>    logger.debug(<span class="stringliteral">&quot;#3&quot;</span>)</div>
<div class="line"><a id="l00179" name="l00179"></a><span class="lineno">  179</span> </div>
<div class="line"><a id="l00180" name="l00180"></a><span class="lineno">  180</span>    Story.append(p)</div>
<div class="line"><a id="l00181" name="l00181"></a><span class="lineno">  181</span>    Story.append(Spacer(1,0.28*inch))</div>
<div class="line"><a id="l00182" name="l00182"></a><span class="lineno">  182</span> </div>
<div class="line"><a id="l00183" name="l00183"></a><span class="lineno">  183</span>    logger.debug(<span class="stringliteral">&quot;#####len of data is &quot;</span> + str(len(data)))</div>
<div class="line"><a id="l00184" name="l00184"></a><span class="lineno">  184</span>    <span class="keywordflow">if</span> len(data) &lt; 31:</div>
<div class="line"><a id="l00185" name="l00185"></a><span class="lineno">  185</span>        data.insert(0,[<span class="stringliteral">&quot;  &quot;</span>])</div>
<div class="line"><a id="l00186" name="l00186"></a><span class="lineno">  186</span>        data.insert(0,[<span class="stringliteral">&#39;Year&#39;</span>,<span class="stringliteral">&#39;Map Series&#39;</span>])</div>
<div class="line"><a id="l00187" name="l00187"></a><span class="lineno">  187</span>        table = Table(data, colWidths = 35,rowHeights=14)</div>
<div class="line"><a id="l00188" name="l00188"></a><span class="lineno">  188</span>        table.setStyle([(<span class="stringliteral">&#39;FONT&#39;</span>,(0,0),(1,0),<span class="stringliteral">&#39;Helvetica-Bold&#39;</span>),</div>
<div class="line"><a id="l00189" name="l00189"></a><span class="lineno">  189</span>                 (<span class="stringliteral">&#39;ALIGN&#39;</span>,(0,1),(-1,-1),<span class="stringliteral">&#39;CENTER&#39;</span>),</div>
<div class="line"><a id="l00190" name="l00190"></a><span class="lineno">  190</span>                 (<span class="stringliteral">&#39;ALIGN&#39;</span>,(0,0),(1,0),<span class="stringliteral">&#39;LEFT&#39;</span>),])   <span class="comment">#note the last comma</span></div>
<div class="line"><a id="l00191" name="l00191"></a><span class="lineno">  191</span>        Story.append(table)</div>
<div class="line"><a id="l00192" name="l00192"></a><span class="lineno">  192</span>    <span class="keywordflow">elif</span> len(data) &gt; 30 <span class="keywordflow">and</span> len(data) &lt; 61: <span class="comment">#break into 2 columns</span></div>
<div class="line"><a id="l00193" name="l00193"></a><span class="lineno">  193</span>        logger.debug(<span class="stringliteral">&quot;####len(data) &gt; 30 and len(data) &lt; 61&quot;</span>)</div>
<div class="line"><a id="l00194" name="l00194"></a><span class="lineno">  194</span>        newdata = []</div>
<div class="line"><a id="l00195" name="l00195"></a><span class="lineno">  195</span>        newdata.append([<span class="stringliteral">&#39;Year&#39;</span>,<span class="stringliteral">&#39;Map Series&#39;</span>,<span class="stringliteral">&#39;   &#39;</span>,<span class="stringliteral">&#39;Year&#39;</span>,<span class="stringliteral">&#39;Map Series&#39;</span>])</div>
<div class="line"><a id="l00196" name="l00196"></a><span class="lineno">  196</span>        newdata.append([<span class="stringliteral">&#39; &#39;</span>,<span class="stringliteral">&#39;   &#39;</span>,<span class="stringliteral">&#39; &#39;</span>])</div>
<div class="line"><a id="l00197" name="l00197"></a><span class="lineno">  197</span>        i = 0</div>
<div class="line"><a id="l00198" name="l00198"></a><span class="lineno">  198</span>        <span class="keywordflow">while</span> i &lt; 30:</div>
<div class="line"><a id="l00199" name="l00199"></a><span class="lineno">  199</span>            row= data[i]</div>
<div class="line"><a id="l00200" name="l00200"></a><span class="lineno">  200</span>            row.append(<span class="stringliteral">&#39;    &#39;</span>)</div>
<div class="line"><a id="l00201" name="l00201"></a><span class="lineno">  201</span>            <span class="keywordflow">if</span> (i+30) &lt; len(data):</div>
<div class="line"><a id="l00202" name="l00202"></a><span class="lineno">  202</span>                row.extend(data[i+30])</div>
<div class="line"><a id="l00203" name="l00203"></a><span class="lineno">  203</span>            <span class="keywordflow">else</span>:</div>
<div class="line"><a id="l00204" name="l00204"></a><span class="lineno">  204</span>                row.extend([<span class="stringliteral">&#39;    &#39;</span>,<span class="stringliteral">&#39;  &#39;</span>])</div>
<div class="line"><a id="l00205" name="l00205"></a><span class="lineno">  205</span>            newdata.append(row)</div>
<div class="line"><a id="l00206" name="l00206"></a><span class="lineno">  206</span>            i = i + 1</div>
<div class="line"><a id="l00207" name="l00207"></a><span class="lineno">  207</span>        table = Table(newdata, colWidths = 35,rowHeights=12)</div>
<div class="line"><a id="l00208" name="l00208"></a><span class="lineno">  208</span>        table.setStyle([(<span class="stringliteral">&#39;ALIGN&#39;</span>,(0,0),(4,0),<span class="stringliteral">&#39;LEFT&#39;</span>),</div>
<div class="line"><a id="l00209" name="l00209"></a><span class="lineno">  209</span>                 (<span class="stringliteral">&#39;FONT&#39;</span>,(0,0),(4,0),<span class="stringliteral">&#39;Helvetica-Bold&#39;</span>),</div>
<div class="line"><a id="l00210" name="l00210"></a><span class="lineno">  210</span>                 (<span class="stringliteral">&#39;ALIGN&#39;</span>,(0,1),(-1,-1),<span class="stringliteral">&#39;CENTER&#39;</span>),])</div>
<div class="line"><a id="l00211" name="l00211"></a><span class="lineno">  211</span>        Story.append(table)</div>
<div class="line"><a id="l00212" name="l00212"></a><span class="lineno">  212</span>    <span class="keywordflow">elif</span> len(data) &gt; 60 <span class="keywordflow">and</span> len(data) &lt; 91:   <span class="comment">#break into 3 columns</span></div>
<div class="line"><a id="l00213" name="l00213"></a><span class="lineno">  213</span>        logger.debug(<span class="stringliteral">&quot;####len(data) &gt; 90&quot;</span>)</div>
<div class="line"><a id="l00214" name="l00214"></a><span class="lineno">  214</span>        newdata = []</div>
<div class="line"><a id="l00215" name="l00215"></a><span class="lineno">  215</span>        newdata.append([<span class="stringliteral">&#39;Year&#39;</span>,<span class="stringliteral">&#39;Map Series&#39;</span>,<span class="stringliteral">&#39;   &#39;</span>,<span class="stringliteral">&#39;Year&#39;</span>,<span class="stringliteral">&#39;Map Series&#39;</span>,<span class="stringliteral">&#39;   &#39;</span>,<span class="stringliteral">&#39;Year&#39;</span>,<span class="stringliteral">&#39;Map Series&#39;</span>])</div>
<div class="line"><a id="l00216" name="l00216"></a><span class="lineno">  216</span>        newdata.append([<span class="stringliteral">&#39; &#39;</span>,<span class="stringliteral">&#39; &#39;</span>,<span class="stringliteral">&#39;   &#39;</span>,<span class="stringliteral">&#39; &#39;</span>,<span class="stringliteral">&#39; &#39;</span>,<span class="stringliteral">&#39;   &#39;</span>,<span class="stringliteral">&#39; &#39;</span>,<span class="stringliteral">&#39; &#39;</span>])</div>
<div class="line"><a id="l00217" name="l00217"></a><span class="lineno">  217</span>        i = 0</div>
<div class="line"><a id="l00218" name="l00218"></a><span class="lineno">  218</span>        <span class="keywordflow">while</span> i &lt; 30:</div>
<div class="line"><a id="l00219" name="l00219"></a><span class="lineno">  219</span>            row= data[i]</div>
<div class="line"><a id="l00220" name="l00220"></a><span class="lineno">  220</span>            row.append(<span class="stringliteral">&#39;    &#39;</span>)</div>
<div class="line"><a id="l00221" name="l00221"></a><span class="lineno">  221</span>            row.extend(data[i+30])</div>
<div class="line"><a id="l00222" name="l00222"></a><span class="lineno">  222</span>            row.append(<span class="stringliteral">&#39;    &#39;</span>)</div>
<div class="line"><a id="l00223" name="l00223"></a><span class="lineno">  223</span>            if(i+60) &lt; len(data):</div>
<div class="line"><a id="l00224" name="l00224"></a><span class="lineno">  224</span>                row.extend(data[i+60])</div>
<div class="line"><a id="l00225" name="l00225"></a><span class="lineno">  225</span>            <span class="keywordflow">else</span>:</div>
<div class="line"><a id="l00226" name="l00226"></a><span class="lineno">  226</span>                row.append(<span class="stringliteral">&#39;    &#39;</span>)</div>
<div class="line"><a id="l00227" name="l00227"></a><span class="lineno">  227</span>                row.append(<span class="stringliteral">&#39;  &#39;</span>)</div>
<div class="line"><a id="l00228" name="l00228"></a><span class="lineno">  228</span> </div>
<div class="line"><a id="l00229" name="l00229"></a><span class="lineno">  229</span>            newdata.append(row)</div>
<div class="line"><a id="l00230" name="l00230"></a><span class="lineno">  230</span>            i = i + 1</div>
<div class="line"><a id="l00231" name="l00231"></a><span class="lineno">  231</span>        table = Table(newdata, colWidths = 35,rowHeights=12)</div>
<div class="line"><a id="l00232" name="l00232"></a><span class="lineno">  232</span>        table.setStyle([(<span class="stringliteral">&#39;FONT&#39;</span>,(0,0),(7,0),<span class="stringliteral">&#39;Helvetica-Bold&#39;</span>),</div>
<div class="line"><a id="l00233" name="l00233"></a><span class="lineno">  233</span>                 (<span class="stringliteral">&#39;ALIGN&#39;</span>,(0,1),(-1,-1),<span class="stringliteral">&#39;CENTER&#39;</span>),</div>
<div class="line"><a id="l00234" name="l00234"></a><span class="lineno">  234</span>                 (<span class="stringliteral">&#39;ALIGN&#39;</span>,(0,0),(7,0),<span class="stringliteral">&#39;LEFT&#39;</span>),])</div>
<div class="line"><a id="l00235" name="l00235"></a><span class="lineno">  235</span>        Story.append(table)</div>
<div class="line"><a id="l00236" name="l00236"></a><span class="lineno">  236</span> </div>
<div class="line"><a id="l00237" name="l00237"></a><span class="lineno">  237</span>    doc.build(Story, onFirstPage=myFirstPage, onLaterPages=myFirstPage)</div>
<div class="line"><a id="l00238" name="l00238"></a><span class="lineno">  238</span>    doc = <span class="keywordtype">None</span></div>
<div class="line"><a id="l00239" name="l00239"></a><span class="lineno">  239</span> </div>
<div class="line"><a id="l00240" name="l00240"></a><span class="lineno"><a class="line" href="namespace_u_s_topo_search__prod.html#abc9326c792708acd12779af820381b41">  240</a></span><span class="keyword">def </span><a class="code hl_function" href="namespace_u_s_topo_search__prod.html#abc9326c792708acd12779af820381b41">myCoverPage</a>(canvas, doc):</div>
<div class="line"><a id="l00241" name="l00241"></a><span class="lineno">  241</span>    <span class="comment"># canvas.saveState()</span></div>
<div class="line"><a id="l00242" name="l00242"></a><span class="lineno">  242</span>    canvas.drawImage(coverPic,0,0, PAGE_WIDTH,PAGE_HEIGHT)</div>
<div class="line"><a id="l00243" name="l00243"></a><span class="lineno">  243</span>    <span class="comment"># elements = []</span></div>
<div class="line"><a id="l00244" name="l00244"></a><span class="lineno">  244</span>    <span class="comment"># style = ParagraphStyle(&quot;cover&quot;,parent=styles[&#39;Normal&#39;],fontName=&quot;Helvetica&quot;,fontSize=13,leading=11)</span></div>
<div class="line"><a id="l00245" name="l00245"></a><span class="lineno">  245</span>    <span class="comment"># if len(coverInfotext[&quot;ADDRESS&quot;].split(&quot;\n&quot;)[0]) &gt;65:</span></div>
<div class="line"><a id="l00246" name="l00246"></a><span class="lineno">  246</span>    <span class="comment">#     style1 = ParagraphStyle(&quot;cover&quot;,parent=styles[&#39;Normal&#39;],fontName=&quot;Helvetica&quot;,fontSize=13,leading=17)</span></div>
<div class="line"><a id="l00247" name="l00247"></a><span class="lineno">  247</span>    <span class="comment">#     print len(coverInfotext[&quot;ADDRESS&quot;].split(&quot;\n&quot;)[0])</span></div>
<div class="line"><a id="l00248" name="l00248"></a><span class="lineno">  248</span>    <span class="comment"># else:</span></div>
<div class="line"><a id="l00249" name="l00249"></a><span class="lineno">  249</span>    <span class="comment">#     style1=style</span></div>
<div class="line"><a id="l00250" name="l00250"></a><span class="lineno">  250</span>    <span class="comment"># data =[[Paragraph(&#39;&lt;para alignment=&quot;left&quot;&gt;&lt;strong&gt; Project Property:&lt;/strong&gt;&lt;/para&gt;&#39;,style),Paragraph((&#39;&lt;para alignment=&quot;left&quot;&gt;&lt;i&gt;%s&lt;/i&gt;&lt;/para&gt;&#39;)%(coverInfotext[&quot;SITE_NAME&quot;]), style)],</span></div>
<div class="line"><a id="l00251" name="l00251"></a><span class="lineno">  251</span>    <span class="comment"># [&quot; &quot;,Paragraph((&#39;&lt;para alignment=&quot;left&quot;&gt;&lt;i&gt;%s&lt;/i&gt;&lt;/para&gt;&#39;)%(coverInfotext[&quot;ADDRESS&quot;].split(&quot;\n&quot;)[0]), style1)],</span></div>
<div class="line"><a id="l00252" name="l00252"></a><span class="lineno">  252</span>    <span class="comment"># [&quot; &quot;,Paragraph((&#39;&lt;para alignment=&quot;left&quot;&gt;&lt;i&gt;%s&lt;/i&gt;&lt;/para&gt;&#39;)%(coverInfotext[&quot;ADDRESS&quot;].split(&quot;\n&quot;)[1]), style1)],</span></div>
<div class="line"><a id="l00253" name="l00253"></a><span class="lineno">  253</span>    <span class="comment"># [Paragraph((&#39;&lt;para alignment=&quot;left&quot;&gt;&lt;strong&gt; Project No:&lt;/strong&gt;&lt;/para&gt;&#39;), style), Paragraph((&#39;&lt;para alignment=&quot;left&quot;&gt;&lt;i&gt;%s&lt;/i&gt;&lt;/para&gt;&#39;)%(coverInfotext[&quot;PROJECT_NUM&quot;]), style)],</span></div>
<div class="line"><a id="l00254" name="l00254"></a><span class="lineno">  254</span>    <span class="comment"># [Paragraph((&#39;&lt;para alignment=&quot;left&quot;&gt;&lt;strong&gt; Requested By:&lt;/strong&gt;&lt;/para&gt;&#39;), style),Paragraph((&#39;&lt;para alignment=&quot;left&quot;&gt;&lt;i&gt;%s&lt;/i&gt;&lt;/para&gt;&#39;)%(coverInfotext[&quot;COMPANY_NAME&quot;]), style)],</span></div>
<div class="line"><a id="l00255" name="l00255"></a><span class="lineno">  255</span>    <span class="comment"># [Paragraph((&#39;&lt;para alignment=&quot;left&quot;&gt;&lt;strong&gt; Order No:&lt;/strong&gt;&lt;/para&gt;&#39;), style),Paragraph((&#39;&lt;para alignment=&quot;left&quot;&gt;&lt;i&gt;%s&lt;/i&gt;&lt;/para&gt;&#39;)%(coverInfotext[&quot;ORDER_NUM&quot;]), style)],</span></div>
<div class="line"><a id="l00256" name="l00256"></a><span class="lineno">  256</span>    <span class="comment"># [Paragraph((&#39;&lt;para alignment=&quot;left&quot;&gt;&lt;strong&gt; Date Completed:&lt;/strong&gt;&lt;/para&gt;&#39;), style),Paragraph((&#39;&lt;para alignment=&quot;left&quot;&gt;&lt;i&gt;%s&lt;/i&gt;&lt;/para&gt;&#39;)%(time.strftime(&#39;%B %d, %Y&#39;, time.localtime())), style)]]</span></div>
<div class="line"><a id="l00257" name="l00257"></a><span class="lineno">  257</span> </div>
<div class="line"><a id="l00258" name="l00258"></a><span class="lineno">  258</span>    <span class="comment"># t=Table(data,colWidths = [160, int(PAGE_WIDTH-200)])</span></div>
<div class="line"><a id="l00259" name="l00259"></a><span class="lineno">  259</span>    <span class="comment"># t.wrapOn(canvas,int(PAGE_WIDTH-100),int(PAGE_HEIGHT))</span></div>
<div class="line"><a id="l00260" name="l00260"></a><span class="lineno">  260</span>    <span class="comment"># t.drawOn(canvas,50,270)</span></div>
<div class="line"><a id="l00261" name="l00261"></a><span class="lineno">  261</span>    leftsw= 54</div>
<div class="line"><a id="l00262" name="l00262"></a><span class="lineno">  262</span>    heights = 400</div>
<div class="line"><a id="l00263" name="l00263"></a><span class="lineno">  263</span>    rightsw = 200</div>
<div class="line"><a id="l00264" name="l00264"></a><span class="lineno">  264</span>    space = 20</div>
<div class="line"><a id="l00265" name="l00265"></a><span class="lineno">  265</span>    canvas.setFont(<span class="stringliteral">&#39;Helvetica-Bold&#39;</span>, 13)</div>
<div class="line"><a id="l00266" name="l00266"></a><span class="lineno">  266</span>    canvas.drawString(leftsw, heights, <span class="stringliteral">&quot;Project Property:&quot;</span>)</div>
<div class="line"><a id="l00267" name="l00267"></a><span class="lineno">  267</span>    canvas.drawString(leftsw, heights-3*space,<span class="stringliteral">&quot;Project No:&quot;</span>)</div>
<div class="line"><a id="l00268" name="l00268"></a><span class="lineno">  268</span>    canvas.drawString(leftsw, heights-4*space,<span class="stringliteral">&quot;Requested By:&quot;</span>)</div>
<div class="line"><a id="l00269" name="l00269"></a><span class="lineno">  269</span>    canvas.drawString(leftsw, heights-5*space,<span class="stringliteral">&quot;Order No:&quot;</span>)</div>
<div class="line"><a id="l00270" name="l00270"></a><span class="lineno">  270</span>    canvas.drawString(leftsw, heights-6*space,<span class="stringliteral">&quot;Date Completed:&quot;</span>)</div>
<div class="line"><a id="l00271" name="l00271"></a><span class="lineno">  271</span>    canvas.setFont(<span class="stringliteral">&#39;Helvetica&#39;</span>, 13)</div>
<div class="line"><a id="l00272" name="l00272"></a><span class="lineno">  272</span>    canvas.drawString(rightsw,heights-0*space, coverInfotext[<span class="stringliteral">&quot;SITE_NAME&quot;</span>])</div>
<div class="line"><a id="l00273" name="l00273"></a><span class="lineno">  273</span>    canvas.drawString(rightsw, heights-1*space,coverInfotext[<span class="stringliteral">&quot;ADDRESS&quot;</span>].split(<span class="stringliteral">&quot;\n&quot;</span>)[0])</div>
<div class="line"><a id="l00274" name="l00274"></a><span class="lineno">  274</span>    canvas.drawString(rightsw, heights-2*space,coverInfotext[<span class="stringliteral">&quot;ADDRESS&quot;</span>].split(<span class="stringliteral">&quot;\n&quot;</span>)[1])</div>
<div class="line"><a id="l00275" name="l00275"></a><span class="lineno">  275</span>    canvas.drawString(rightsw, heights-3*space,coverInfotext[<span class="stringliteral">&quot;PROJECT_NUM&quot;</span>])</div>
<div class="line"><a id="l00276" name="l00276"></a><span class="lineno">  276</span>    canvas.drawString(rightsw, heights-4*space,coverInfotext[<span class="stringliteral">&quot;COMPANY_NAME&quot;</span>])</div>
<div class="line"><a id="l00277" name="l00277"></a><span class="lineno">  277</span>    canvas.drawString(rightsw, heights-5*space,coverInfotext[<span class="stringliteral">&quot;ORDER_NUM&quot;</span>])</div>
<div class="line"><a id="l00278" name="l00278"></a><span class="lineno">  278</span>    canvas.drawString(rightsw, heights-6*space,time.strftime(<span class="stringliteral">&#39;%B %d, %Y&#39;</span>, time.localtime()))</div>
<div class="line"><a id="l00279" name="l00279"></a><span class="lineno">  279</span>    canvas.saveState()</div>
<div class="line"><a id="l00280" name="l00280"></a><span class="lineno">  280</span> </div>
<div class="line"><a id="l00281" name="l00281"></a><span class="lineno">  281</span>    <span class="comment"># canvas.restoreState()</span></div>
<div class="line"><a id="l00282" name="l00282"></a><span class="lineno">  282</span>    <span class="comment"># p=None</span></div>
<div class="line"><a id="l00283" name="l00283"></a><span class="lineno">  283</span>    <span class="comment"># Disclaimer = None</span></div>
<div class="line"><a id="l00284" name="l00284"></a><span class="lineno">  284</span>    <span class="comment"># style = None</span></div>
<div class="line"><a id="l00285" name="l00285"></a><span class="lineno">  285</span>    del canvas</div>
<div class="line"><a id="l00286" name="l00286"></a><span class="lineno">  286</span> </div>
<div class="line"><a id="l00287" name="l00287"></a><span class="lineno"><a class="line" href="namespace_u_s_topo_search__prod.html#a8978d27d7fad9f078b8704e8ce2ca876">  287</a></span><span class="keyword">def </span><a class="code hl_function" href="namespace_u_s_topo_search__prod.html#a8978d27d7fad9f078b8704e8ce2ca876">goCoverPage</a>(coverPdf):<span class="comment">#, data):</span></div>
<div class="line"><a id="l00288" name="l00288"></a><span class="lineno">  288</span>    doc = SimpleDocTemplate(coverPdf, pagesize = letter)</div>
<div class="line"><a id="l00289" name="l00289"></a><span class="lineno">  289</span>    doc.build([Spacer(0,4*inch)],onFirstPage=myCoverPage, onLaterPages=myCoverPage)</div>
<div class="line"><a id="l00290" name="l00290"></a><span class="lineno">  290</span>    doc = <span class="keywordtype">None</span></div>
<div class="line"><a id="l00291" name="l00291"></a><span class="lineno">  291</span> </div>
<div class="line"><a id="l00292" name="l00292"></a><span class="lineno"><a class="line" href="namespace_u_s_topo_search__prod.html#af83c368ccf3a3e3bdc0b3b8079045a4b">  292</a></span><span class="keyword">def </span><a class="code hl_function" href="namespace_u_s_topo_search__prod.html#af83c368ccf3a3e3bdc0b3b8079045a4b">dedupMaplist</a>(mapslist):</div>
<div class="line"><a id="l00293" name="l00293"></a><span class="lineno">  293</span>    <span class="keywordflow">if</span> mapslist != []:</div>
<div class="line"><a id="l00294" name="l00294"></a><span class="lineno">  294</span>    <span class="comment"># remove duplicates (same cell and same year)</span></div>
<div class="line"><a id="l00295" name="l00295"></a><span class="lineno">  295</span>        <span class="keywordflow">if</span> len(mapslist) &gt; 1:   <span class="comment"># if just 1, no need to do anything</span></div>
<div class="line"><a id="l00296" name="l00296"></a><span class="lineno">  296</span>            mapslist = sorted(mapslist,key=operator.itemgetter(3,0), reverse = <span class="keyword">True</span>)  <span class="comment"># sorted based on year then cell</span></div>
<div class="line"><a id="l00297" name="l00297"></a><span class="lineno">  297</span>            i=1</div>
<div class="line"><a id="l00298" name="l00298"></a><span class="lineno">  298</span>            remlist = []</div>
<div class="line"><a id="l00299" name="l00299"></a><span class="lineno">  299</span>            <span class="keywordflow">while</span> i&lt;len(mapslist):</div>
<div class="line"><a id="l00300" name="l00300"></a><span class="lineno">  300</span>                row = mapslist[i]</div>
<div class="line"><a id="l00301" name="l00301"></a><span class="lineno">  301</span>                <span class="keywordflow">if</span> row[3] == mapslist[i-1][3] <span class="keywordflow">and</span> row[0] == mapslist[i-1][0]:</div>
<div class="line"><a id="l00302" name="l00302"></a><span class="lineno">  302</span>                    remlist.append(i)</div>
<div class="line"><a id="l00303" name="l00303"></a><span class="lineno">  303</span>                i = i+1</div>
<div class="line"><a id="l00304" name="l00304"></a><span class="lineno">  304</span> </div>
<div class="line"><a id="l00305" name="l00305"></a><span class="lineno">  305</span>            <span class="keywordflow">for</span> index <span class="keywordflow">in</span> sorted(remlist,reverse = <span class="keyword">True</span>):</div>
<div class="line"><a id="l00306" name="l00306"></a><span class="lineno">  306</span>                del mapslist[index]</div>
<div class="line"><a id="l00307" name="l00307"></a><span class="lineno">  307</span>    <span class="keywordflow">return</span> mapslist</div>
<div class="line"><a id="l00308" name="l00308"></a><span class="lineno">  308</span> </div>
<div class="line"><a id="l00309" name="l00309"></a><span class="lineno"><a class="line" href="namespace_u_s_topo_search__prod.html#a68bb920bc7c3a8c7520c4a09f83dcc4c">  309</a></span><span class="keyword">def </span><a class="code hl_function" href="namespace_u_s_topo_search__prod.html#a68bb920bc7c3a8c7520c4a09f83dcc4c">countSheets</a>(mapslist):</div>
<div class="line"><a id="l00310" name="l00310"></a><span class="lineno">  310</span>    <span class="keywordflow">if</span> len(mapslist) == 0:</div>
<div class="line"><a id="l00311" name="l00311"></a><span class="lineno">  311</span>        count = []</div>
<div class="line"><a id="l00312" name="l00312"></a><span class="lineno">  312</span>    <span class="keywordflow">elif</span> len(mapslist) == 1:</div>
<div class="line"><a id="l00313" name="l00313"></a><span class="lineno">  313</span>        count = [1]</div>
<div class="line"><a id="l00314" name="l00314"></a><span class="lineno">  314</span>    <span class="keywordflow">else</span>:</div>
<div class="line"><a id="l00315" name="l00315"></a><span class="lineno">  315</span>        count = [1]</div>
<div class="line"><a id="l00316" name="l00316"></a><span class="lineno">  316</span>        i = 1</div>
<div class="line"><a id="l00317" name="l00317"></a><span class="lineno">  317</span>        <span class="keywordflow">while</span> i &lt; len(mapslist):</div>
<div class="line"><a id="l00318" name="l00318"></a><span class="lineno">  318</span>            <span class="keywordflow">if</span> mapslist[i][3] == mapslist[i-1][3]:</div>
<div class="line"><a id="l00319" name="l00319"></a><span class="lineno">  319</span>                count.append(count[i-1]+1)</div>
<div class="line"><a id="l00320" name="l00320"></a><span class="lineno">  320</span>            <span class="keywordflow">else</span>:</div>
<div class="line"><a id="l00321" name="l00321"></a><span class="lineno">  321</span>                count.append(1)</div>
<div class="line"><a id="l00322" name="l00322"></a><span class="lineno">  322</span>            i = i + 1</div>
<div class="line"><a id="l00323" name="l00323"></a><span class="lineno">  323</span>    <span class="keywordflow">return</span> count</div>
<div class="line"><a id="l00324" name="l00324"></a><span class="lineno">  324</span> </div>
<div class="line"><a id="l00325" name="l00325"></a><span class="lineno">  325</span><span class="comment"># reorgnize the pdf dictionary based on years</span></div>
<div class="line"><a id="l00326" name="l00326"></a><span class="lineno">  326</span><span class="comment"># filter out irrelevant background years (which doesn&#39;t have a centre selected map)</span></div>
<div class="line"><a id="l00327" name="l00327"></a><span class="lineno"><a class="line" href="namespace_u_s_topo_search__prod.html#acbb1435522472ef5bb040353ce851352">  327</a></span><span class="keyword">def </span><a class="code hl_function" href="namespace_u_s_topo_search__prod.html#acbb1435522472ef5bb040353ce851352">reorgByYear</a>(mapslist):      <span class="comment"># [64818, 15X15 GRID,  LA_Zachary_335142_1963_62500_geo.pdf,  1963]</span></div>
<div class="line"><a id="l00328" name="l00328"></a><span class="lineno">  328</span>    diction_pdf_inPresentationBuffer = {}    <span class="comment">#{1975: [geopdf1.pdf, geopdf2.pdf...], 1968: [geopdf11.pdf, ...]}</span></div>
<div class="line"><a id="l00329" name="l00329"></a><span class="lineno">  329</span>    diction_pdf_inSearchBuffer = {}</div>
<div class="line"><a id="l00330" name="l00330"></a><span class="lineno">  330</span>    diction_cellids = {}        <span class="comment"># {1975:[cellid1,cellid2...], 1968:[cellid11,cellid12,...]}</span></div>
<div class="line"><a id="l00331" name="l00331"></a><span class="lineno">  331</span>    <span class="keywordflow">for</span> row <span class="keywordflow">in</span> mapslist:</div>
<div class="line"><a id="l00332" name="l00332"></a><span class="lineno">  332</span>        <span class="keywordflow">if</span> row[3] <span class="keywordflow">in</span> diction_pdf_inPresentationBuffer.keys():  <span class="comment">#{1963:LA_Zachary_335142_1963_62500_geo.pdf, 1975:....}</span></div>
<div class="line"><a id="l00333" name="l00333"></a><span class="lineno">  333</span>            diction_pdf_inPresentationBuffer[row[3]].append(row[2])</div>
<div class="line"><a id="l00334" name="l00334"></a><span class="lineno">  334</span>            diction_cellids[row[3]].append(row[0])</div>
<div class="line"><a id="l00335" name="l00335"></a><span class="lineno">  335</span>        <span class="keywordflow">else</span>:</div>
<div class="line"><a id="l00336" name="l00336"></a><span class="lineno">  336</span>            diction_pdf_inPresentationBuffer[row[3]] = [row[2]]</div>
<div class="line"><a id="l00337" name="l00337"></a><span class="lineno">  337</span>            diction_cellids[row[3]] = [row[0]]</div>
<div class="line"><a id="l00338" name="l00338"></a><span class="lineno">  338</span>    <span class="keywordflow">for</span> key <span class="keywordflow">in</span> diction_cellids:    <span class="comment"># key is the year</span></div>
<div class="line"><a id="l00339" name="l00339"></a><span class="lineno">  339</span>        hasSelectedMap = <span class="keyword">False</span></div>
<div class="line"><a id="l00340" name="l00340"></a><span class="lineno">  340</span>        <span class="keywordflow">for</span> (cellid,pdfname) <span class="keywordflow">in</span> zip(diction_cellids[key],diction_pdf_inPresentationBuffer[key]):</div>
<div class="line"><a id="l00341" name="l00341"></a><span class="lineno">  341</span>            <span class="keywordflow">if</span> cellid <span class="keywordflow">in</span> cellids_selected:</div>
<div class="line"><a id="l00342" name="l00342"></a><span class="lineno">  342</span>                <span class="keywordflow">if</span> key <span class="keywordflow">in</span> diction_pdf_inSearchBuffer.keys():</div>
<div class="line"><a id="l00343" name="l00343"></a><span class="lineno">  343</span>                    diction_pdf_inSearchBuffer[key].append(pdfname)</div>
<div class="line"><a id="l00344" name="l00344"></a><span class="lineno">  344</span>                <span class="keywordflow">else</span>:</div>
<div class="line"><a id="l00345" name="l00345"></a><span class="lineno">  345</span>                    diction_pdf_inSearchBuffer[key] = [pdfname]</div>
<div class="line"><a id="l00346" name="l00346"></a><span class="lineno">  346</span>                hasSelectedMap = <span class="keyword">True</span></div>
<div class="line"><a id="l00347" name="l00347"></a><span class="lineno">  347</span>                <span class="comment"># break;</span></div>
<div class="line"><a id="l00348" name="l00348"></a><span class="lineno">  348</span>        <span class="keywordflow">if</span> <span class="keywordflow">not</span> hasSelectedMap:</div>
<div class="line"><a id="l00349" name="l00349"></a><span class="lineno">  349</span>            diction_pdf_inPresentationBuffer.pop(key,<span class="keywordtype">None</span>)</div>
<div class="line"><a id="l00350" name="l00350"></a><span class="lineno">  350</span>    <span class="keywordflow">return</span> (diction_pdf_inPresentationBuffer,diction_pdf_inSearchBuffer)</div>
<div class="line"><a id="l00351" name="l00351"></a><span class="lineno">  351</span> </div>
<div class="line"><a id="l00352" name="l00352"></a><span class="lineno">  352</span><span class="comment"># create PDF and also make a copy of the geotiff files if the scale is too small</span></div>
<div class="line"><a id="l00353" name="l00353"></a><span class="lineno"><a class="line" href="namespace_u_s_topo_search__prod.html#a2a4e32a7e190d24140a7b794c29a8b28">  353</a></span><span class="keyword">def </span><a class="code hl_function" href="namespace_u_s_topo_search__prod.html#a2a4e32a7e190d24140a7b794c29a8b28">createPDF</a>(seriesText,diction,diction_s,outpdfname):</div>
<div class="line"><a id="l00354" name="l00354"></a><span class="lineno">  354</span> </div>
<div class="line"><a id="l00355" name="l00355"></a><span class="lineno">  355</span>    <span class="keywordflow">if</span> OrderType.lower()== <span class="stringliteral">&#39;point&#39;</span>:</div>
<div class="line"><a id="l00356" name="l00356"></a><span class="lineno">  356</span>        orderGeomlyrfile = orderGeomlyrfile_point</div>
<div class="line"><a id="l00357" name="l00357"></a><span class="lineno">  357</span>    <span class="keywordflow">elif</span> OrderType.lower() ==<span class="stringliteral">&#39;polyline&#39;</span>:</div>
<div class="line"><a id="l00358" name="l00358"></a><span class="lineno">  358</span>        orderGeomlyrfile = orderGeomlyrfile_polyline</div>
<div class="line"><a id="l00359" name="l00359"></a><span class="lineno">  359</span>    <span class="keywordflow">else</span>:</div>
<div class="line"><a id="l00360" name="l00360"></a><span class="lineno">  360</span>        orderGeomlyrfile = orderGeomlyrfile_polygon</div>
<div class="line"><a id="l00361" name="l00361"></a><span class="lineno">  361</span> </div>
<div class="line"><a id="l00362" name="l00362"></a><span class="lineno">  362</span>    logger.debug(<span class="stringliteral">&quot;#4-1&quot;</span>)</div>
<div class="line"><a id="l00363" name="l00363"></a><span class="lineno">  363</span>    orderGeomLayer = arcpy.mapping.Layer(orderGeomlyrfile)</div>
<div class="line"><a id="l00364" name="l00364"></a><span class="lineno">  364</span>    orderGeomLayer.replaceDataSource(scratch,<span class="stringliteral">&quot;SHAPEFILE_WORKSPACE&quot;</span>,<span class="stringliteral">&quot;orderGeometry&quot;</span>)</div>
<div class="line"><a id="l00365" name="l00365"></a><span class="lineno">  365</span>    logger.debug(<span class="stringliteral">&quot;#4-2&quot;</span>)</div>
<div class="line"><a id="l00366" name="l00366"></a><span class="lineno">  366</span> </div>
<div class="line"><a id="l00367" name="l00367"></a><span class="lineno">  367</span>    extentBufferLayer = arcpy.mapping.Layer(bufferlyrfile)</div>
<div class="line"><a id="l00368" name="l00368"></a><span class="lineno">  368</span>    extentBufferLayer.replaceDataSource(scratch,<span class="stringliteral">&quot;SHAPEFILE_WORKSPACE&quot;</span>,<span class="stringliteral">&quot;buffer_extent75&quot;</span>)   <span class="comment">#change on 11/3/2016, fix all maps to the same scale</span></div>
<div class="line"><a id="l00369" name="l00369"></a><span class="lineno">  369</span> </div>
<div class="line"><a id="l00370" name="l00370"></a><span class="lineno">  370</span>    <span class="comment"># if seriesText == &quot;7.5&quot;:</span></div>
<div class="line"><a id="l00371" name="l00371"></a><span class="lineno">  371</span>    <span class="comment">#     extentBufferLayer.replaceDataSource(scratch,&quot;SHAPEFILE_WORKSPACE&quot;,&quot;buffer_extent75&quot;)</span></div>
<div class="line"><a id="l00372" name="l00372"></a><span class="lineno">  372</span>    <span class="comment"># else:   #by default &quot;15&quot;</span></div>
<div class="line"><a id="l00373" name="l00373"></a><span class="lineno">  373</span>    <span class="comment">#     extentBufferLayer.replaceDataSource(scratch,&quot;SHAPEFILE_WORKSPACE&quot;,&quot;buffer_extent15&quot;)</span></div>
<div class="line"><a id="l00374" name="l00374"></a><span class="lineno">  374</span> </div>
<div class="line"><a id="l00375" name="l00375"></a><span class="lineno">  375</span>    outputPDF = arcpy.mapping.PDFDocumentCreate(os.path.join(scratch, outpdfname))</div>
<div class="line"><a id="l00376" name="l00376"></a><span class="lineno">  376</span> </div>
<div class="line"><a id="l00377" name="l00377"></a><span class="lineno">  377</span>    years = diction.keys()</div>
<div class="line"><a id="l00378" name="l00378"></a><span class="lineno">  378</span>    <span class="keywordflow">if</span> is_aei == <span class="stringliteral">&#39;Y&#39;</span>:</div>
<div class="line"><a id="l00379" name="l00379"></a><span class="lineno">  379</span>        years.sort(reverse = <span class="keyword">False</span>)</div>
<div class="line"><a id="l00380" name="l00380"></a><span class="lineno">  380</span>    <span class="keywordflow">else</span>:</div>
<div class="line"><a id="l00381" name="l00381"></a><span class="lineno">  381</span>        years.sort(reverse = <span class="keyword">True</span>)</div>
<div class="line"><a id="l00382" name="l00382"></a><span class="lineno">  382</span> </div>
<div class="line"><a id="l00383" name="l00383"></a><span class="lineno">  383</span>    <span class="keywordflow">for</span> year <span class="keywordflow">in</span> years:</div>
<div class="line"><a id="l00384" name="l00384"></a><span class="lineno">  384</span>        <span class="keywordflow">if</span> year == <span class="stringliteral">&quot;&quot;</span>:</div>
<div class="line"><a id="l00385" name="l00385"></a><span class="lineno">  385</span>            years.remove(<span class="stringliteral">&quot;&quot;</span>)</div>
<div class="line"><a id="l00386" name="l00386"></a><span class="lineno">  386</span>    print(years)</div>
<div class="line"><a id="l00387" name="l00387"></a><span class="lineno">  387</span> </div>
<div class="line"><a id="l00388" name="l00388"></a><span class="lineno">  388</span>    <span class="keywordflow">for</span> year <span class="keywordflow">in</span> years:</div>
<div class="line"><a id="l00389" name="l00389"></a><span class="lineno">  389</span>        <span class="keywordflow">if</span> int(year) &lt; 2008:</div>
<div class="line"><a id="l00390" name="l00390"></a><span class="lineno">  390</span>            tifdir = tifdir_h</div>
<div class="line"><a id="l00391" name="l00391"></a><span class="lineno">  391</span>            <span class="keywordflow">if</span> len(years) &gt; 1:</div>
<div class="line"><a id="l00392" name="l00392"></a><span class="lineno">  392</span>                topofile = topolyrfile_b</div>
<div class="line"><a id="l00393" name="l00393"></a><span class="lineno">  393</span>            <span class="keywordflow">else</span>:</div>
<div class="line"><a id="l00394" name="l00394"></a><span class="lineno">  394</span>                topofile = topolyrfile_none</div>
<div class="line"><a id="l00395" name="l00395"></a><span class="lineno">  395</span>            mscale = int(diction[year][0].split(<span class="stringliteral">&#39;_&#39;</span>)[-2])   <span class="comment">#assumption: WI_Ashland East_500066_1964_24000_geo.pdf, and all pdfs from the same year are of the same scale</span></div>
<div class="line"><a id="l00396" name="l00396"></a><span class="lineno">  396</span>            <span class="keywordflow">print</span> (<span class="stringliteral">&quot;########&quot;</span> + str(mscale))</div>
<div class="line"><a id="l00397" name="l00397"></a><span class="lineno">  397</span>            <span class="keywordflow">if</span> is_aei == <span class="stringliteral">&#39;Y&#39;</span> <span class="keywordflow">and</span> mscale <span class="keywordflow">in</span> [24000,31680]:</div>
<div class="line"><a id="l00398" name="l00398"></a><span class="lineno">  398</span>                seriesText = <span class="stringliteral">&#39;7.5&#39;</span></div>
<div class="line"><a id="l00399" name="l00399"></a><span class="lineno">  399</span>            <span class="keywordflow">elif</span> is_aei == <span class="stringliteral">&#39;Y&#39;</span> <span class="keywordflow">and</span> mscale == 62500:</div>
<div class="line"><a id="l00400" name="l00400"></a><span class="lineno">  400</span>                seriesText = <span class="stringliteral">&#39;15&#39;</span></div>
<div class="line"><a id="l00401" name="l00401"></a><span class="lineno">  401</span>            <span class="keywordflow">elif</span> is_aei == <span class="stringliteral">&#39;Y&#39;</span>:</div>
<div class="line"><a id="l00402" name="l00402"></a><span class="lineno">  402</span>                seriesText = <span class="stringliteral">&#39;7.5&#39;</span></div>
<div class="line"><a id="l00403" name="l00403"></a><span class="lineno">  403</span>            <span class="keywordflow">else</span>:</div>
<div class="line"><a id="l00404" name="l00404"></a><span class="lineno">  404</span>                <span class="keywordflow">pass</span></div>
<div class="line"><a id="l00405" name="l00405"></a><span class="lineno">  405</span>        <span class="keywordflow">else</span>:</div>
<div class="line"><a id="l00406" name="l00406"></a><span class="lineno">  406</span>            tifdir = tifdir_c</div>
<div class="line"><a id="l00407" name="l00407"></a><span class="lineno">  407</span>            <span class="keywordflow">if</span> len(years) &gt; 1:</div>
<div class="line"><a id="l00408" name="l00408"></a><span class="lineno">  408</span>                topofile = topolyrfile_w</div>
<div class="line"><a id="l00409" name="l00409"></a><span class="lineno">  409</span>            <span class="keywordflow">else</span>:</div>
<div class="line"><a id="l00410" name="l00410"></a><span class="lineno">  410</span>                topofile = topolyrfile_none</div>
<div class="line"><a id="l00411" name="l00411"></a><span class="lineno">  411</span>            mscale = 24000</div>
<div class="line"><a id="l00412" name="l00412"></a><span class="lineno">  412</span>        mscale = 24000      <span class="comment"># change on 11/3/2016, to fix all maps to the same scale</span></div>
<div class="line"><a id="l00413" name="l00413"></a><span class="lineno">  413</span> </div>
<div class="line"><a id="l00414" name="l00414"></a><span class="lineno">  414</span>    <span class="comment"># years = diction.keys()</span></div>
<div class="line"><a id="l00415" name="l00415"></a><span class="lineno">  415</span>    <span class="comment"># if is_aei == &#39;Y&#39;:</span></div>
<div class="line"><a id="l00416" name="l00416"></a><span class="lineno">  416</span>    <span class="comment">#     years.sort(reverse = False)</span></div>
<div class="line"><a id="l00417" name="l00417"></a><span class="lineno">  417</span>    <span class="comment">#     for year in years:</span></div>
<div class="line"><a id="l00418" name="l00418"></a><span class="lineno">  418</span>    <span class="comment">#         if int(year) &lt; 2008:</span></div>
<div class="line"><a id="l00419" name="l00419"></a><span class="lineno">  419</span>    <span class="comment">#             tifdir = tifdir_h</span></div>
<div class="line"><a id="l00420" name="l00420"></a><span class="lineno">  420</span>    <span class="comment">#             if len(years) &gt; 1:</span></div>
<div class="line"><a id="l00421" name="l00421"></a><span class="lineno">  421</span>    <span class="comment">#                 topofile = topolyrfile_b</span></div>
<div class="line"><a id="l00422" name="l00422"></a><span class="lineno">  422</span>    <span class="comment">#             else:</span></div>
<div class="line"><a id="l00423" name="l00423"></a><span class="lineno">  423</span>    <span class="comment">#                 topofile = topolyrfile_none</span></div>
<div class="line"><a id="l00424" name="l00424"></a><span class="lineno">  424</span>    <span class="comment">#             mscale = int(diction[year][0].split(&#39;_&#39;)[-2])   #assumption: WI_Ashland East_500066_1964_24000_geo.pdf, and all pdfs from the same year are of the same scale</span></div>
<div class="line"><a id="l00425" name="l00425"></a><span class="lineno">  425</span>    <span class="comment">#             print &quot;########&quot; + str(mscale)</span></div>
<div class="line"><a id="l00426" name="l00426"></a><span class="lineno">  426</span>    <span class="comment">#             if mscale == 24000:</span></div>
<div class="line"><a id="l00427" name="l00427"></a><span class="lineno">  427</span>    <span class="comment">#                 seriesText = &#39;7.5&#39;</span></div>
<div class="line"><a id="l00428" name="l00428"></a><span class="lineno">  428</span>    <span class="comment">#             else:</span></div>
<div class="line"><a id="l00429" name="l00429"></a><span class="lineno">  429</span>    <span class="comment">#                 seriesText = &#39;15&#39;</span></div>
<div class="line"><a id="l00430" name="l00430"></a><span class="lineno">  430</span>    <span class="comment">#         else:</span></div>
<div class="line"><a id="l00431" name="l00431"></a><span class="lineno">  431</span>    <span class="comment">#             tifdir = tifdir_c</span></div>
<div class="line"><a id="l00432" name="l00432"></a><span class="lineno">  432</span>    <span class="comment">#             if len(years) &gt; 1:</span></div>
<div class="line"><a id="l00433" name="l00433"></a><span class="lineno">  433</span>    <span class="comment">#                 topofile = topolyrfile_w</span></div>
<div class="line"><a id="l00434" name="l00434"></a><span class="lineno">  434</span>    <span class="comment">#             else:</span></div>
<div class="line"><a id="l00435" name="l00435"></a><span class="lineno">  435</span>    <span class="comment">#                 topofile = topolyrfile_none</span></div>
<div class="line"><a id="l00436" name="l00436"></a><span class="lineno">  436</span>    <span class="comment">#             mscale = 24000</span></div>
<div class="line"><a id="l00437" name="l00437"></a><span class="lineno">  437</span>    <span class="comment">#         mscale = 24000</span></div>
<div class="line"><a id="l00438" name="l00438"></a><span class="lineno">  438</span>    <span class="comment"># else:</span></div>
<div class="line"><a id="l00439" name="l00439"></a><span class="lineno">  439</span>    <span class="comment">#     years.sort(reverse = True)</span></div>
<div class="line"><a id="l00440" name="l00440"></a><span class="lineno">  440</span>    <span class="comment">#     for year in years:</span></div>
<div class="line"><a id="l00441" name="l00441"></a><span class="lineno">  441</span>    <span class="comment">#         if int(year) &lt; 2008:</span></div>
<div class="line"><a id="l00442" name="l00442"></a><span class="lineno">  442</span>    <span class="comment">#             tifdir = tifdir_h</span></div>
<div class="line"><a id="l00443" name="l00443"></a><span class="lineno">  443</span>    <span class="comment">#             if len(years) &gt; 1:</span></div>
<div class="line"><a id="l00444" name="l00444"></a><span class="lineno">  444</span>    <span class="comment">#                 topofile = topolyrfile_b</span></div>
<div class="line"><a id="l00445" name="l00445"></a><span class="lineno">  445</span>    <span class="comment">#             else:</span></div>
<div class="line"><a id="l00446" name="l00446"></a><span class="lineno">  446</span>    <span class="comment">#                 topofile = topolyrfile_none</span></div>
<div class="line"><a id="l00447" name="l00447"></a><span class="lineno">  447</span>    <span class="comment">#             mscale = int(diction[year][0].split(&#39;_&#39;)[-2])   #assumption: WI_Ashland East_500066_1964_24000_geo.pdf, and all pdfs from the same year are of the same scale</span></div>
<div class="line"><a id="l00448" name="l00448"></a><span class="lineno">  448</span>    <span class="comment">#             print &quot;########&quot; + str(mscale)</span></div>
<div class="line"><a id="l00449" name="l00449"></a><span class="lineno">  449</span>    <span class="comment">#         else:</span></div>
<div class="line"><a id="l00450" name="l00450"></a><span class="lineno">  450</span>    <span class="comment">#             tifdir = tifdir_c</span></div>
<div class="line"><a id="l00451" name="l00451"></a><span class="lineno">  451</span>    <span class="comment">#             if len(years) &gt; 1:</span></div>
<div class="line"><a id="l00452" name="l00452"></a><span class="lineno">  452</span>    <span class="comment">#                 topofile = topolyrfile_w</span></div>
<div class="line"><a id="l00453" name="l00453"></a><span class="lineno">  453</span>    <span class="comment">#             else:</span></div>
<div class="line"><a id="l00454" name="l00454"></a><span class="lineno">  454</span>    <span class="comment">#                 topofile = topolyrfile_none</span></div>
<div class="line"><a id="l00455" name="l00455"></a><span class="lineno">  455</span>    <span class="comment">#             mscale = 24000</span></div>
<div class="line"><a id="l00456" name="l00456"></a><span class="lineno">  456</span>    <span class="comment">#         mscale = 24000   #change on 11/3/2016, to fix all maps to the same scale</span></div>
<div class="line"><a id="l00457" name="l00457"></a><span class="lineno">  457</span> </div>
<div class="line"><a id="l00458" name="l00458"></a><span class="lineno">  458</span>        <span class="comment"># add to map template, clip (but need to keep both metadata: year, grid size, quadrangle name(s) and present in order</span></div>
<div class="line"><a id="l00459" name="l00459"></a><span class="lineno">  459</span> </div>
<div class="line"><a id="l00460" name="l00460"></a><span class="lineno">  460</span>        <span class="keywordflow">if</span> is_nova == <span class="stringliteral">&#39;Y&#39;</span>:</div>
<div class="line"><a id="l00461" name="l00461"></a><span class="lineno">  461</span>            mxd = arcpy.mapping.MapDocument(mxdfile_nova)</div>
<div class="line"><a id="l00462" name="l00462"></a><span class="lineno">  462</span>        <span class="keywordflow">else</span>:</div>
<div class="line"><a id="l00463" name="l00463"></a><span class="lineno">  463</span>            mxd = arcpy.mapping.MapDocument(mxdfile)</div>
<div class="line"><a id="l00464" name="l00464"></a><span class="lineno">  464</span>        df = arcpy.mapping.ListDataFrames(mxd,<span class="stringliteral">&quot;*&quot;</span>)[0]</div>
<div class="line"><a id="l00465" name="l00465"></a><span class="lineno">  465</span>        spatialRef = out_coordinate_system</div>
<div class="line"><a id="l00466" name="l00466"></a><span class="lineno">  466</span>        df.spatialReference = spatialRef</div>
<div class="line"><a id="l00467" name="l00467"></a><span class="lineno">  467</span> </div>
<div class="line"><a id="l00468" name="l00468"></a><span class="lineno">  468</span>        arcpy.mapping.AddLayer(df,extentBufferLayer,<span class="stringliteral">&quot;Top&quot;</span>)</div>
<div class="line"><a id="l00469" name="l00469"></a><span class="lineno">  469</span>        <span class="comment"># if yesBoundary.lower() == &quot;yes&quot; or yesBoundary.lower() == &quot;y&quot;:</span></div>
<div class="line"><a id="l00470" name="l00470"></a><span class="lineno">  470</span>        <span class="comment">#     if emgOrder ==&#39;N&#39;:        #add geometry for non-emg orders</span></div>
<div class="line"><a id="l00471" name="l00471"></a><span class="lineno">  471</span>        <span class="comment">#         arcpy.mapping.AddLayer(df,orderGeomLayer,&quot;Top&quot;)</span></div>
<div class="line"><a id="l00472" name="l00472"></a><span class="lineno">  472</span>        <span class="comment"># else:</span></div>
<div class="line"><a id="l00473" name="l00473"></a><span class="lineno">  473</span>        <span class="comment">#     if is_nova == &#39;Y&#39;:   #nova wants boundary</span></div>
<div class="line"><a id="l00474" name="l00474"></a><span class="lineno">  474</span>        <span class="comment">#         arcpy.mapping.AddLayer(df,orderGeomLayer,&quot;Top&quot;)</span></div>
<div class="line"><a id="l00475" name="l00475"></a><span class="lineno">  475</span>        <span class="keywordflow">if</span> yesBoundary.lower() == <span class="stringliteral">&#39;fixed&#39;</span>:</div>
<div class="line"><a id="l00476" name="l00476"></a><span class="lineno">  476</span>            arcpy.mapping.AddLayer(df,orderGeomLayer,<span class="stringliteral">&quot;Top&quot;</span>)</div>
<div class="line"><a id="l00477" name="l00477"></a><span class="lineno">  477</span> </div>
<div class="line"><a id="l00478" name="l00478"></a><span class="lineno">  478</span>        <span class="comment"># change scale, modify map elements, export</span></div>
<div class="line"><a id="l00479" name="l00479"></a><span class="lineno">  479</span>        needtif = <span class="keyword">False</span></div>
<div class="line"><a id="l00480" name="l00480"></a><span class="lineno">  480</span>        df.extent = extentBufferLayer.getSelectedExtent(<span class="keyword">False</span>)</div>
<div class="line"><a id="l00481" name="l00481"></a><span class="lineno">  481</span>        logger.debug(<span class="stringliteral">&#39;&#39;</span>);</div>
<div class="line"><a id="l00482" name="l00482"></a><span class="lineno">  482</span>        <span class="keywordflow">if</span> df.scale &lt; mscale:</div>
<div class="line"><a id="l00483" name="l00483"></a><span class="lineno">  483</span>            print(<span class="stringliteral">&quot;here0&quot;</span>)</div>
<div class="line"><a id="l00484" name="l00484"></a><span class="lineno">  484</span>            print(mscale)</div>
<div class="line"><a id="l00485" name="l00485"></a><span class="lineno">  485</span>            scale = mscale</div>
<div class="line"><a id="l00486" name="l00486"></a><span class="lineno">  486</span>            <span class="comment"># scale = 10000</span></div>
<div class="line"><a id="l00487" name="l00487"></a><span class="lineno">  487</span>            needtif = <span class="keyword">False</span></div>
<div class="line"><a id="l00488" name="l00488"></a><span class="lineno">  488</span>        <span class="keywordflow">else</span>:</div>
<div class="line"><a id="l00489" name="l00489"></a><span class="lineno">  489</span>            <span class="comment"># if df.scale &gt; 2 * mscale:  # 2 is an empirical number</span></div>
<div class="line"><a id="l00490" name="l00490"></a><span class="lineno">  490</span>            <span class="keywordflow">if</span> df.scale &gt; 1.5 * mscale:</div>
<div class="line"><a id="l00491" name="l00491"></a><span class="lineno">  491</span>                <span class="keywordflow">print</span> (<span class="stringliteral">&quot;***** need to provide geotiffs&quot;</span>)</div>
<div class="line"><a id="l00492" name="l00492"></a><span class="lineno">  492</span>                scale = df.scale</div>
<div class="line"><a id="l00493" name="l00493"></a><span class="lineno">  493</span>                needtif = <span class="keyword">True</span></div>
<div class="line"><a id="l00494" name="l00494"></a><span class="lineno">  494</span>                print(<span class="stringliteral">&quot;here1&quot;</span>)</div>
<div class="line"><a id="l00495" name="l00495"></a><span class="lineno">  495</span>            <span class="keywordflow">else</span>:</div>
<div class="line"><a id="l00496" name="l00496"></a><span class="lineno">  496</span>                print(<span class="stringliteral">&quot;here2&quot;</span>)</div>
<div class="line"><a id="l00497" name="l00497"></a><span class="lineno">  497</span>                <span class="keywordflow">print</span> (<span class="stringliteral">&quot;scale is slightly bigger than the original map scale, use the standard topo map scale&quot;</span>)</div>
<div class="line"><a id="l00498" name="l00498"></a><span class="lineno">  498</span>                scale = df.scale</div>
<div class="line"><a id="l00499" name="l00499"></a><span class="lineno">  499</span>                needtif = <span class="keyword">False</span></div>
<div class="line"><a id="l00500" name="l00500"></a><span class="lineno">  500</span> </div>
<div class="line"><a id="l00501" name="l00501"></a><span class="lineno">  501</span>        copydir = os.path.join(scratch,deliverfolder,str(year)+<span class="stringliteral">&quot;_&quot;</span>+seriesText+<span class="stringliteral">&quot;_&quot;</span>+str(mscale))</div>
<div class="line"><a id="l00502" name="l00502"></a><span class="lineno">  502</span>        os.makedirs(copydir)   <span class="comment"># WI_Marengo_503367_1984_24000_geo.pdf -&gt; 1984_7.5_24000</span></div>
<div class="line"><a id="l00503" name="l00503"></a><span class="lineno">  503</span>        <span class="keywordflow">if</span> needtif == <span class="keyword">True</span>:</div>
<div class="line"><a id="l00504" name="l00504"></a><span class="lineno">  504</span>            copydirs.append(copydir)</div>
<div class="line"><a id="l00505" name="l00505"></a><span class="lineno">  505</span> </div>
<div class="line"><a id="l00506" name="l00506"></a><span class="lineno">  506</span>        pdfnames = diction[year]</div>
<div class="line"><a id="l00507" name="l00507"></a><span class="lineno">  507</span>        pdfnames.sort()</div>
<div class="line"><a id="l00508" name="l00508"></a><span class="lineno">  508</span> </div>
<div class="line"><a id="l00509" name="l00509"></a><span class="lineno">  509</span>        quadrangles = <span class="stringliteral">&quot;&quot;</span></div>
<div class="line"><a id="l00510" name="l00510"></a><span class="lineno">  510</span>        seq = 0</div>
<div class="line"><a id="l00511" name="l00511"></a><span class="lineno">  511</span>        firstTime = <span class="keyword">True</span></div>
<div class="line"><a id="l00512" name="l00512"></a><span class="lineno">  512</span>        <span class="keywordflow">for</span> pdfname <span class="keywordflow">in</span> pdfnames:</div>
<div class="line"><a id="l00513" name="l00513"></a><span class="lineno">  513</span>            tifname = pdfname[0:-4]   <span class="comment"># note without .tif part</span></div>
<div class="line"><a id="l00514" name="l00514"></a><span class="lineno">  514</span>            tifname_bk = tifname</div>
<div class="line"><a id="l00515" name="l00515"></a><span class="lineno">  515</span>            <span class="keywordflow">if</span> os.path.exists(os.path.join(tifdir,tifname+ <span class="stringliteral">&quot;_t.tif&quot;</span>)):</div>
<div class="line"><a id="l00516" name="l00516"></a><span class="lineno">  516</span>                <span class="keywordflow">if</span> <span class="stringliteral">&#39;.&#39;</span> <span class="keywordflow">in</span> tifname:</div>
<div class="line"><a id="l00517" name="l00517"></a><span class="lineno">  517</span>                    tifname = tifname.replace(<span class="stringliteral">&#39;.&#39;</span>,<span class="stringliteral">&#39;&#39;</span>)</div>
<div class="line"><a id="l00518" name="l00518"></a><span class="lineno">  518</span> </div>
<div class="line"><a id="l00519" name="l00519"></a><span class="lineno">  519</span>                <span class="comment"># need to make a local copy of the tif file for fast data source replacement</span></div>
<div class="line"><a id="l00520" name="l00520"></a><span class="lineno">  520</span>                namecomps = tifname.split(<span class="stringliteral">&#39;_&#39;</span>)</div>
<div class="line"><a id="l00521" name="l00521"></a><span class="lineno">  521</span>                namecomps.insert(-2,year)</div>
<div class="line"><a id="l00522" name="l00522"></a><span class="lineno">  522</span>                newtifname = <span class="stringliteral">&#39;_&#39;</span>.join(namecomps)</div>
<div class="line"><a id="l00523" name="l00523"></a><span class="lineno">  523</span> </div>
<div class="line"><a id="l00524" name="l00524"></a><span class="lineno">  524</span>                shutil.copyfile(os.path.join(tifdir,tifname_bk+<span class="stringliteral">&quot;_t.tif&quot;</span>),os.path.join(copydir,newtifname+<span class="stringliteral">&#39;.tif&#39;</span>))</div>
<div class="line"><a id="l00525" name="l00525"></a><span class="lineno">  525</span>                logger.debug(os.path.join(tifdir,tifname+<span class="stringliteral">&quot;_t.tif&quot;</span>))</div>
<div class="line"><a id="l00526" name="l00526"></a><span class="lineno">  526</span>                topoLayer = arcpy.mapping.Layer(topofile)</div>
<div class="line"><a id="l00527" name="l00527"></a><span class="lineno">  527</span>                topoLayer.replaceDataSource(copydir, <span class="stringliteral">&quot;RASTER_WORKSPACE&quot;</span>, newtifname)</div>
<div class="line"><a id="l00528" name="l00528"></a><span class="lineno">  528</span>                topoLayer.name = newtifname</div>
<div class="line"><a id="l00529" name="l00529"></a><span class="lineno">  529</span>                arcpy.mapping.AddLayer(df, topoLayer, <span class="stringliteral">&quot;BOTTOM&quot;</span>)</div>
<div class="line"><a id="l00530" name="l00530"></a><span class="lineno">  530</span> </div>
<div class="line"><a id="l00531" name="l00531"></a><span class="lineno">  531</span>                <span class="keywordflow">if</span> pdfname <span class="keywordflow">in</span> diction_s[year]:</div>
<div class="line"><a id="l00532" name="l00532"></a><span class="lineno">  532</span>                    comps = diction[year][seq].split(<span class="stringliteral">&#39;_&#39;</span>)</div>
<div class="line"><a id="l00533" name="l00533"></a><span class="lineno">  533</span>                    <span class="keywordflow">if</span> int(year)&lt;2008:</div>
<div class="line"><a id="l00534" name="l00534"></a><span class="lineno">  534</span>                        quadname = comps[1] +<span class="stringliteral">&quot;, &quot;</span>+comps[0]</div>
<div class="line"><a id="l00535" name="l00535"></a><span class="lineno">  535</span>                    <span class="keywordflow">else</span>:</div>
<div class="line"><a id="l00536" name="l00536"></a><span class="lineno">  536</span>                        quadname = <span class="stringliteral">&quot; &quot;</span>.join(comps[1:len(comps)-3])+<span class="stringliteral">&quot;, &quot;</span>+comps[0]</div>
<div class="line"><a id="l00537" name="l00537"></a><span class="lineno">  537</span> </div>
<div class="line"><a id="l00538" name="l00538"></a><span class="lineno">  538</span>                    <span class="keywordflow">if</span> quadrangles ==<span class="stringliteral">&quot;&quot;</span>:</div>
<div class="line"><a id="l00539" name="l00539"></a><span class="lineno">  539</span>                        quadrangles = quadname</div>
<div class="line"><a id="l00540" name="l00540"></a><span class="lineno">  540</span>                    <span class="keywordflow">else</span>:</div>
<div class="line"><a id="l00541" name="l00541"></a><span class="lineno">  541</span>                        quadrangles = quadrangles + <span class="stringliteral">&quot;; &quot;</span> + quadname</div>
<div class="line"><a id="l00542" name="l00542"></a><span class="lineno">  542</span> </div>
<div class="line"><a id="l00543" name="l00543"></a><span class="lineno">  543</span>            <span class="keywordflow">else</span>:</div>
<div class="line"><a id="l00544" name="l00544"></a><span class="lineno">  544</span>                <span class="keywordflow">print</span> (<span class="stringliteral">&quot;tif file doesn&#39;t exist &quot;</span> + tifname)</div>
<div class="line"><a id="l00545" name="l00545"></a><span class="lineno">  545</span>                logger.debug(<span class="stringliteral">&quot;tif file doesn&#39;t exist &quot;</span> + tifname)</div>
<div class="line"><a id="l00546" name="l00546"></a><span class="lineno">  546</span>                <span class="keywordflow">if</span> <span class="keywordflow">not</span> os.path.exists(tifdir):</div>
<div class="line"><a id="l00547" name="l00547"></a><span class="lineno">  547</span>                    logger.debug(<span class="stringliteral">&quot;tif dir doesn&#39;t exist &quot;</span> + tifdir)</div>
<div class="line"><a id="l00548" name="l00548"></a><span class="lineno">  548</span>                <span class="keywordflow">else</span>:</div>
<div class="line"><a id="l00549" name="l00549"></a><span class="lineno">  549</span>                    logger.debug(<span class="stringliteral">&quot;tif dir does exist &quot;</span> + tifdir)</div>
<div class="line"><a id="l00550" name="l00550"></a><span class="lineno">  550</span>            seq = seq + 1</div>
<div class="line"><a id="l00551" name="l00551"></a><span class="lineno">  551</span> </div>
<div class="line"><a id="l00552" name="l00552"></a><span class="lineno">  552</span>        df.extent = extentBufferLayer.getSelectedExtent(<span class="keyword">False</span>) <span class="comment"># this helps centre the map</span></div>
<div class="line"><a id="l00553" name="l00553"></a><span class="lineno">  553</span>        df.scale = scale</div>
<div class="line"><a id="l00554" name="l00554"></a><span class="lineno">  554</span>        <span class="keywordflow">for</span> lyr <span class="keywordflow">in</span> arcpy.mapping.ListLayers(mxd, <span class="stringliteral">&quot;&quot;</span>, df):</div>
<div class="line"><a id="l00555" name="l00555"></a><span class="lineno">  555</span>            <span class="keywordflow">if</span> lyr.name == <span class="stringliteral">&quot;Buffer Outline&quot;</span>:</div>
<div class="line"><a id="l00556" name="l00556"></a><span class="lineno">  556</span>                arcpy.mapping.RemoveLayer(df, lyr)</div>
<div class="line"><a id="l00557" name="l00557"></a><span class="lineno">  557</span> </div>
<div class="line"><a id="l00558" name="l00558"></a><span class="lineno">  558</span>        <span class="keywordflow">if</span> is_nova == <span class="stringliteral">&#39;Y&#39;</span>:</div>
<div class="line"><a id="l00559" name="l00559"></a><span class="lineno">  559</span>            yearTextE = arcpy.mapping.ListLayoutElements(mxd, <span class="stringliteral">&quot;TEXT_ELEMENT&quot;</span>, <span class="stringliteral">&quot;year&quot;</span>)[0]</div>
<div class="line"><a id="l00560" name="l00560"></a><span class="lineno">  560</span>            yearTextE.text = year</div>
<div class="line"><a id="l00561" name="l00561"></a><span class="lineno">  561</span> </div>
<div class="line"><a id="l00562" name="l00562"></a><span class="lineno">  562</span>            quadrangleTextE = arcpy.mapping.ListLayoutElements(mxd, <span class="stringliteral">&quot;TEXT_ELEMENT&quot;</span>, <span class="stringliteral">&quot;quadrangle&quot;</span>)[0]</div>
<div class="line"><a id="l00563" name="l00563"></a><span class="lineno">  563</span>            quadrangleTextE.text = <span class="stringliteral">&quot;Quadrangle(s): &quot;</span> + quadrangles</div>
<div class="line"><a id="l00564" name="l00564"></a><span class="lineno">  564</span> </div>
<div class="line"><a id="l00565" name="l00565"></a><span class="lineno">  565</span>            sourceTextE = arcpy.mapping.ListLayoutElements(mxd, <span class="stringliteral">&quot;TEXT_ELEMENT&quot;</span>, <span class="stringliteral">&quot;source&quot;</span>)[0]</div>
<div class="line"><a id="l00566" name="l00566"></a><span class="lineno">  566</span>            sourceTextE.text = <span class="stringliteral">&quot;Source: USGS &quot;</span> + seriesText + <span class="stringliteral">&quot; Minute Topographic Map&quot;</span></div>
<div class="line"><a id="l00567" name="l00567"></a><span class="lineno">  567</span> </div>
<div class="line"><a id="l00568" name="l00568"></a><span class="lineno">  568</span>            projNoTextE = arcpy.mapping.ListLayoutElements(mxd, <span class="stringliteral">&quot;TEXT_ELEMENT&quot;</span>, <span class="stringliteral">&quot;projno&quot;</span>)[0]</div>
<div class="line"><a id="l00569" name="l00569"></a><span class="lineno">  569</span>            projNoTextE.text = <span class="stringliteral">&quot;Project No. &quot;</span>+ProjNo</div>
<div class="line"><a id="l00570" name="l00570"></a><span class="lineno">  570</span> </div>
<div class="line"><a id="l00571" name="l00571"></a><span class="lineno">  571</span>            siteNameTextE = arcpy.mapping.ListLayoutElements(mxd, <span class="stringliteral">&quot;TEXT_ELEMENT&quot;</span>, <span class="stringliteral">&quot;sitename&quot;</span>)[0]</div>
<div class="line"><a id="l00572" name="l00572"></a><span class="lineno">  572</span>            siteNameTextE.text = <span class="stringliteral">&quot;Site Name: &quot;</span>+Sitename+<span class="stringliteral">&#39;,&#39;</span>+AddressText</div>
<div class="line"><a id="l00573" name="l00573"></a><span class="lineno">  573</span> </div>
<div class="line"><a id="l00574" name="l00574"></a><span class="lineno">  574</span>            ordernoTextE = arcpy.mapping.ListLayoutElements(mxd, <span class="stringliteral">&quot;TEXT_ELEMENT&quot;</span>, <span class="stringliteral">&quot;orderno&quot;</span>)[0]</div>
<div class="line"><a id="l00575" name="l00575"></a><span class="lineno">  575</span>            ordernoTextE.text = <span class="stringliteral">&quot;Order No. &quot;</span>+ OrderNumText</div>
<div class="line"><a id="l00576" name="l00576"></a><span class="lineno">  576</span>        <span class="keywordflow">else</span>:</div>
<div class="line"><a id="l00577" name="l00577"></a><span class="lineno">  577</span>            yearTextE = arcpy.mapping.ListLayoutElements(mxd, <span class="stringliteral">&quot;TEXT_ELEMENT&quot;</span>, <span class="stringliteral">&quot;year&quot;</span>)[0]</div>
<div class="line"><a id="l00578" name="l00578"></a><span class="lineno">  578</span>            yearTextE.text = year</div>
<div class="line"><a id="l00579" name="l00579"></a><span class="lineno">  579</span>            yearTextE.elementPositionX = 0.4959</div>
<div class="line"><a id="l00580" name="l00580"></a><span class="lineno">  580</span> </div>
<div class="line"><a id="l00581" name="l00581"></a><span class="lineno">  581</span>            quadrangleTextE = arcpy.mapping.ListLayoutElements(mxd, <span class="stringliteral">&quot;TEXT_ELEMENT&quot;</span>, <span class="stringliteral">&quot;quadrangle&quot;</span>)[0]</div>
<div class="line"><a id="l00582" name="l00582"></a><span class="lineno">  582</span>            quadrangleTextE.text = <span class="stringliteral">&quot;Quadrangle(s): &quot;</span> + quadrangles</div>
<div class="line"><a id="l00583" name="l00583"></a><span class="lineno">  583</span>            quadrangleTextE.elementPositionX = 0.44</div>
<div class="line"><a id="l00584" name="l00584"></a><span class="lineno">  584</span>            quadrangleTextE.elementPositionY = 0.3875</div>
<div class="line"><a id="l00585" name="l00585"></a><span class="lineno">  585</span> </div>
<div class="line"><a id="l00586" name="l00586"></a><span class="lineno">  586</span>            sourceTextE = arcpy.mapping.ListLayoutElements(mxd, <span class="stringliteral">&quot;TEXT_ELEMENT&quot;</span>, <span class="stringliteral">&quot;source&quot;</span>)[0]</div>
<div class="line"><a id="l00587" name="l00587"></a><span class="lineno">  587</span>            <span class="comment"># sourceTextE.text = &quot;Source: USGS &quot; + seriesText + &quot; Minute Topographic Map&quot;  + &quot;   -- scale is &quot; + str(df.scale)</span></div>
<div class="line"><a id="l00588" name="l00588"></a><span class="lineno">  588</span>            sourceTextE.text = <span class="stringliteral">&quot;Source: USGS &quot;</span> + seriesText + <span class="stringliteral">&quot; Minute Topographic Map&quot;</span></div>
<div class="line"><a id="l00589" name="l00589"></a><span class="lineno">  589</span>            sourceTextE.elementPositionX = 0.4959</div>
<div class="line"><a id="l00590" name="l00590"></a><span class="lineno">  590</span> </div>
<div class="line"><a id="l00591" name="l00591"></a><span class="lineno">  591</span>            ordernoTextE = arcpy.mapping.ListLayoutElements(mxd, <span class="stringliteral">&quot;TEXT_ELEMENT&quot;</span>, <span class="stringliteral">&quot;orderno&quot;</span>)[0]</div>
<div class="line"><a id="l00592" name="l00592"></a><span class="lineno">  592</span>            ordernoTextE.text = <span class="stringliteral">&quot;Order No. &quot;</span>+ OrderNumText</div>
<div class="line"><a id="l00593" name="l00593"></a><span class="lineno">  593</span> </div>
<div class="line"><a id="l00594" name="l00594"></a><span class="lineno">  594</span>        <span class="keywordflow">if</span> is_newLogofile == <span class="stringliteral">&#39;Y&#39;</span>:     <span class="comment"># need to change logo for emg</span></div>
<div class="line"><a id="l00595" name="l00595"></a><span class="lineno">  595</span>            logoE = arcpy.mapping.ListLayoutElements(mxd, <span class="stringliteral">&quot;PICTURE_ELEMENT&quot;</span>, <span class="stringliteral">&quot;logo&quot;</span>)[0]</div>
<div class="line"><a id="l00596" name="l00596"></a><span class="lineno">  596</span>            logoE.sourceImage = os.path.join(logopath, newlogofile)</div>
<div class="line"><a id="l00597" name="l00597"></a><span class="lineno">  597</span> </div>
<div class="line"><a id="l00598" name="l00598"></a><span class="lineno">  598</span>        <span class="comment"># arcpy.mapping.RemoveLayer(df,extentBufferLayer) # this is not working</span></div>
<div class="line"><a id="l00599" name="l00599"></a><span class="lineno">  599</span>        arcpy.RefreshTOC()</div>
<div class="line"><a id="l00600" name="l00600"></a><span class="lineno">  600</span>        outputpdf = os.path.join(scratch, <span class="stringliteral">&quot;map_&quot;</span>+seriesText+<span class="stringliteral">&quot;_&quot;</span>+year+<span class="stringliteral">&quot;.pdf&quot;</span>)</div>
<div class="line"><a id="l00601" name="l00601"></a><span class="lineno">  601</span>        <span class="keywordflow">if</span> int(year)&lt;2008:</div>
<div class="line"><a id="l00602" name="l00602"></a><span class="lineno">  602</span>            arcpy.mapping.ExportToPDF(mxd, outputpdf, <span class="stringliteral">&quot;PAGE_LAYOUT&quot;</span>, 640, 480, 250, <span class="stringliteral">&quot;BEST&quot;</span>, <span class="stringliteral">&quot;RGB&quot;</span>, <span class="keyword">True</span>, <span class="stringliteral">&quot;ADAPTIVE&quot;</span>, <span class="stringliteral">&quot;RASTERIZE_BITMAP&quot;</span>, <span class="keyword">False</span>, <span class="keyword">True</span>, <span class="stringliteral">&quot;LAYERS_AND_ATTRIBUTES&quot;</span>, <span class="keyword">True</span>, 90)</div>
<div class="line"><a id="l00603" name="l00603"></a><span class="lineno">  603</span>        <span class="keywordflow">else</span>:</div>
<div class="line"><a id="l00604" name="l00604"></a><span class="lineno">  604</span>            arcpy.mapping.ExportToPDF(mxd, outputpdf, <span class="stringliteral">&quot;PAGE_LAYOUT&quot;</span>, 640, 480, 350, <span class="stringliteral">&quot;BEST&quot;</span>, <span class="stringliteral">&quot;RGB&quot;</span>, <span class="keyword">True</span>, <span class="stringliteral">&quot;ADAPTIVE&quot;</span>, <span class="stringliteral">&quot;RASTERIZE_BITMAP&quot;</span>, <span class="keyword">False</span>, <span class="keyword">True</span>, <span class="stringliteral">&quot;LAYERS_AND_ATTRIBUTES&quot;</span>, <span class="keyword">True</span>, 90)</div>
<div class="line"><a id="l00605" name="l00605"></a><span class="lineno">  605</span> </div>
<div class="line"><a id="l00606" name="l00606"></a><span class="lineno">  606</span>        <span class="comment"># outputPDF.appendPages(outputpdf)</span></div>
<div class="line"><a id="l00607" name="l00607"></a><span class="lineno">  607</span>        <span class="keywordflow">if</span> seriesText == <span class="stringliteral">&quot;7.5&quot;</span>:</div>
<div class="line"><a id="l00608" name="l00608"></a><span class="lineno">  608</span>            <span class="comment"># mxd.relativePaths = True</span></div>
<div class="line"><a id="l00609" name="l00609"></a><span class="lineno">  609</span>            mxd.saveACopy(os.path.join(scratch,<span class="stringliteral">&quot;75_&quot;</span>+year+<span class="stringliteral">&quot;.mxd&quot;</span>))</div>
<div class="line"><a id="l00610" name="l00610"></a><span class="lineno">  610</span>        <span class="keywordflow">else</span>:</div>
<div class="line"><a id="l00611" name="l00611"></a><span class="lineno">  611</span>            <span class="comment"># mxd.relativePaths = True</span></div>
<div class="line"><a id="l00612" name="l00612"></a><span class="lineno">  612</span>            mxd.saveACopy(os.path.join(scratch,<span class="stringliteral">&quot;15_&quot;</span>+year+<span class="stringliteral">&quot;.mxd&quot;</span>))</div>
<div class="line"><a id="l00613" name="l00613"></a><span class="lineno">  613</span> </div>
<div class="line"><a id="l00614" name="l00614"></a><span class="lineno">  614</span>        <span class="keywordflow">if</span> (yesBoundary.lower() == <span class="stringliteral">&#39;yes&#39;</span> <span class="keywordflow">and</span> (OrderType.lower() == <span class="stringliteral">&quot;polyline&quot;</span> <span class="keywordflow">or</span> OrderType.lower() == <span class="stringliteral">&quot;polygon&quot;</span>)):</div>
<div class="line"><a id="l00615" name="l00615"></a><span class="lineno">  615</span> </div>
<div class="line"><a id="l00616" name="l00616"></a><span class="lineno">  616</span>            <span class="keywordflow">if</span> firstTime:</div>
<div class="line"><a id="l00617" name="l00617"></a><span class="lineno">  617</span>                <span class="comment"># remove all other layers</span></div>
<div class="line"><a id="l00618" name="l00618"></a><span class="lineno">  618</span>                scale2use = df.scale</div>
<div class="line"><a id="l00619" name="l00619"></a><span class="lineno">  619</span>                <span class="keywordflow">for</span> lyr <span class="keywordflow">in</span> arcpy.mapping.ListLayers(mxd, <span class="stringliteral">&quot;&quot;</span>, df):</div>
<div class="line"><a id="l00620" name="l00620"></a><span class="lineno">  620</span>                    arcpy.mapping.RemoveLayer(df, lyr)</div>
<div class="line"><a id="l00621" name="l00621"></a><span class="lineno">  621</span>                arcpy.mapping.AddLayer(df,orderGeomLayer,<span class="stringliteral">&quot;Top&quot;</span>) <span class="comment">#the layer is visible</span></div>
<div class="line"><a id="l00622" name="l00622"></a><span class="lineno">  622</span>                df.scale = scale2use</div>
<div class="line"><a id="l00623" name="l00623"></a><span class="lineno">  623</span>                shapePdf = os.path.join(scratch, <span class="stringliteral">&#39;shape.pdf&#39;</span>)</div>
<div class="line"><a id="l00624" name="l00624"></a><span class="lineno">  624</span>                arcpy.mapping.ExportToPDF(mxd, shapePdf, <span class="stringliteral">&quot;PAGE_LAYOUT&quot;</span>, 640, 480, 250, <span class="stringliteral">&quot;BEST&quot;</span>, <span class="stringliteral">&quot;RGB&quot;</span>, <span class="keyword">True</span>, <span class="stringliteral">&quot;ADAPTIVE&quot;</span>, <span class="stringliteral">&quot;RASTERIZE_BITMAP&quot;</span>, <span class="keyword">False</span>, <span class="keyword">True</span>, <span class="stringliteral">&quot;LAYERS_AND_ATTRIBUTES&quot;</span>, <span class="keyword">True</span>, 90)</div>
<div class="line"><a id="l00625" name="l00625"></a><span class="lineno">  625</span>                <span class="comment"># create the a pdf with annotation just once</span></div>
<div class="line"><a id="l00626" name="l00626"></a><span class="lineno">  626</span>                myAnnotPdf = <a class="code hl_function" href="namespace_u_s_topo_search__prod.html#a26dc023affb68a675d2fc047155d2331">createAnnotPdf</a>(OrderType, shapePdf)</div>
<div class="line"><a id="l00627" name="l00627"></a><span class="lineno">  627</span>                firstTime = <span class="keyword">False</span></div>
<div class="line"><a id="l00628" name="l00628"></a><span class="lineno">  628</span> </div>
<div class="line"><a id="l00629" name="l00629"></a><span class="lineno">  629</span>            <span class="comment"># merge annotation pdf to the map</span></div>
<div class="line"><a id="l00630" name="l00630"></a><span class="lineno">  630</span>            Topopdf = <a class="code hl_function" href="namespace_u_s_topo_search__prod.html#af5daa83a32a5322129ee46ab6d259df5">annotatePdf</a>(outputpdf, myAnnotPdf)</div>
<div class="line"><a id="l00631" name="l00631"></a><span class="lineno">  631</span>            outputpdf = Topopdf</div>
<div class="line"><a id="l00632" name="l00632"></a><span class="lineno">  632</span> </div>
<div class="line"><a id="l00633" name="l00633"></a><span class="lineno">  633</span>        outputPDF.appendPages(outputpdf)</div>
<div class="line"><a id="l00634" name="l00634"></a><span class="lineno">  634</span> </div>
<div class="line"><a id="l00635" name="l00635"></a><span class="lineno">  635</span>    outputPDF.saveAndClose()</div>
<div class="line"><a id="l00636" name="l00636"></a><span class="lineno">  636</span>    <span class="keywordflow">return</span> <span class="stringliteral">&quot;Success! :)&quot;</span></div>
<div class="line"><a id="l00637" name="l00637"></a><span class="lineno">  637</span> </div>
<div class="line"><a id="l00638" name="l00638"></a><span class="lineno"><a class="line" href="namespace_u_s_topo_search__prod.html#a6606cbc50b96adcf15588a7e3f29b812">  638</a></span><span class="keyword">def </span><a class="code hl_function" href="namespace_u_s_topo_search__prod.html#a6606cbc50b96adcf15588a7e3f29b812">zipdir</a>(path, zip):</div>
<div class="line"><a id="l00639" name="l00639"></a><span class="lineno">  639</span>    <span class="keywordflow">for</span> root, dirs, files <span class="keywordflow">in</span> os.walk(path):</div>
<div class="line"><a id="l00640" name="l00640"></a><span class="lineno">  640</span>        <span class="keywordflow">for</span> file <span class="keywordflow">in</span> files:</div>
<div class="line"><a id="l00641" name="l00641"></a><span class="lineno">  641</span>            <span class="comment"># print file + &quot; &quot; + root</span></div>
<div class="line"><a id="l00642" name="l00642"></a><span class="lineno">  642</span>            arcname = os.path.relpath(os.path.join(root, file), os.path.join(path, <span class="stringliteral">&#39;..&#39;</span>))</div>
<div class="line"><a id="l00643" name="l00643"></a><span class="lineno">  643</span>            zip.write(os.path.join(root, file), arcname)</div>
<div class="line"><a id="l00644" name="l00644"></a><span class="lineno">  644</span> </div>
<div class="line"><a id="l00645" name="l00645"></a><span class="lineno"><a class="line" href="namespace_u_s_topo_search__prod.html#a81fffaa55bcc1d1fdd107c33b28d967a">  645</a></span>logger = logging.getLogger(__name__)</div>
<div class="line"><a id="l00646" name="l00646"></a><span class="lineno">  646</span>logger.setLevel(logging.DEBUG)</div>
<div class="line"><a id="l00647" name="l00647"></a><span class="lineno"><a class="line" href="namespace_u_s_topo_search__prod.html#a61f3c718746b75c61111eb50100ebe9a">  647</a></span>handler = logging.FileHandler(<span class="stringliteral">r&#39;\\cabcvan1gis006\GISData\Topo_USA\python\log\USTopoSearch_Log.txt&#39;</span>)</div>
<div class="line"><a id="l00648" name="l00648"></a><span class="lineno">  648</span>handler.setLevel(logging.DEBUG)</div>
<div class="line"><a id="l00649" name="l00649"></a><span class="lineno">  649</span>logger.addHandler(handler)</div>
<div class="line"><a id="l00650" name="l00650"></a><span class="lineno">  650</span> </div>
<div class="line"><a id="l00651" name="l00651"></a><span class="lineno">  651</span><span class="comment"># -----------------------------------------------------------------------------------------------------------------------------------------------</span></div>
<div class="line"><a id="l00652" name="l00652"></a><span class="lineno">  652</span><span class="comment"># OrderIDText = arcpy.GetParameterAsText(0)#&#39;734618&#39;#</span></div>
<div class="line"><a id="l00653" name="l00653"></a><span class="lineno">  653</span><span class="comment"># BufsizeText = arcpy.GetParameterAsText(1)#&#39;2.4&#39;</span></div>
<div class="line"><a id="l00654" name="l00654"></a><span class="lineno">  654</span><span class="comment"># yesBoundary = arcpy.GetParameterAsText(2)#&#39;no&#39;##</span></div>
<div class="line"><a id="l00655" name="l00655"></a><span class="lineno">  655</span><span class="comment"># scratch = arcpy.env.scratchWorkspace#r&quot;C:\Users\JLoucks\Documents\JL\Topo_USA_scratch8&quot;#</span></div>
<div class="line"><a id="l00656" name="l00656"></a><span class="lineno">  656</span> </div>
<div class="line"><a id="l00657" name="l00657"></a><span class="lineno"><a class="line" href="namespace_u_s_topo_search__prod.html#af3f469202d36b1110827d45378e49164">  657</a></span>OrderIDText = <span class="stringliteral">&quot;&quot;</span></div>
<div class="line"><a id="l00658" name="l00658"></a><span class="lineno"><a class="line" href="namespace_u_s_topo_search__prod.html#a09709b80f570352e5ad2ed92d122d84f">  658</a></span>OrderNumText = <span class="stringliteral">r&quot;21052600036&quot;</span></div>
<div class="line"><a id="l00659" name="l00659"></a><span class="lineno"><a class="line" href="namespace_u_s_topo_search__prod.html#aca44f67da8dbb4d496e2b6aae1adc768">  659</a></span>BufsizeText = <span class="stringliteral">&quot;2.4&quot;</span></div>
<div class="line"><a id="l00660" name="l00660"></a><span class="lineno"><a class="line" href="namespace_u_s_topo_search__prod.html#ac0e14adb93a5193dca54b0fb25dd0282">  660</a></span>yesBoundary = <span class="stringliteral">&quot;&quot;</span></div>
<div class="line"><a id="l00661" name="l00661"></a><span class="lineno"><a class="line" href="namespace_u_s_topo_search__prod.html#a24fffdb8abc6c6df67c37b47c3a0ba56">  661</a></span>scratch = arcpy.env.scratchFolder</div>
<div class="line"><a id="l00662" name="l00662"></a><span class="lineno">  662</span>print(scratch)</div>
<div class="line"><a id="l00663" name="l00663"></a><span class="lineno">  663</span><span class="comment"># Deployment parameters</span></div>
<div class="line"><a id="l00664" name="l00664"></a><span class="lineno"><a class="line" href="namespace_u_s_topo_search__prod.html#a61cd0411c04c06a3a06106f25fb6180c">  664</a></span>server_environment = <span class="stringliteral">&#39;prod&#39;</span></div>
<div class="line"><a id="l00665" name="l00665"></a><span class="lineno"><a class="line" href="namespace_u_s_topo_search__prod.html#a58bc44cefdf4e0f7c60291cfafa5a08c">  665</a></span>server_config_file = <span class="stringliteral">r&quot;\\cabcvan1gis007\gptools\ERISServerConfig.ini&quot;</span></div>
<div class="line"><a id="l00666" name="l00666"></a><span class="lineno"><a class="line" href="namespace_u_s_topo_search__prod.html#a3c8b49c490f02ef7d9a44eb58a52df54">  666</a></span>server_config = <a class="code hl_function" href="namespace_u_s_topo_search__prod.html#abf2fdbd132aebef3a75b8c5b2e7778c0">server_loc_config</a>(server_config_file,server_environment)</div>
<div class="line"><a id="l00667" name="l00667"></a><span class="lineno"><a class="line" href="namespace_u_s_topo_search__prod.html#a93de358928d70fd7902cad6293645fe3">  667</a></span>connectionString = <span class="stringliteral">&#39;eris_gis/gis295@cabcvan1ora003.glaciermedia.inc:1521/GMPRODC&#39;</span><span class="comment">#&#39;ERIS_GIS/gis295@GMPRODC.glaciermedia.inc&#39;</span></div>
<div class="line"><a id="l00668" name="l00668"></a><span class="lineno"><a class="line" href="namespace_u_s_topo_search__prod.html#a98560a85f0e5ae6996665702cf49595f">  668</a></span>reportcheckFolder = server_config[<span class="stringliteral">&quot;reportcheck&quot;</span>]</div>
<div class="line"><a id="l00669" name="l00669"></a><span class="lineno"><a class="line" href="namespace_u_s_topo_search__prod.html#ac65b4d8ab24f7055537888c1951c854d">  669</a></span>viewerFolder = server_config[<span class="stringliteral">&quot;viewer&quot;</span>]</div>
<div class="line"><a id="l00670" name="l00670"></a><span class="lineno"><a class="line" href="namespace_u_s_topo_search__prod.html#a65369b64e1d614197fe6787b39d328d0">  670</a></span>topouploadurl =  server_config[<span class="stringliteral">&quot;viewer_upload&quot;</span>] + <span class="stringliteral">r&quot;/ErisInt/BIPublisherPortal_prod/Viewer.svc/TopoUpload?ordernumber=&quot;</span></div>
<div class="line"><a id="l00671" name="l00671"></a><span class="lineno">  671</span> </div>
<div class="line"><a id="l00672" name="l00672"></a><span class="lineno"><a class="line" href="namespace_u_s_topo_search__prod.html#a4e9bb1ec2f31b570232ad4274410a12d">  672</a></span>filepath = <span class="stringliteral">r&#39;\\cabcvan1gis006\GISData\Topo_USA\python\mxd&#39;</span></div>
<div class="line"><a id="l00673" name="l00673"></a><span class="lineno"><a class="line" href="namespace_u_s_topo_search__prod.html#a5faf6aa5734087c60e560ad6f01ab84d">  673</a></span>connectionPath = <span class="stringliteral">r&#39;\\cabcvan1gis006\GISData\Topo_USA\python&#39;</span></div>
<div class="line"><a id="l00674" name="l00674"></a><span class="lineno"><a class="line" href="namespace_u_s_topo_search__prod.html#a8d20766e284e50822b643671f875daab">  674</a></span>masterlyr = <span class="stringliteral">r&#39;\\cabcvan1gis006\GISData\Topo_USA\masterfile\Cell_PolygonAll.shp&#39;</span></div>
<div class="line"><a id="l00675" name="l00675"></a><span class="lineno"><a class="line" href="namespace_u_s_topo_search__prod.html#a76050c05f5edd158f78823e2507018c8">  675</a></span>csvfile_h = <span class="stringliteral">r&#39;\\cabcvan1gis006\GISData\Topo_USA\masterfile\All_HTMC_all_all_gda_results.csv&#39;</span></div>
<div class="line"><a id="l00676" name="l00676"></a><span class="lineno"><a class="line" href="namespace_u_s_topo_search__prod.html#ad2c54f08512093d5993c34845510f5e6">  676</a></span>csvfile_c = <span class="stringliteral">r&#39;\\cabcvan1gis006\GISData\Topo_USA\masterfile\All_USTopo_T_7.5_gda_results.csv&#39;</span></div>
<div class="line"><a id="l00677" name="l00677"></a><span class="lineno"><a class="line" href="namespace_u_s_topo_search__prod.html#af67e4bd98d3ddb8c8f605a4f1f308cda">  677</a></span>tifdir_h = <span class="stringliteral">r&#39;\\cabcvan1fpr009\USGS_Topo\USGS_HTMC_Geotiff&#39;</span></div>
<div class="line"><a id="l00678" name="l00678"></a><span class="lineno">  678</span><span class="comment"># tifdir_c = r&quot;Y:\TOPO_DATA_USA\USGS_currentTopo_Geotiff&quot;</span></div>
<div class="line"><a id="l00679" name="l00679"></a><span class="lineno"><a class="line" href="namespace_u_s_topo_search__prod.html#ab7ef12a85b95b404411498ba4714f841">  679</a></span>tifdir_c = <span class="stringliteral">r&#39;\\cabcvan1fpr009\USGS_Topo\USGS_currentTopo_Geotiff&#39;</span></div>
<div class="line"><a id="l00680" name="l00680"></a><span class="lineno"><a class="line" href="namespace_u_s_topo_search__prod.html#a5703b43590d6064f4848a5b25398aab2">  680</a></span>mxdfile = os.path.join(filepath,<span class="stringliteral">&quot;template.mxd&quot;</span>)</div>
<div class="line"><a id="l00681" name="l00681"></a><span class="lineno"><a class="line" href="namespace_u_s_topo_search__prod.html#a01214052366b763ebf2354abdd5963fb">  681</a></span>mxdfile_nova = os.path.join(filepath,<span class="stringliteral">&#39;template_nova_t.mxd&#39;</span>)</div>
<div class="line"><a id="l00682" name="l00682"></a><span class="lineno"><a class="line" href="namespace_u_s_topo_search__prod.html#a9eaa4d6cd9a8349edcb2f3c7e8a3b418">  682</a></span>topolyrfile_none = os.path.join(filepath,<span class="stringliteral">&quot;topo.lyr&quot;</span>)</div>
<div class="line"><a id="l00683" name="l00683"></a><span class="lineno"><a class="line" href="namespace_u_s_topo_search__prod.html#ab9af52bcc135c759481f4f2649836d1f">  683</a></span>topolyrfile_b = os.path.join(filepath,<span class="stringliteral">&quot;topo_black.lyr&quot;</span>)</div>
<div class="line"><a id="l00684" name="l00684"></a><span class="lineno"><a class="line" href="namespace_u_s_topo_search__prod.html#a63a7e6894071faf517decc9d875d5317">  684</a></span>topolyrfile_w = os.path.join(filepath,<span class="stringliteral">&quot;topo_white.lyr&quot;</span>)</div>
<div class="line"><a id="l00685" name="l00685"></a><span class="lineno"><a class="line" href="namespace_u_s_topo_search__prod.html#a9b1b190ed2c1524bdf796013f294580f">  685</a></span>bufferlyrfile = os.path.join(filepath,<span class="stringliteral">&quot;buffer_extent.lyr&quot;</span>)</div>
<div class="line"><a id="l00686" name="l00686"></a><span class="lineno"><a class="line" href="namespace_u_s_topo_search__prod.html#a1c4129b06c732dfa38eeeb95d81fa82b">  686</a></span>orderGeomlyrfile_point = os.path.join(filepath,<span class="stringliteral">&quot;SiteMaker.lyr&quot;</span>)</div>
<div class="line"><a id="l00687" name="l00687"></a><span class="lineno"><a class="line" href="namespace_u_s_topo_search__prod.html#a88561d95b7d803f62e371a5a85aa136f">  687</a></span>orderGeomlyrfile_polyline = os.path.join(filepath,<span class="stringliteral">&quot;orderLine.lyr&quot;</span>)</div>
<div class="line"><a id="l00688" name="l00688"></a><span class="lineno"><a class="line" href="namespace_u_s_topo_search__prod.html#a1ca648f627b9b2e7590b2cf97cac414f">  688</a></span>orderGeomlyrfile_polygon = os.path.join(filepath,<span class="stringliteral">&quot;orderPoly.lyr&quot;</span>)</div>
<div class="line"><a id="l00689" name="l00689"></a><span class="lineno"><a class="line" href="namespace_u_s_topo_search__prod.html#a550d65a8b29ba8cb1bf40603b725832b">  689</a></span>readmefile = os.path.join(filepath,<span class="stringliteral">&quot;readme.txt&quot;</span>)</div>
<div class="line"><a id="l00690" name="l00690"></a><span class="lineno">  690</span><span class="comment"># erislogopdf = r&quot;\\cabcvan1gis006\GISData\Topo_USA\python\mxd\erislogo.pdf&quot;</span></div>
<div class="line"><a id="l00691" name="l00691"></a><span class="lineno"><a class="line" href="namespace_u_s_topo_search__prod.html#a78facc30369fb1bb2fe34695617a679f">  691</a></span>erislogojpg = os.path.join(filepath,<span class="stringliteral">&quot;ERIS agency logo.jpg&quot;</span>)</div>
<div class="line"><a id="l00692" name="l00692"></a><span class="lineno">  692</span><span class="comment"># emglogopdf = r&quot;\\cabcvan1gis006\GISData\Topo_USA\python\mxd\emglogo.pdf&quot;</span></div>
<div class="line"><a id="l00693" name="l00693"></a><span class="lineno"><a class="line" href="namespace_u_s_topo_search__prod.html#a5c26fd2da145750d9549baefce7ff305">  693</a></span>emglogopng = os.path.join(filepath,<span class="stringliteral">&quot;emglogo.png&quot;</span>)</div>
<div class="line"><a id="l00694" name="l00694"></a><span class="lineno"><a class="line" href="namespace_u_s_topo_search__prod.html#a188712406403581974f1414d6d0348a1">  694</a></span>annot_poly = os.path.join(filepath,<span class="stringliteral">&quot;annot_poly.pdf&quot;</span>)</div>
<div class="line"><a id="l00695" name="l00695"></a><span class="lineno"><a class="line" href="namespace_u_s_topo_search__prod.html#a6ea758a14e353d63037b35e727b13d24">  695</a></span>annot_line = os.path.join(filepath,<span class="stringliteral">&quot;annot_line.pdf&quot;</span>)</div>
<div class="line"><a id="l00696" name="l00696"></a><span class="lineno"><a class="line" href="namespace_u_s_topo_search__prod.html#a5c9f9b05b3a8c06bb2e95f03b6a8fafe">  696</a></span>logopath = os.path.join(filepath,<span class="stringliteral">&quot;logos&quot;</span>)</div>
<div class="line"><a id="l00697" name="l00697"></a><span class="lineno"><a class="line" href="namespace_u_s_topo_search__prod.html#a15e489f3348dcd079b91cd2380217514">  697</a></span>coverPic = os.path.join(filepath,<span class="stringliteral">&quot;ERIS_2018_ReportCover_Topographic Maps_F.jpg&quot;</span>)</div>
<div class="line"><a id="l00698" name="l00698"></a><span class="lineno">  698</span>arcpy.env.overwriteOutput = <span class="keyword">True</span></div>
<div class="line"><a id="l00699" name="l00699"></a><span class="lineno"><a class="line" href="namespace_u_s_topo_search__prod.html#ac99625ae9e35870e40e341b1f2acf876">  699</a></span>arcpy.env.OverWriteOutput = <span class="keyword">True</span></div>
<div class="line"><a id="l00700" name="l00700"></a><span class="lineno">  700</span><span class="comment"># -----------------------------------------------------------------------------------------------------------------------------------------------</span></div>
<div class="line"><a id="l00701" name="l00701"></a><span class="lineno">  701</span> </div>
<div class="line"><a id="l00702" name="l00702"></a><span class="lineno">  702</span><span class="keywordflow">try</span>:</div>
<div class="line"><a id="l00703" name="l00703"></a><span class="lineno">  703</span>    <span class="keywordflow">try</span>:</div>
<div class="line"><a id="l00704" name="l00704"></a><span class="lineno">  704</span>        <span class="comment"># OrderNum = str(raw_input(&quot;Enter Order Number:&quot;)).strip()</span></div>
<div class="line"><a id="l00705" name="l00705"></a><span class="lineno"><a class="line" href="namespace_u_s_topo_search__prod.html#ab1370092c9cbe230295d33e586b77ffe">  705</a></span>        con = cx_Oracle.connect(connectionString)</div>
<div class="line"><a id="l00706" name="l00706"></a><span class="lineno"><a class="line" href="namespace_u_s_topo_search__prod.html#a2e4531279b9388fc2bf7d3979045c086">  706</a></span>        cur = con.cursor()</div>
<div class="line"><a id="l00707" name="l00707"></a><span class="lineno">  707</span> </div>
<div class="line"><a id="l00708" name="l00708"></a><span class="lineno">  708</span>        <span class="comment"># GET ORDER_ID AND BOUNDARY FROM ORDER_NUM</span></div>
<div class="line"><a id="l00709" name="l00709"></a><span class="lineno">  709</span>        <span class="keywordflow">if</span> OrderIDText == <span class="stringliteral">&quot;&quot;</span>:</div>
<div class="line"><a id="l00710" name="l00710"></a><span class="lineno">  710</span>            cur.execute(<span class="stringliteral">&quot;SELECT * FROM ERIS.TOPO_AUDIT WHERE ORDER_ID IN (select order_id from orders where order_num = &#39;&quot;</span> + str(OrderNumText) + <span class="stringliteral">&quot;&#39;)&quot;</span>)</div>
<div class="line"><a id="l00711" name="l00711"></a><span class="lineno"><a class="line" href="namespace_u_s_topo_search__prod.html#a6d693c9f252a518deab3944c73d3b9cc">  711</a></span>            result = cur.fetchall()</div>
<div class="line"><a id="l00712" name="l00712"></a><span class="lineno">  712</span>            OrderIDText = str(result[0][0]).strip()</div>
<div class="line"><a id="l00713" name="l00713"></a><span class="lineno"><a class="line" href="namespace_u_s_topo_search__prod.html#a20606fb705e3c6fc170ab4331272cebb">  713</a></span>            yesBoundaryqry = str([row[3] <span class="keywordflow">for</span> row <span class="keywordflow">in</span> result <span class="keywordflow">if</span> row[2]== <span class="stringliteral">&quot;URL&quot;</span>][0])</div>
<div class="line"><a id="l00714" name="l00714"></a><span class="lineno">  714</span>            yesBoundary = re.search(<span class="stringliteral">&#39;(yesBoundary=)(\w+)(&amp;)&#39;</span>, yesBoundaryqry).group(2).strip()</div>
<div class="line"><a id="l00715" name="l00715"></a><span class="lineno">  715</span>            print(<span class="stringliteral">&quot;Order ID: &quot;</span> + OrderIDText)</div>
<div class="line"><a id="l00716" name="l00716"></a><span class="lineno">  716</span>            print(<span class="stringliteral">&quot;Yes Boundary: &quot;</span> + yesBoundary)</div>
<div class="line"><a id="l00717" name="l00717"></a><span class="lineno">  717</span> </div>
<div class="line"><a id="l00718" name="l00718"></a><span class="lineno">  718</span>        cur.execute(<span class="stringliteral">&quot;select order_num from orders where order_id=&#39;%s&#39;&quot;</span>%(OrderIDText))</div>
<div class="line"><a id="l00719" name="l00719"></a><span class="lineno"><a class="line" href="namespace_u_s_topo_search__prod.html#a92aa9061d2d51d7d5170c8216b6a51cf">  719</a></span>        t = cur.fetchone()</div>
<div class="line"><a id="l00720" name="l00720"></a><span class="lineno"><a class="line" href="namespace_u_s_topo_search__prod.html#a6c0baca0b8196bac218bcb883718fc58">  720</a></span>        OrderNum = str(t[0])</div>
<div class="line"><a id="l00721" name="l00721"></a><span class="lineno">  721</span> </div>
<div class="line"><a id="l00722" name="l00722"></a><span class="lineno">  722</span>    <span class="keywordflow">finally</span>:</div>
<div class="line"><a id="l00723" name="l00723"></a><span class="lineno">  723</span>        cur.close()</div>
<div class="line"><a id="l00724" name="l00724"></a><span class="lineno">  724</span>        con.close()</div>
<div class="line"><a id="l00725" name="l00725"></a><span class="lineno">  725</span> </div>
<div class="line"><a id="l00726" name="l00726"></a><span class="lineno">  726</span>    <span class="keywordflow">try</span>:</div>
<div class="line"><a id="l00727" name="l00727"></a><span class="lineno">  727</span>        con = cx_Oracle.connect(connectionString)</div>
<div class="line"><a id="l00728" name="l00728"></a><span class="lineno">  728</span>        cur = con.cursor()</div>
<div class="line"><a id="l00729" name="l00729"></a><span class="lineno">  729</span> </div>
<div class="line"><a id="l00730" name="l00730"></a><span class="lineno"><a class="line" href="namespace_u_s_topo_search__prod.html#af5b1857a11430ed32d3b215f3f09485e">  730</a></span>        coverInfotext = json.loads(cur.callfunc(<span class="stringliteral">&#39;eris_gis.getCoverPageInfo&#39;</span>, str, (str(OrderIDText),)))</div>
<div class="line"><a id="l00731" name="l00731"></a><span class="lineno">  731</span> </div>
<div class="line"><a id="l00732" name="l00732"></a><span class="lineno">  732</span>        OrderNumText = str(coverInfotext[<span class="stringliteral">&quot;ORDER_NUM&quot;</span>])</div>
<div class="line"><a id="l00733" name="l00733"></a><span class="lineno"><a class="line" href="namespace_u_s_topo_search__prod.html#a8da6b98982d556d2b65ff69284e1ff40">  733</a></span>        Sitename =coverInfotext[<span class="stringliteral">&quot;SITE_NAME&quot;</span>]</div>
<div class="line"><a id="l00734" name="l00734"></a><span class="lineno">  734</span>        <span class="keywordflow">if</span> len(Sitename) &gt; 40:</div>
<div class="line"><a id="l00735" name="l00735"></a><span class="lineno">  735</span>                Sitename = Sitename[0: Sitename[0:40].rfind(<span class="stringliteral">&#39; &#39;</span>)] + <span class="stringliteral">&#39;\n&#39;</span> + Sitename[Sitename[0:40].rfind(<span class="stringliteral">&#39; &#39;</span>)+1:]</div>
<div class="line"><a id="l00736" name="l00736"></a><span class="lineno"><a class="line" href="namespace_u_s_topo_search__prod.html#a7a99b25426d76bb55230576ceb090d1e">  736</a></span>        ProjNo = coverInfotext[<span class="stringliteral">&quot;PROJECT_NUM&quot;</span>]</div>
<div class="line"><a id="l00737" name="l00737"></a><span class="lineno"><a class="line" href="namespace_u_s_topo_search__prod.html#ac99226b321c16e8ca0b345d2a09e96cf">  737</a></span>        ProName = coverInfotext[<span class="stringliteral">&quot;COMPANY_NAME&quot;</span>]</div>
<div class="line"><a id="l00738" name="l00738"></a><span class="lineno"><a class="line" href="namespace_u_s_topo_search__prod.html#af050976da544c4472537f0d7ecc277c6">  738</a></span>        AddressText= coverInfotext[<span class="stringliteral">&quot;ADDRESS&quot;</span>]</div>
<div class="line"><a id="l00739" name="l00739"></a><span class="lineno">  739</span> </div>
<div class="line"><a id="l00740" name="l00740"></a><span class="lineno">  740</span>        coverInfotext[<span class="stringliteral">&quot;ADDRESS&quot;</span>] = <span class="stringliteral">&#39;%s\n%s %s %s&#39;</span>%(coverInfotext[<span class="stringliteral">&quot;ADDRESS&quot;</span>],coverInfotext[<span class="stringliteral">&quot;CITY&quot;</span>],coverInfotext[<span class="stringliteral">&quot;PROVSTATE&quot;</span>],coverInfotext[<span class="stringliteral">&quot;POSTALZIP&quot;</span>])</div>
<div class="line"><a id="l00741" name="l00741"></a><span class="lineno">  741</span> </div>
<div class="line"><a id="l00742" name="l00742"></a><span class="lineno">  742</span>        <span class="comment"># OrderDetails = json.loads(cur.callfunc(&#39;eris_gis.getBufferDetails&#39;, str, (str(OrderIDText),)))</span></div>
<div class="line"><a id="l00743" name="l00743"></a><span class="lineno">  743</span>        <span class="comment"># OrderType = OrderDetails[&quot;ORDERTYPE&quot;]</span></div>
<div class="line"><a id="l00744" name="l00744"></a><span class="lineno">  744</span>        <span class="comment"># OrderCoord = eval(OrderDetails[&quot;ORDERCOOR&quot;])</span></div>
<div class="line"><a id="l00745" name="l00745"></a><span class="lineno">  745</span>        <span class="comment"># RadiusType = OrderDetails[&quot;RADIUSTYPE&quot;]</span></div>
<div class="line"><a id="l00746" name="l00746"></a><span class="lineno">  746</span> </div>
<div class="line"><a id="l00747" name="l00747"></a><span class="lineno">  747</span>        cur.execute(<span class="stringliteral">&quot;select geometry_type, geometry, radius_type  from eris_order_geometry where order_id =&quot;</span> + OrderIDText)</div>
<div class="line"><a id="l00748" name="l00748"></a><span class="lineno">  748</span>        t = cur.fetchone()</div>
<div class="line"><a id="l00749" name="l00749"></a><span class="lineno"><a class="line" href="namespace_u_s_topo_search__prod.html#a6f97479f6aba460c0316cd500d6c709a">  749</a></span>        OrderType = str(t[0])</div>
<div class="line"><a id="l00750" name="l00750"></a><span class="lineno"><a class="line" href="namespace_u_s_topo_search__prod.html#acf9ef2de3b962c9b50d3744326974e0c">  750</a></span>        OrderCoord = eval(str(t[1]))</div>
<div class="line"><a id="l00751" name="l00751"></a><span class="lineno"><a class="line" href="namespace_u_s_topo_search__prod.html#a861a4748298526d001153dde0b90f7a4">  751</a></span>        RadiusType = str(t[2])</div>
<div class="line"><a id="l00752" name="l00752"></a><span class="lineno">  752</span> </div>
<div class="line"><a id="l00753" name="l00753"></a><span class="lineno">  753</span>    <span class="keywordflow">except</span> Exception <span class="keyword">as</span> e:</div>
<div class="line"><a id="l00754" name="l00754"></a><span class="lineno">  754</span>        logger.error(<span class="stringliteral">&quot;Error to get flag from Oracle &quot;</span> + str(e))</div>
<div class="line"><a id="l00755" name="l00755"></a><span class="lineno">  755</span>        <span class="keywordflow">raise</span></div>
<div class="line"><a id="l00756" name="l00756"></a><span class="lineno">  756</span>    <span class="keywordflow">finally</span>:</div>
<div class="line"><a id="l00757" name="l00757"></a><span class="lineno">  757</span>        cur.close()</div>
<div class="line"><a id="l00758" name="l00758"></a><span class="lineno">  758</span>        con.close()</div>
<div class="line"><a id="l00759" name="l00759"></a><span class="lineno">  759</span> </div>
<div class="line"><a id="l00760" name="l00760"></a><span class="lineno"><a class="line" href="namespace_u_s_topo_search__prod.html#af2ff4a4b55a798791e05468e200ccca5">  760</a></span>    is_nova = <span class="stringliteral">&#39;N&#39;</span></div>
<div class="line"><a id="l00761" name="l00761"></a><span class="lineno">  761</span>    <span class="keywordflow">try</span>:</div>
<div class="line"><a id="l00762" name="l00762"></a><span class="lineno">  762</span>        con = cx_Oracle.connect(connectionString)</div>
<div class="line"><a id="l00763" name="l00763"></a><span class="lineno">  763</span>        cur = con.cursor()</div>
<div class="line"><a id="l00764" name="l00764"></a><span class="lineno">  764</span> </div>
<div class="line"><a id="l00765" name="l00765"></a><span class="lineno">  765</span>        cur.execute(<span class="stringliteral">&quot;select decode(c.company_id, 40385, &#39;Y&#39;, &#39;N&#39;) is_nova from orders o, customer c where o.customer_id = c.customer_id and o.order_id=&quot;</span> + str(OrderIDText))</div>
<div class="line"><a id="l00766" name="l00766"></a><span class="lineno">  766</span>        t = cur.fetchone()</div>
<div class="line"><a id="l00767" name="l00767"></a><span class="lineno">  767</span>        is_nova = t[0]</div>
<div class="line"><a id="l00768" name="l00768"></a><span class="lineno">  768</span> </div>
<div class="line"><a id="l00769" name="l00769"></a><span class="lineno">  769</span>    <span class="keywordflow">finally</span>:</div>
<div class="line"><a id="l00770" name="l00770"></a><span class="lineno">  770</span>        cur.close()</div>
<div class="line"><a id="l00771" name="l00771"></a><span class="lineno">  771</span>        con.close()</div>
<div class="line"><a id="l00772" name="l00772"></a><span class="lineno">  772</span> </div>
<div class="line"><a id="l00773" name="l00773"></a><span class="lineno">  773</span>    <span class="comment"># Get company flag for custom colour border</span></div>
<div class="line"><a id="l00774" name="l00774"></a><span class="lineno">  774</span>    <span class="keywordflow">try</span>:</div>
<div class="line"><a id="l00775" name="l00775"></a><span class="lineno">  775</span>        con = cx_Oracle.connect(connectionString)</div>
<div class="line"><a id="l00776" name="l00776"></a><span class="lineno">  776</span>        cur = con.cursor()</div>
<div class="line"><a id="l00777" name="l00777"></a><span class="lineno">  777</span> </div>
<div class="line"><a id="l00778" name="l00778"></a><span class="lineno">  778</span>        cur.execute(<span class="stringliteral">&quot;select customer_id from orders where order_id = &#39;&quot;</span>+ OrderIDText+<span class="stringliteral">&quot;&#39;&quot;</span>)</div>
<div class="line"><a id="l00779" name="l00779"></a><span class="lineno"><a class="line" href="namespace_u_s_topo_search__prod.html#a47a90bcb19d77f1d4c1cf64fda4d8dcd">  779</a></span>        a = cur.fetchone()</div>
<div class="line"><a id="l00780" name="l00780"></a><span class="lineno"><a class="line" href="namespace_u_s_topo_search__prod.html#aed9a4f845004617b374881b5a801a5c5">  780</a></span>        CustIDText = str(a[0])</div>
<div class="line"><a id="l00781" name="l00781"></a><span class="lineno">  781</span> </div>
<div class="line"><a id="l00782" name="l00782"></a><span class="lineno">  782</span>        cur.execute(<span class="stringliteral">&quot;select company_id from customer where customer_id = &#39;&quot;</span>+CustIDText+<span class="stringliteral">&quot;&#39;&quot;</span>)</div>
<div class="line"><a id="l00783" name="l00783"></a><span class="lineno"><a class="line" href="namespace_u_s_topo_search__prod.html#a51b2d4c650596269044bb474bb977fda">  783</a></span>        b = cur.fetchone()</div>
<div class="line"><a id="l00784" name="l00784"></a><span class="lineno"><a class="line" href="namespace_u_s_topo_search__prod.html#af186e6ae46f5491a465f04ff79b03540">  784</a></span>        CompIDText = str(b[0])</div>
<div class="line"><a id="l00785" name="l00785"></a><span class="lineno">  785</span> </div>
<div class="line"><a id="l00786" name="l00786"></a><span class="lineno">  786</span>        <span class="keywordflow">print</span> (CompIDText)</div>
<div class="line"><a id="l00787" name="l00787"></a><span class="lineno">  787</span>    <span class="keywordflow">except</span> Exception <span class="keyword">as</span> e:</div>
<div class="line"><a id="l00788" name="l00788"></a><span class="lineno">  788</span>        logger.error(<span class="stringliteral">&quot;Error to get company flag from Oracle &quot;</span>+ str(e))</div>
<div class="line"><a id="l00789" name="l00789"></a><span class="lineno">  789</span>    <span class="keywordflow">finally</span>:</div>
<div class="line"><a id="l00790" name="l00790"></a><span class="lineno">  790</span>        cur.close()</div>
<div class="line"><a id="l00791" name="l00791"></a><span class="lineno">  791</span>        con.close()</div>
<div class="line"><a id="l00792" name="l00792"></a><span class="lineno">  792</span> </div>
<div class="line"><a id="l00793" name="l00793"></a><span class="lineno">  793</span>    <span class="keywordflow">if</span> CompIDText == <span class="stringliteral">&#39;109085&#39;</span>:</div>
<div class="line"><a id="l00794" name="l00794"></a><span class="lineno">  794</span>        annot_poly = os.path.join(filepath,<span class="stringliteral">&quot;annot_poly_red.pdf&quot;</span>)</div>
<div class="line"><a id="l00795" name="l00795"></a><span class="lineno">  795</span>        annot_line = os.path.join(filepath,<span class="stringliteral">&quot;annot_line_red.pdf&quot;</span>)</div>
<div class="line"><a id="l00796" name="l00796"></a><span class="lineno">  796</span>        <span class="keywordflow">print</span> (<span class="stringliteral">&#39;custom colour boundary set&#39;</span>)</div>
<div class="line"><a id="l00797" name="l00797"></a><span class="lineno">  797</span>    <span class="keywordflow">else</span>:</div>
<div class="line"><a id="l00798" name="l00798"></a><span class="lineno">  798</span>        <span class="keywordflow">print</span> (<span class="stringliteral">&#39;no custom colour boundary set&#39;</span>)</div>
<div class="line"><a id="l00799" name="l00799"></a><span class="lineno">  799</span> </div>
<div class="line"><a id="l00800" name="l00800"></a><span class="lineno"><a class="line" href="namespace_u_s_topo_search__prod.html#a3c11f19942141356a6889ca202944a9b">  800</a></span>    is_newLogofile = <span class="stringliteral">&#39;N&#39;</span></div>
<div class="line"><a id="l00801" name="l00801"></a><span class="lineno">  801</span>    <span class="keywordflow">try</span>:</div>
<div class="line"><a id="l00802" name="l00802"></a><span class="lineno">  802</span>        con = cx_Oracle.connect(connectionString)</div>
<div class="line"><a id="l00803" name="l00803"></a><span class="lineno">  803</span>        cur = con.cursor()</div>
<div class="line"><a id="l00804" name="l00804"></a><span class="lineno"><a class="line" href="namespace_u_s_topo_search__prod.html#a16680f19be26677493ca586254966679">  804</a></span>        newlogofile = cur.callfunc(<span class="stringliteral">&#39;ERIS_CUSTOMER.IsCustomLogo&#39;</span>, str, (str(OrderIDText),))</div>
<div class="line"><a id="l00805" name="l00805"></a><span class="lineno">  805</span> </div>
<div class="line"><a id="l00806" name="l00806"></a><span class="lineno">  806</span>        <span class="keywordflow">if</span> newlogofile != <span class="keywordtype">None</span>:</div>
<div class="line"><a id="l00807" name="l00807"></a><span class="lineno">  807</span>            is_newLogofile = <span class="stringliteral">&#39;Y&#39;</span></div>
<div class="line"><a id="l00808" name="l00808"></a><span class="lineno">  808</span>            <span class="keywordflow">if</span> newlogofile ==<span class="stringliteral">&#39;RPS_RGB.gif&#39;</span>:</div>
<div class="line"><a id="l00809" name="l00809"></a><span class="lineno">  809</span>                newlogofile=<span class="stringliteral">&#39;RPS.png&#39;</span></div>
<div class="line"><a id="l00810" name="l00810"></a><span class="lineno">  810</span>    <span class="keywordflow">finally</span>:</div>
<div class="line"><a id="l00811" name="l00811"></a><span class="lineno">  811</span>        cur.close()</div>
<div class="line"><a id="l00812" name="l00812"></a><span class="lineno">  812</span>        con.close()</div>
<div class="line"><a id="l00813" name="l00813"></a><span class="lineno">  813</span> </div>
<div class="line"><a id="l00814" name="l00814"></a><span class="lineno"><a class="line" href="namespace_u_s_topo_search__prod.html#afa2e93474dd567dc20618fb8311716ea">  814</a></span>    is_aei = <span class="stringliteral">&#39;N&#39;</span></div>
<div class="line"><a id="l00815" name="l00815"></a><span class="lineno">  815</span>    <span class="keywordflow">try</span>:</div>
<div class="line"><a id="l00816" name="l00816"></a><span class="lineno">  816</span>        con = cx_Oracle.connect(connectionString)</div>
<div class="line"><a id="l00817" name="l00817"></a><span class="lineno">  817</span>        cur = con.cursor()</div>
<div class="line"><a id="l00818" name="l00818"></a><span class="lineno">  818</span> </div>
<div class="line"><a id="l00819" name="l00819"></a><span class="lineno">  819</span>        is_aei = cur.callfunc(<span class="stringliteral">&#39;ERIS_CUSTOMER.IsProductChron&#39;</span>, str, (str(OrderIDText),))</div>
<div class="line"><a id="l00820" name="l00820"></a><span class="lineno">  820</span>    <span class="keywordflow">finally</span>:</div>
<div class="line"><a id="l00821" name="l00821"></a><span class="lineno">  821</span>        cur.close()</div>
<div class="line"><a id="l00822" name="l00822"></a><span class="lineno">  822</span>        con.close()</div>
<div class="line"><a id="l00823" name="l00823"></a><span class="lineno">  823</span> </div>
<div class="line"><a id="l00824" name="l00824"></a><span class="lineno"><a class="line" href="namespace_u_s_topo_search__prod.html#a3781810493622344cd895d912e898ef9">  824</a></span>    copydirs = []    <span class="comment"># will keep directories to be zipped</span></div>
<div class="line"><a id="l00825" name="l00825"></a><span class="lineno"><a class="line" href="namespace_u_s_topo_search__prod.html#a468ee50be6d8330b2c7bacb4ddd58044">  825</a></span>    deliverfolder = OrderNumText</div>
<div class="line"><a id="l00826" name="l00826"></a><span class="lineno"><a class="line" href="namespace_u_s_topo_search__prod.html#ab042b08a91cb9a013bad180cf41e8018">  826</a></span>    pdfreport = OrderNumText+<span class="stringliteral">&quot;_US_Topo.pdf&quot;</span></div>
<div class="line"><a id="l00827" name="l00827"></a><span class="lineno">  827</span> </div>
<div class="line"><a id="l00828" name="l00828"></a><span class="lineno"><a class="line" href="namespace_u_s_topo_search__prod.html#a022d063b2e9c46e5b56445a59ab47692">  828</a></span>    srGCS83 = arcpy.SpatialReference(os.path.join(connectionPath, <span class="stringliteral">u&#39;projections\\GCSNorthAmerican1983.prj&#39;</span>))</div>
<div class="line"><a id="l00829" name="l00829"></a><span class="lineno"><a class="line" href="namespace_u_s_topo_search__prod.html#a51fc10e559c601fb85240f749f2d6f9c">  829</a></span>    srWGS84 = arcpy.SpatialReference(os.path.join(connectionPath, <span class="stringliteral">u&#39;projections\\WGS1984.prj&#39;</span>))</div>
<div class="line"><a id="l00830" name="l00830"></a><span class="lineno">  830</span> </div>
<div class="line"><a id="l00831" name="l00831"></a><span class="lineno"><a class="line" href="namespace_u_s_topo_search__prod.html#a3ebc0da54b6509bc218b3f406d7cb1a6">  831</a></span>    point = arcpy.Point()</div>
<div class="line"><a id="l00832" name="l00832"></a><span class="lineno"><a class="line" href="namespace_u_s_topo_search__prod.html#a264d304ca04468437a81400d9db9b41a">  832</a></span>    array = arcpy.Array()</div>
<div class="line"><a id="l00833" name="l00833"></a><span class="lineno"><a class="line" href="namespace_u_s_topo_search__prod.html#aec4ecee9b50df0d521f9768b499a3aa4">  833</a></span>    sr = arcpy.SpatialReference()</div>
<div class="line"><a id="l00834" name="l00834"></a><span class="lineno"><a class="line" href="namespace_u_s_topo_search__prod.html#afb9f3561b9de4ffe6dd75b676d406edf">  834</a></span>    sr.factoryCode = 4269   <span class="comment"># requires input geometry is in 4269</span></div>
<div class="line"><a id="l00835" name="l00835"></a><span class="lineno"><a class="line" href="namespace_u_s_topo_search__prod.html#a44b562dc1925d3861c6e3174b508b677">  835</a></span>    sr.XYTolerance = .00000001</div>
<div class="line"><a id="l00836" name="l00836"></a><span class="lineno"><a class="line" href="namespace_u_s_topo_search__prod.html#af2e783a2cd2dcf31010923d1a0c20b73">  836</a></span>    sr.scaleFactor = 2000</div>
<div class="line"><a id="l00837" name="l00837"></a><span class="lineno">  837</span>    sr.create()</div>
<div class="line"><a id="l00838" name="l00838"></a><span class="lineno"><a class="line" href="namespace_u_s_topo_search__prod.html#a29c28b3f7bbc1dacfeac8c01b9783f6b">  838</a></span>    featureList = []</div>
<div class="line"><a id="l00839" name="l00839"></a><span class="lineno">  839</span>    <span class="keywordflow">for</span> feature <span class="keywordflow">in</span> OrderCoord:</div>
<div class="line"><a id="l00840" name="l00840"></a><span class="lineno">  840</span>        <span class="comment"># For each coordinate pair, set the x,y properties and add to the Array object.</span></div>
<div class="line"><a id="l00841" name="l00841"></a><span class="lineno">  841</span>        <span class="keywordflow">for</span> coordPair <span class="keywordflow">in</span> feature:</div>
<div class="line"><a id="l00842" name="l00842"></a><span class="lineno"><a class="line" href="namespace_u_s_topo_search__prod.html#adbe58f792bcc0462de65ab3f7bd6cb26">  842</a></span>            point.X = coordPair[0]</div>
<div class="line"><a id="l00843" name="l00843"></a><span class="lineno"><a class="line" href="namespace_u_s_topo_search__prod.html#ae08fb57faddbe99e1c14e42801c4cc94">  843</a></span>            point.Y = coordPair[1]</div>
<div class="line"><a id="l00844" name="l00844"></a><span class="lineno">  844</span>            sr.setDomain (point.X, point.X, point.Y, point.Y)</div>
<div class="line"><a id="l00845" name="l00845"></a><span class="lineno">  845</span>            array.add(point)</div>
<div class="line"><a id="l00846" name="l00846"></a><span class="lineno">  846</span>        <span class="keywordflow">if</span> OrderType.lower()== <span class="stringliteral">&#39;point&#39;</span>:</div>
<div class="line"><a id="l00847" name="l00847"></a><span class="lineno"><a class="line" href="namespace_u_s_topo_search__prod.html#aa6df99b8d9c11d9a05a752775b627e9e">  847</a></span>            feat = arcpy.Multipoint(array, sr)</div>
<div class="line"><a id="l00848" name="l00848"></a><span class="lineno">  848</span>        <span class="keywordflow">elif</span> OrderType.lower() ==<span class="stringliteral">&#39;polyline&#39;</span>:</div>
<div class="line"><a id="l00849" name="l00849"></a><span class="lineno">  849</span>            feat  = arcpy.Polyline(array, sr)</div>
<div class="line"><a id="l00850" name="l00850"></a><span class="lineno">  850</span>        <span class="keywordflow">else</span> :</div>
<div class="line"><a id="l00851" name="l00851"></a><span class="lineno">  851</span>            feat = arcpy.Polygon(array,sr)</div>
<div class="line"><a id="l00852" name="l00852"></a><span class="lineno">  852</span>        array.removeAll()</div>
<div class="line"><a id="l00853" name="l00853"></a><span class="lineno">  853</span> </div>
<div class="line"><a id="l00854" name="l00854"></a><span class="lineno">  854</span>        <span class="comment"># Append to the list of Polygon objects</span></div>
<div class="line"><a id="l00855" name="l00855"></a><span class="lineno">  855</span>        featureList.append(feat)</div>
<div class="line"><a id="l00856" name="l00856"></a><span class="lineno">  856</span> </div>
<div class="line"><a id="l00857" name="l00857"></a><span class="lineno"><a class="line" href="namespace_u_s_topo_search__prod.html#ac0487e99b417131ec4b5244c55a22b77">  857</a></span>    orderGeometry= os.path.join(scratch,<span class="stringliteral">&quot;orderGeometry.shp&quot;</span>)</div>
<div class="line"><a id="l00858" name="l00858"></a><span class="lineno">  858</span>    arcpy.CopyFeatures_management(featureList, orderGeometry)</div>
<div class="line"><a id="l00859" name="l00859"></a><span class="lineno">  859</span>    arcpy.DefineProjection_management(orderGeometry, srGCS83)</div>
<div class="line"><a id="l00860" name="l00860"></a><span class="lineno">  860</span> </div>
<div class="line"><a id="l00861" name="l00861"></a><span class="lineno">  861</span>    arcpy.AddField_management(orderGeometry, <span class="stringliteral">&quot;UTM&quot;</span>, <span class="stringliteral">&quot;TEXT&quot;</span>, <span class="stringliteral">&quot;&quot;</span>, <span class="stringliteral">&quot;&quot;</span>, <span class="stringliteral">&quot;1500&quot;</span>, <span class="stringliteral">&quot;&quot;</span>, <span class="stringliteral">&quot;NULLABLE&quot;</span>, <span class="stringliteral">&quot;NON_REQUIRED&quot;</span>, <span class="stringliteral">&quot;&quot;</span>)</div>
<div class="line"><a id="l00862" name="l00862"></a><span class="lineno">  862</span>    arcpy.CalculateUTMZone_cartography(orderGeometry, <span class="stringliteral">&#39;UTM&#39;</span>)</div>
<div class="line"><a id="l00863" name="l00863"></a><span class="lineno"><a class="line" href="namespace_u_s_topo_search__prod.html#ab247e0c08cb05b787c0316de550e5cfb">  863</a></span>    UT= arcpy.SearchCursor(orderGeometry)</div>
<div class="line"><a id="l00864" name="l00864"></a><span class="lineno">  864</span>    <span class="keywordflow">for</span> row <span class="keywordflow">in</span> UT:</div>
<div class="line"><a id="l00865" name="l00865"></a><span class="lineno"><a class="line" href="namespace_u_s_topo_search__prod.html#a49073f04af524a0fd42dc4da5070fdee">  865</a></span>        UTMvalue = str(row.getValue(<span class="stringliteral">&#39;UTM&#39;</span>))[41:43]</div>
<div class="line"><a id="l00866" name="l00866"></a><span class="lineno">  866</span>    del UT</div>
<div class="line"><a id="l00867" name="l00867"></a><span class="lineno">  867</span>    <span class="keywordflow">if</span> UTMvalue[0]==<span class="stringliteral">&#39;0&#39;</span>:</div>
<div class="line"><a id="l00868" name="l00868"></a><span class="lineno">  868</span>        UTMvalue=<span class="stringliteral">&#39; &#39;</span>+UTMvalue[1:]</div>
<div class="line"><a id="l00869" name="l00869"></a><span class="lineno"><a class="line" href="namespace_u_s_topo_search__prod.html#a486ce52a4de620cf234ea875a7b81454">  869</a></span>    out_coordinate_system = arcpy.SpatialReference(<span class="stringliteral">&#39;WGS 1984 UTM Zone %sN&#39;</span>%UTMvalue)<span class="comment"># arcpy.SpatialReference(&#39;NAD 1983 UTM Zone %sN&#39;%UTMvalue)</span></div>
<div class="line"><a id="l00870" name="l00870"></a><span class="lineno">  870</span> </div>
<div class="line"><a id="l00871" name="l00871"></a><span class="lineno"><a class="line" href="namespace_u_s_topo_search__prod.html#afa86114589e70ca97e5be71b96aca2c2">  871</a></span>    orderGeometryPR = os.path.join(scratch, <span class="stringliteral">&quot;ordergeoNamePR.shp&quot;</span>)</div>
<div class="line"><a id="l00872" name="l00872"></a><span class="lineno">  872</span>    arcpy.Project_management(orderGeometry, orderGeometryPR, out_coordinate_system)</div>
<div class="line"><a id="l00873" name="l00873"></a><span class="lineno">  873</span> </div>
<div class="line"><a id="l00874" name="l00874"></a><span class="lineno">  874</span>    del point</div>
<div class="line"><a id="l00875" name="l00875"></a><span class="lineno">  875</span>    del array</div>
<div class="line"><a id="l00876" name="l00876"></a><span class="lineno">  876</span> </div>
<div class="line"><a id="l00877" name="l00877"></a><span class="lineno">  877</span>    logger.debug(<span class="stringliteral">&quot;#1&quot;</span>)</div>
<div class="line"><a id="l00878" name="l00878"></a><span class="lineno"><a class="line" href="namespace_u_s_topo_search__prod.html#ac242970611e492b7d3d0a569a992c528">  878</a></span>    bufferDistance_e75 = <span class="stringliteral">&#39;1 KILOMETERS&#39;</span>         <span class="comment"># has to be not smaller than the search radius to void white page</span></div>
<div class="line"><a id="l00879" name="l00879"></a><span class="lineno"><a class="line" href="namespace_u_s_topo_search__prod.html#af91f9666cb8ec5a5d783174e01e8204c">  879</a></span>    extentBuffer75SHP = os.path.join(scratch,<span class="stringliteral">&quot;buffer_extent75.shp&quot;</span>)</div>
<div class="line"><a id="l00880" name="l00880"></a><span class="lineno">  880</span>    arcpy.Buffer_analysis(orderGeometryPR, extentBuffer75SHP, bufferDistance_e75)</div>
<div class="line"><a id="l00881" name="l00881"></a><span class="lineno">  881</span> </div>
<div class="line"><a id="l00882" name="l00882"></a><span class="lineno">  882</span>    <span class="comment"># bufferDistance_e15 = &quot;5 KILOMETERS&quot;   #note 5km may result in 48K scale maps to produce .zip file</span></div>
<div class="line"><a id="l00883" name="l00883"></a><span class="lineno">  883</span>    <span class="comment"># extentBuffer15SHP = os.path.join(scratch,&quot;buffer_extent15.shp&quot;)</span></div>
<div class="line"><a id="l00884" name="l00884"></a><span class="lineno">  884</span>    <span class="comment"># arcpy.Buffer_analysis(orderGeometryPR, extentBuffer15SHP, bufferDistance_e15)</span></div>
<div class="line"><a id="l00885" name="l00885"></a><span class="lineno">  885</span> </div>
<div class="line"><a id="l00886" name="l00886"></a><span class="lineno"><a class="line" href="namespace_u_s_topo_search__prod.html#aaf16695384e49e083622efaf45558d59">  886</a></span>    masterLayer = arcpy.mapping.Layer(masterlyr)</div>
<div class="line"><a id="l00887" name="l00887"></a><span class="lineno">  887</span>    arcpy.SelectLayerByLocation_management(masterLayer,<span class="stringliteral">&#39;intersect&#39;</span>, orderGeometryPR,<span class="stringliteral">&#39;0.25 KILOMETERS&#39;</span>)  <span class="comment">#it doesn&#39;t seem to work without the distance</span></div>
<div class="line"><a id="l00888" name="l00888"></a><span class="lineno">  888</span> </div>
<div class="line"><a id="l00889" name="l00889"></a><span class="lineno">  889</span>    logger.debug(<span class="stringliteral">&quot;#2&quot;</span>)</div>
<div class="line"><a id="l00890" name="l00890"></a><span class="lineno">  890</span>    if(int((arcpy.GetCount_management(masterLayer).getOutput(0))) ==0):</div>
<div class="line"><a id="l00891" name="l00891"></a><span class="lineno">  891</span>        <span class="keywordflow">print</span> (<span class="stringliteral">&quot;NO records selected&quot;</span>)</div>
<div class="line"><a id="l00892" name="l00892"></a><span class="lineno">  892</span>        masterLayer = <span class="keywordtype">None</span></div>
<div class="line"><a id="l00893" name="l00893"></a><span class="lineno">  893</span>    <span class="keywordflow">else</span>:</div>
<div class="line"><a id="l00894" name="l00894"></a><span class="lineno"><a class="line" href="namespace_u_s_topo_search__prod.html#ae85add6ed3981544892febf3abf38210">  894</a></span>        cellids_selected = []</div>
<div class="line"><a id="l00895" name="l00895"></a><span class="lineno">  895</span>        <span class="comment"># loop through the relevant records, locate the selected cell IDs</span></div>
<div class="line"><a id="l00896" name="l00896"></a><span class="lineno"><a class="line" href="namespace_u_s_topo_search__prod.html#af0df1c4e3c73adef9f694bdd9d4e8a79">  896</a></span>        rows = arcpy.SearchCursor(masterLayer)    <span class="comment"># loop through the selected records</span></div>
<div class="line"><a id="l00897" name="l00897"></a><span class="lineno">  897</span>        <span class="keywordflow">for</span> row <span class="keywordflow">in</span> rows:</div>
<div class="line"><a id="l00898" name="l00898"></a><span class="lineno"><a class="line" href="namespace_u_s_topo_search__prod.html#a6dbe3bd0befa489d7bb0c356082950cf">  898</a></span>            cellid = str(int(row.getValue(<span class="stringliteral">&quot;CELL_ID&quot;</span>)))</div>
<div class="line"><a id="l00899" name="l00899"></a><span class="lineno">  899</span>            cellids_selected.append(cellid)</div>
<div class="line"><a id="l00900" name="l00900"></a><span class="lineno">  900</span>        del row</div>
<div class="line"><a id="l00901" name="l00901"></a><span class="lineno">  901</span>        del rows</div>
<div class="line"><a id="l00902" name="l00902"></a><span class="lineno">  902</span> </div>
<div class="line"><a id="l00903" name="l00903"></a><span class="lineno">  903</span>        arcpy.SelectLayerByLocation_management(masterLayer,<span class="stringliteral">&#39;intersect&#39;</span>, orderGeometryPR,<span class="stringliteral">&#39;7 KILOMETERS&#39;</span>,<span class="stringliteral">&#39;NEW_SELECTION&#39;</span>)</div>
<div class="line"><a id="l00904" name="l00904"></a><span class="lineno"><a class="line" href="namespace_u_s_topo_search__prod.html#a7cc64d22a543cf4a2d19938f11614d5e">  904</a></span>        cellids = []</div>
<div class="line"><a id="l00905" name="l00905"></a><span class="lineno"><a class="line" href="namespace_u_s_topo_search__prod.html#ad3cca212508ad2f2e6ea505a6cfa56ab">  905</a></span>        cellsizes = []</div>
<div class="line"><a id="l00906" name="l00906"></a><span class="lineno">  906</span>        <span class="comment"># loop through the relevant records, locate the selected cell IDs</span></div>
<div class="line"><a id="l00907" name="l00907"></a><span class="lineno">  907</span>        rows = arcpy.SearchCursor(masterLayer)    <span class="comment"># loop through the selected records</span></div>
<div class="line"><a id="l00908" name="l00908"></a><span class="lineno">  908</span>        <span class="keywordflow">for</span> row <span class="keywordflow">in</span> rows:</div>
<div class="line"><a id="l00909" name="l00909"></a><span class="lineno">  909</span>            cellid = str(int(row.getValue(<span class="stringliteral">&quot;CELL_ID&quot;</span>)))</div>
<div class="line"><a id="l00910" name="l00910"></a><span class="lineno"><a class="line" href="namespace_u_s_topo_search__prod.html#a38db3fb8e4fe7f89050acbb9c2a39c92">  910</a></span>            cellsize = str(int(row.getValue(<span class="stringliteral">&quot;CELL_SIZE&quot;</span>)))</div>
<div class="line"><a id="l00911" name="l00911"></a><span class="lineno">  911</span>            cellids.append(cellid)</div>
<div class="line"><a id="l00912" name="l00912"></a><span class="lineno">  912</span>            cellsizes.append(cellsize)</div>
<div class="line"><a id="l00913" name="l00913"></a><span class="lineno">  913</span>        del row</div>
<div class="line"><a id="l00914" name="l00914"></a><span class="lineno">  914</span>        del rows</div>
<div class="line"><a id="l00915" name="l00915"></a><span class="lineno">  915</span> </div>
<div class="line"><a id="l00916" name="l00916"></a><span class="lineno">  916</span>        masterLayer = <span class="keywordtype">None</span></div>
<div class="line"><a id="l00917" name="l00917"></a><span class="lineno">  917</span>        logger.debug(cellids)</div>
<div class="line"><a id="l00918" name="l00918"></a><span class="lineno">  918</span> </div>
<div class="line"><a id="l00919" name="l00919"></a><span class="lineno"><a class="line" href="namespace_u_s_topo_search__prod.html#a118cf4de1429439922612f85ee82d42f">  919</a></span>        infomatrix = []</div>
<div class="line"><a id="l00920" name="l00920"></a><span class="lineno">  920</span>        <span class="comment"># cellids are found, need to find corresponding map .pdf by reading the .csv file</span></div>
<div class="line"><a id="l00921" name="l00921"></a><span class="lineno">  921</span>        <span class="comment"># also get the year info from the corresponding .xml</span></div>
<div class="line"><a id="l00922" name="l00922"></a><span class="lineno">  922</span>        <span class="keywordflow">print</span> (<span class="stringliteral">&quot;#1 &quot;</span> + time.strftime(<span class="stringliteral">&#39;%Y-%m-%d %H:%M:%S&#39;</span>, time.localtime()))</div>
<div class="line"><a id="l00923" name="l00923"></a><span class="lineno">  923</span>        <span class="keyword">with</span> open(csvfile_h, <span class="stringliteral">&quot;rb&quot;</span>) <span class="keyword">as</span> f:</div>
<div class="line"><a id="l00924" name="l00924"></a><span class="lineno">  924</span>            print(<span class="stringliteral">&quot;___All USGS HTMC Topo List.&quot;</span>)</div>
<div class="line"><a id="l00925" name="l00925"></a><span class="lineno"><a class="line" href="namespace_u_s_topo_search__prod.html#a3560e769490f17d9738db6e9ade115f3">  925</a></span>            reader = csv.reader(f)</div>
<div class="line"><a id="l00926" name="l00926"></a><span class="lineno">  926</span>            <span class="keywordflow">for</span> row <span class="keywordflow">in</span> reader:</div>
<div class="line"><a id="l00927" name="l00927"></a><span class="lineno">  927</span>                <span class="keywordflow">if</span> row[9] <span class="keywordflow">in</span> cellids:</div>
<div class="line"><a id="l00928" name="l00928"></a><span class="lineno">  928</span>                    <span class="comment"># print &quot;#2 &quot; + time.strftime(&#39;%Y-%m-%d %H:%M:%S&#39;, time.localtime())</span></div>
<div class="line"><a id="l00929" name="l00929"></a><span class="lineno"><a class="line" href="namespace_u_s_topo_search__prod.html#ab6a33199f483db10beecd507fbaefee8">  929</a></span>                    pdfname = row[15].strip()</div>
<div class="line"><a id="l00930" name="l00930"></a><span class="lineno">  930</span>                    <span class="comment"># read the year from .xml file</span></div>
<div class="line"><a id="l00931" name="l00931"></a><span class="lineno"><a class="line" href="namespace_u_s_topo_search__prod.html#acff290fe7f412d733ed9aa6b90b19a4c">  931</a></span>                    xmlname = pdfname[0:-3] + <span class="stringliteral">&quot;xml&quot;</span></div>
<div class="line"><a id="l00932" name="l00932"></a><span class="lineno"><a class="line" href="namespace_u_s_topo_search__prod.html#a2079a188ebb9b3e7d8b1e1ee3d0d3c4f">  932</a></span>                    xmlpath = os.path.join(tifdir_h,xmlname)</div>
<div class="line"><a id="l00933" name="l00933"></a><span class="lineno"><a class="line" href="namespace_u_s_topo_search__prod.html#a3249f58ed65ba22be5dd3c27ae3e9db2">  933</a></span>                    tree = ET.parse(xmlpath)</div>
<div class="line"><a id="l00934" name="l00934"></a><span class="lineno"><a class="line" href="namespace_u_s_topo_search__prod.html#a505db56444a9227f92bb46f188447ee2">  934</a></span>                    root = tree.getroot()</div>
<div class="line"><a id="l00935" name="l00935"></a><span class="lineno"><a class="line" href="namespace_u_s_topo_search__prod.html#a0fdf1b94cd331cf4ad7a595213e9908c">  935</a></span>                    procsteps = root.findall(<span class="stringliteral">&quot;./dataqual/lineage/procstep&quot;</span>)</div>
<div class="line"><a id="l00936" name="l00936"></a><span class="lineno"><a class="line" href="namespace_u_s_topo_search__prod.html#ae2db648778dd7e31250304fdd54bbe1d">  936</a></span>                    yeardict = {}</div>
<div class="line"><a id="l00937" name="l00937"></a><span class="lineno">  937</span>                    <span class="keywordflow">for</span> procstep <span class="keywordflow">in</span> procsteps:</div>
<div class="line"><a id="l00938" name="l00938"></a><span class="lineno"><a class="line" href="namespace_u_s_topo_search__prod.html#a03c0abbca9674d1a55302c13d9a28467">  938</a></span>                        procdate = procstep.find(<span class="stringliteral">&quot;./procdate&quot;</span>)</div>
<div class="line"><a id="l00939" name="l00939"></a><span class="lineno">  939</span>                        <span class="keywordflow">if</span> procdate != <span class="keywordtype">None</span>:</div>
<div class="line"><a id="l00940" name="l00940"></a><span class="lineno"><a class="line" href="namespace_u_s_topo_search__prod.html#ab093f1c247f930a2ecf1ba66c0ade689">  940</a></span>                            procdesc = procstep.find(<span class="stringliteral">&quot;./procdesc&quot;</span>)</div>
<div class="line"><a id="l00941" name="l00941"></a><span class="lineno">  941</span>                            yeardict[procdesc.text.lower()] = procdate.text</div>
<div class="line"><a id="l00942" name="l00942"></a><span class="lineno">  942</span>                    <span class="comment"># print yeardict</span></div>
<div class="line"><a id="l00943" name="l00943"></a><span class="lineno"><a class="line" href="namespace_u_s_topo_search__prod.html#acc7909a75a855823c8cfd219dcde09ac">  943</a></span>                    year2use = <span class="stringliteral">&quot;&quot;</span></div>
<div class="line"><a id="l00944" name="l00944"></a><span class="lineno"><a class="line" href="namespace_u_s_topo_search__prod.html#af7d73aefffd837f931ee5387042f93a3">  944</a></span>                    yearcandidates = []</div>
<div class="line"><a id="l00945" name="l00945"></a><span class="lineno">  945</span>                    <span class="keywordflow">if</span> <span class="stringliteral">&quot;edit year&quot;</span> <span class="keywordflow">in</span> yeardict.keys():</div>
<div class="line"><a id="l00946" name="l00946"></a><span class="lineno">  946</span>                        yearcandidates.append(int(yeardict[<span class="stringliteral">&quot;edit year&quot;</span>]))</div>
<div class="line"><a id="l00947" name="l00947"></a><span class="lineno">  947</span> </div>
<div class="line"><a id="l00948" name="l00948"></a><span class="lineno">  948</span>                    <span class="keywordflow">if</span> <span class="stringliteral">&quot;aerial photo year&quot;</span> <span class="keywordflow">in</span> yeardict.keys():</div>
<div class="line"><a id="l00949" name="l00949"></a><span class="lineno">  949</span>                        yearcandidates.append(int(yeardict[<span class="stringliteral">&quot;aerial photo year&quot;</span>]))</div>
<div class="line"><a id="l00950" name="l00950"></a><span class="lineno">  950</span> </div>
<div class="line"><a id="l00951" name="l00951"></a><span class="lineno">  951</span>                    <span class="keywordflow">if</span> <span class="stringliteral">&quot;photo revision year&quot;</span> <span class="keywordflow">in</span> yeardict.keys():</div>
<div class="line"><a id="l00952" name="l00952"></a><span class="lineno">  952</span>                        yearcandidates.append(int(yeardict[<span class="stringliteral">&quot;photo revision year&quot;</span>]))</div>
<div class="line"><a id="l00953" name="l00953"></a><span class="lineno">  953</span> </div>
<div class="line"><a id="l00954" name="l00954"></a><span class="lineno">  954</span>                    <span class="keywordflow">if</span> <span class="stringliteral">&quot;field check year&quot;</span> <span class="keywordflow">in</span> yeardict.keys():</div>
<div class="line"><a id="l00955" name="l00955"></a><span class="lineno">  955</span>                        yearcandidates.append(int(yeardict[<span class="stringliteral">&quot;field check year&quot;</span>]))</div>
<div class="line"><a id="l00956" name="l00956"></a><span class="lineno">  956</span> </div>
<div class="line"><a id="l00957" name="l00957"></a><span class="lineno">  957</span>                    <span class="keywordflow">if</span> <span class="stringliteral">&quot;photo inspection year&quot;</span> <span class="keywordflow">in</span> yeardict.keys():</div>
<div class="line"><a id="l00958" name="l00958"></a><span class="lineno">  958</span>                        <span class="comment"># print &quot;photo inspection year is &quot; + yeardict[&quot;photo inspection year&quot;]</span></div>
<div class="line"><a id="l00959" name="l00959"></a><span class="lineno">  959</span>                        yearcandidates.append(int(yeardict[<span class="stringliteral">&quot;photo inspection year&quot;</span>]))</div>
<div class="line"><a id="l00960" name="l00960"></a><span class="lineno">  960</span> </div>
<div class="line"><a id="l00961" name="l00961"></a><span class="lineno">  961</span>                    <span class="keywordflow">if</span> <span class="stringliteral">&quot;date on map&quot;</span> <span class="keywordflow">in</span> yeardict.keys():</div>
<div class="line"><a id="l00962" name="l00962"></a><span class="lineno">  962</span>                        <span class="comment"># print &quot;date on  map &quot; + yeardict[&quot;date on map&quot;]</span></div>
<div class="line"><a id="l00963" name="l00963"></a><span class="lineno">  963</span>                        yearcandidates.append(int(yeardict[<span class="stringliteral">&quot;date on map&quot;</span>]))</div>
<div class="line"><a id="l00964" name="l00964"></a><span class="lineno">  964</span> </div>
<div class="line"><a id="l00965" name="l00965"></a><span class="lineno">  965</span>                    <span class="keywordflow">if</span> len(yearcandidates) &gt; 0:</div>
<div class="line"><a id="l00966" name="l00966"></a><span class="lineno">  966</span>                        <span class="comment"># print &quot;***** length of yearcnadidates is &quot; + str(len(yearcandidates))</span></div>
<div class="line"><a id="l00967" name="l00967"></a><span class="lineno">  967</span>                        year2use = str(max(yearcandidates))</div>
<div class="line"><a id="l00968" name="l00968"></a><span class="lineno">  968</span> </div>
<div class="line"><a id="l00969" name="l00969"></a><span class="lineno">  969</span>                    <span class="keywordflow">if</span> year2use == <span class="stringliteral">&quot;&quot;</span>:</div>
<div class="line"><a id="l00970" name="l00970"></a><span class="lineno">  970</span>                        <span class="keywordflow">print</span> (<span class="stringliteral">&quot;################### cannot determine the year of the map!!&quot;</span>)</div>
<div class="line"><a id="l00971" name="l00971"></a><span class="lineno">  971</span> </div>
<div class="line"><a id="l00972" name="l00972"></a><span class="lineno">  972</span>                    <span class="comment"># logger.debug(row[9] + &quot; &quot; + row[5] + &quot;  &quot; + row[15] + &quot;  &quot; + year2use)</span></div>
<div class="line"><a id="l00973" name="l00973"></a><span class="lineno">  973</span>                    infomatrix.append([row[9],row[5],row[15],year2use])  <span class="comment"># [64818, 15X15 GRID,  LA_Zachary_335142_1963_62500_geo.pdf,  1963]</span></div>
<div class="line"><a id="l00974" name="l00974"></a><span class="lineno">  974</span> </div>
<div class="line"><a id="l00975" name="l00975"></a><span class="lineno">  975</span>        <span class="keyword">with</span> open(csvfile_c, <span class="stringliteral">&quot;rb&quot;</span>) <span class="keyword">as</span> f:</div>
<div class="line"><a id="l00976" name="l00976"></a><span class="lineno">  976</span>            print(<span class="stringliteral">&quot;___All USGS Current Topo List.&quot;</span>)</div>
<div class="line"><a id="l00977" name="l00977"></a><span class="lineno">  977</span>            reader = csv.reader(f)</div>
<div class="line"><a id="l00978" name="l00978"></a><span class="lineno">  978</span>            <span class="keywordflow">for</span> row <span class="keywordflow">in</span> reader:</div>
<div class="line"><a id="l00979" name="l00979"></a><span class="lineno">  979</span>                <span class="keywordflow">if</span> row[9] <span class="keywordflow">in</span> cellids:</div>
<div class="line"><a id="l00980" name="l00980"></a><span class="lineno">  980</span>                    <span class="comment"># print &quot;#2 &quot; + time.strftime(&#39;%Y-%m-%d %H:%M:%S&#39;, time.localtime())</span></div>
<div class="line"><a id="l00981" name="l00981"></a><span class="lineno">  981</span>                    pdfname = row[15].strip()</div>
<div class="line"><a id="l00982" name="l00982"></a><span class="lineno">  982</span> </div>
<div class="line"><a id="l00983" name="l00983"></a><span class="lineno">  983</span>                    <span class="comment"># for current topos, read the year from the geopdf file name</span></div>
<div class="line"><a id="l00984" name="l00984"></a><span class="lineno"><a class="line" href="namespace_u_s_topo_search__prod.html#a7f0a930211009018000827dcfcb2cbcc">  984</a></span>                    templist = pdfname.split(<span class="stringliteral">&quot;_&quot;</span>)</div>
<div class="line"><a id="l00985" name="l00985"></a><span class="lineno">  985</span>                    year2use = templist[len(templist)-3][0:4]</div>
<div class="line"><a id="l00986" name="l00986"></a><span class="lineno">  986</span> </div>
<div class="line"><a id="l00987" name="l00987"></a><span class="lineno">  987</span>                    <span class="keywordflow">if</span> year2use[0:2] != <span class="stringliteral">&quot;20&quot;</span>:</div>
<div class="line"><a id="l00988" name="l00988"></a><span class="lineno">  988</span>                        <span class="keywordflow">print</span> (<span class="stringliteral">&quot;################### Error in the year of the map!!&quot;</span>)</div>
<div class="line"><a id="l00989" name="l00989"></a><span class="lineno">  989</span> </div>
<div class="line"><a id="l00990" name="l00990"></a><span class="lineno">  990</span>                    <span class="comment"># print (row[9] + &quot; &quot; + row[5] + &quot;  &quot; + row[15] + &quot;  &quot; + year2use)</span></div>
<div class="line"><a id="l00991" name="l00991"></a><span class="lineno">  991</span>                    infomatrix.append([row[9],row[5],row[15],year2use])</div>
<div class="line"><a id="l00992" name="l00992"></a><span class="lineno">  992</span> </div>
<div class="line"><a id="l00993" name="l00993"></a><span class="lineno">  993</span>        logger.debug(<span class="stringliteral">&quot;#3&quot;</span>)</div>
<div class="line"><a id="l00994" name="l00994"></a><span class="lineno">  994</span>        <span class="keywordflow">print</span> (<span class="stringliteral">&quot;#3 &quot;</span> + time.strftime(<span class="stringliteral">&#39;%Y-%m-%d %H:%M:%S&#39;</span>, time.localtime()))</div>
<div class="line"><a id="l00995" name="l00995"></a><span class="lineno">  995</span>        <span class="comment"># locate the geopdf and find the exact year to report, only use one from the same year per cell</span></div>
<div class="line"><a id="l00996" name="l00996"></a><span class="lineno"><a class="line" href="namespace_u_s_topo_search__prod.html#a9134f565242df7ddb12b8e5add61a485">  996</a></span>        maps7575 = []</div>
<div class="line"><a id="l00997" name="l00997"></a><span class="lineno"><a class="line" href="namespace_u_s_topo_search__prod.html#ae25ad2d51acbe844e39ca62c4493330d">  997</a></span>        maps1515 = []</div>
<div class="line"><a id="l00998" name="l00998"></a><span class="lineno"><a class="line" href="namespace_u_s_topo_search__prod.html#a6fb84ca53e138d22a1e792707b1f0696">  998</a></span>        maps3060 =[]</div>
<div class="line"><a id="l00999" name="l00999"></a><span class="lineno"><a class="line" href="namespace_u_s_topo_search__prod.html#aa72fbd0fc15df39926518d4a50a2390e">  999</a></span>        maps12 = []</div>
<div class="line"><a id="l01000" name="l01000"></a><span class="lineno"> 1000</span>        </div>
<div class="line"><a id="l01001" name="l01001"></a><span class="lineno"> 1001</span>        <span class="keywordflow">for</span> row <span class="keywordflow">in</span> infomatrix:</div>
<div class="line"><a id="l01002" name="l01002"></a><span class="lineno"> 1002</span>            <span class="keywordflow">if</span> row[3] ==<span class="stringliteral">&quot;&quot;</span>:</div>
<div class="line"><a id="l01003" name="l01003"></a><span class="lineno"> 1003</span>                print(<span class="stringliteral">&quot;BLANK YEAR VALUE IN ROW EXISTS: &quot;</span> + str(row))</div>
<div class="line"><a id="l01004" name="l01004"></a><span class="lineno"> 1004</span>            <span class="keywordflow">else</span>:</div>
<div class="line"><a id="l01005" name="l01005"></a><span class="lineno"> 1005</span>                <span class="keywordflow">if</span> row[1] == <span class="stringliteral">&quot;7.5X7.5 GRID&quot;</span>:</div>
<div class="line"><a id="l01006" name="l01006"></a><span class="lineno"> 1006</span>                    maps7575.append(row)</div>
<div class="line"><a id="l01007" name="l01007"></a><span class="lineno"> 1007</span>                    print(row)</div>
<div class="line"><a id="l01008" name="l01008"></a><span class="lineno"> 1008</span>                <span class="keywordflow">elif</span> row[1] == <span class="stringliteral">&quot;15X15 GRID&quot;</span>:</div>
<div class="line"><a id="l01009" name="l01009"></a><span class="lineno"> 1009</span>                    maps1515.append(row)</div>
<div class="line"><a id="l01010" name="l01010"></a><span class="lineno"> 1010</span>                    print(row)</div>
<div class="line"><a id="l01011" name="l01011"></a><span class="lineno"> 1011</span>                <span class="keywordflow">elif</span> row[1] == <span class="stringliteral">&quot;30X60 GRID&quot;</span>:</div>
<div class="line"><a id="l01012" name="l01012"></a><span class="lineno"> 1012</span>                    maps3060.append(row)</div>
<div class="line"><a id="l01013" name="l01013"></a><span class="lineno"> 1013</span>                <span class="keywordflow">elif</span> row[1] == <span class="stringliteral">&quot;1X2 GRID&quot;</span>:</div>
<div class="line"><a id="l01014" name="l01014"></a><span class="lineno"> 1014</span>                    maps12.append(row)</div>
<div class="line"><a id="l01015" name="l01015"></a><span class="lineno"> 1015</span>        <span class="comment"># print([item[3] for item in maps7575] )</span></div>
<div class="line"><a id="l01016" name="l01016"></a><span class="lineno"> 1016</span>        <span class="comment"># # for debugging</span></div>
<div class="line"><a id="l01017" name="l01017"></a><span class="lineno"> 1017</span>        <span class="comment"># for amap in maps7575:</span></div>
<div class="line"><a id="l01018" name="l01018"></a><span class="lineno"> 1018</span>        <span class="comment">#     tifname = amap[2][0:-4] + &quot;_t.tif&quot;</span></div>
<div class="line"><a id="l01019" name="l01019"></a><span class="lineno"> 1019</span>        <span class="comment">#     xmlname = amap[2][0:-4] + &quot;.xml&quot;</span></div>
<div class="line"><a id="l01020" name="l01020"></a><span class="lineno"> 1020</span>        <span class="comment">#     shutil.copy(os.path.join(tifdir,tifname),scratch)</span></div>
<div class="line"><a id="l01021" name="l01021"></a><span class="lineno"> 1021</span>        <span class="comment">#     shutil.copy(os.path.join(tifdir,xmlname),scratch)</span></div>
<div class="line"><a id="l01022" name="l01022"></a><span class="lineno"> 1022</span> </div>
<div class="line"><a id="l01023" name="l01023"></a><span class="lineno"> 1023</span>        <span class="comment"># dedup the duplicated years</span></div>
<div class="line"><a id="l01024" name="l01024"></a><span class="lineno"> 1024</span>        maps7575 = <a class="code hl_function" href="namespace_u_s_topo_search__prod.html#af83c368ccf3a3e3bdc0b3b8079045a4b">dedupMaplist</a>(maps7575)</div>
<div class="line"><a id="l01025" name="l01025"></a><span class="lineno"> 1025</span>        maps1515 = <a class="code hl_function" href="namespace_u_s_topo_search__prod.html#af83c368ccf3a3e3bdc0b3b8079045a4b">dedupMaplist</a>(maps1515)</div>
<div class="line"><a id="l01026" name="l01026"></a><span class="lineno"> 1026</span>        maps3060 = <a class="code hl_function" href="namespace_u_s_topo_search__prod.html#af83c368ccf3a3e3bdc0b3b8079045a4b">dedupMaplist</a>(maps3060)</div>
<div class="line"><a id="l01027" name="l01027"></a><span class="lineno"> 1027</span>        maps12 = <a class="code hl_function" href="namespace_u_s_topo_search__prod.html#af83c368ccf3a3e3bdc0b3b8079045a4b">dedupMaplist</a>(maps12)</div>
<div class="line"><a id="l01028" name="l01028"></a><span class="lineno"> 1028</span> </div>
<div class="line"><a id="l01029" name="l01029"></a><span class="lineno"> 1029</span>        logger.debug(<span class="stringliteral">&quot;#4&quot;</span>)</div>
<div class="line"><a id="l01030" name="l01030"></a><span class="lineno"> 1030</span>        <span class="keywordflow">print</span> (<span class="stringliteral">&quot;#4 &quot;</span> + time.strftime(<span class="stringliteral">&#39;%Y-%m-%d %H:%M:%S&#39;</span>, time.localtime()))</div>
<div class="line"><a id="l01031" name="l01031"></a><span class="lineno"> 1031</span>        <span class="comment"># # count for the same year, how many cells (adjacent sheets)</span></div>
<div class="line"><a id="l01032" name="l01032"></a><span class="lineno"> 1032</span>        <span class="comment"># count7575 = countSheets(maps7575)</span></div>
<div class="line"><a id="l01033" name="l01033"></a><span class="lineno"> 1033</span>        <span class="comment"># count1515 = countSheets(maps1515)</span></div>
<div class="line"><a id="l01034" name="l01034"></a><span class="lineno"> 1034</span>        <span class="comment"># count3060 = countSheets(maps3060)</span></div>
<div class="line"><a id="l01035" name="l01035"></a><span class="lineno"> 1035</span>        <span class="comment"># count12 = countSheets(maps12)</span></div>
<div class="line"><a id="l01036" name="l01036"></a><span class="lineno"> 1036</span> </div>
<div class="line"><a id="l01037" name="l01037"></a><span class="lineno"> 1037</span>        <span class="comment"># reorganize data structure</span></div>
<div class="line"><a id="l01038" name="l01038"></a><span class="lineno"><a class="line" href="namespace_u_s_topo_search__prod.html#a0197a395b3e906aa97ed95c6150e96c9"> 1038</a></span>        (dict7575,dict7575_s) = <a class="code hl_function" href="namespace_u_s_topo_search__prod.html#acbb1435522472ef5bb040353ce851352">reorgByYear</a>(maps7575)  <span class="comment"># {1975: geopdf.pdf, 1973: ...}</span></div>
<div class="line"><a id="l01039" name="l01039"></a><span class="lineno"><a class="line" href="namespace_u_s_topo_search__prod.html#a6b51fcd0494face0ed55381ac145ffcc"> 1039</a></span>        (dict1515,dict1515_s) = <a class="code hl_function" href="namespace_u_s_topo_search__prod.html#acbb1435522472ef5bb040353ce851352">reorgByYear</a>(maps1515)</div>
<div class="line"><a id="l01040" name="l01040"></a><span class="lineno"><a class="line" href="namespace_u_s_topo_search__prod.html#ab5a0085beed2b0ac3084ec1e374a7d39"> 1040</a></span>        (dict3060,dict3060_s) = <a class="code hl_function" href="namespace_u_s_topo_search__prod.html#acbb1435522472ef5bb040353ce851352">reorgByYear</a>(maps3060)</div>
<div class="line"><a id="l01041" name="l01041"></a><span class="lineno"><a class="line" href="namespace_u_s_topo_search__prod.html#a1f0826864f4ee2e68b018b29e0c958b3"> 1041</a></span>        (dict12,dict12_s) = <a class="code hl_function" href="namespace_u_s_topo_search__prod.html#acbb1435522472ef5bb040353ce851352">reorgByYear</a>(maps12)</div>
<div class="line"><a id="l01042" name="l01042"></a><span class="lineno"> 1042</span> </div>
<div class="line"><a id="l01043" name="l01043"></a><span class="lineno"> 1043</span>        <span class="comment"># -----------------------------------------------------------------------------------------------------------</span></div>
<div class="line"><a id="l01044" name="l01044"></a><span class="lineno"> 1044</span>        <span class="comment"># # UNCOMMENT TO REMOVE BLANK MAPS</span></div>
<div class="line"><a id="l01045" name="l01045"></a><span class="lineno"> 1045</span>        <span class="comment"># del dict7575[&#39;1998&#39;]</span></div>
<div class="line"><a id="l01046" name="l01046"></a><span class="lineno"> 1046</span>        <span class="comment"># del dict7575_s[&#39;1998&#39;]</span></div>
<div class="line"><a id="l01047" name="l01047"></a><span class="lineno"> 1047</span>  </div>
<div class="line"><a id="l01048" name="l01048"></a><span class="lineno"> 1048</span>        <span class="comment"># del dict1515[&#39;1929&#39;]</span></div>
<div class="line"><a id="l01049" name="l01049"></a><span class="lineno"> 1049</span>        <span class="comment"># del dict1515_s[&#39;1929&#39;]</span></div>
<div class="line"><a id="l01050" name="l01050"></a><span class="lineno"> 1050</span>        <span class="comment"># del dict1515[&#39;1931&#39;]</span></div>
<div class="line"><a id="l01051" name="l01051"></a><span class="lineno"> 1051</span>        <span class="comment"># del dict1515_s[&#39;1931&#39;]</span></div>
<div class="line"><a id="l01052" name="l01052"></a><span class="lineno"> 1052</span>        <span class="comment"># -----------------------------------------------------------------------------------------------------------</span></div>
<div class="line"><a id="l01053" name="l01053"></a><span class="lineno"> 1053</span> </div>
<div class="line"><a id="l01054" name="l01054"></a><span class="lineno"> 1054</span>        logger.debug(<span class="stringliteral">&quot;#5&quot;</span>)</div>
<div class="line"><a id="l01055" name="l01055"></a><span class="lineno"> 1055</span>        <span class="comment"># outputPdfname = &quot;map_&quot; + OrderNumText + &quot;.pdf&quot;</span></div>
<div class="line"><a id="l01056" name="l01056"></a><span class="lineno"> 1056</span>        <span class="keywordflow">print</span> (is_aei)</div>
<div class="line"><a id="l01057" name="l01057"></a><span class="lineno"> 1057</span>        <span class="keywordflow">if</span> is_aei == <span class="stringliteral">&#39;Y&#39;</span>:</div>
<div class="line"><a id="l01058" name="l01058"></a><span class="lineno"><a class="line" href="namespace_u_s_topo_search__prod.html#a241dfc002529fc26a5fbee5c7220c047"> 1058</a></span>            comb7515 = {}</div>
<div class="line"><a id="l01059" name="l01059"></a><span class="lineno"><a class="line" href="namespace_u_s_topo_search__prod.html#a6c7ff404b797785124442cbef895375b"> 1059</a></span>            comb7515_s = {}</div>
<div class="line"><a id="l01060" name="l01060"></a><span class="lineno"> 1060</span>            comb7515.update(dict1515)</div>
<div class="line"><a id="l01061" name="l01061"></a><span class="lineno"> 1061</span>            comb7515.update(dict7575)</div>
<div class="line"><a id="l01062" name="l01062"></a><span class="lineno"> 1062</span>            comb7515_s.update(dict1515_s)</div>
<div class="line"><a id="l01063" name="l01063"></a><span class="lineno"> 1063</span>            comb7515_s.update(dict7575_s)</div>
<div class="line"><a id="l01064" name="l01064"></a><span class="lineno"> 1064</span> </div>
<div class="line"><a id="l01065" name="l01065"></a><span class="lineno"> 1065</span>            <a class="code hl_function" href="namespace_u_s_topo_search__prod.html#a2a4e32a7e190d24140a7b794c29a8b28">createPDF</a>(<span class="stringliteral">&quot;15-7.5&quot;</span>,comb7515,comb7515_s,<span class="stringliteral">&quot;map_&quot;</span> + OrderNumText + <span class="stringliteral">&quot;_7515.pdf&quot;</span>)</div>
<div class="line"><a id="l01066" name="l01066"></a><span class="lineno"> 1066</span>        <span class="keywordflow">else</span>:</div>
<div class="line"><a id="l01067" name="l01067"></a><span class="lineno"> 1067</span>            print(<span class="stringliteral">&quot;dict7575: &quot;</span> + str(dict7575.keys()))</div>
<div class="line"><a id="l01068" name="l01068"></a><span class="lineno"> 1068</span>            print(<span class="stringliteral">&quot;dict7575_s: &quot;</span> + str(dict7575_s.keys()))</div>
<div class="line"><a id="l01069" name="l01069"></a><span class="lineno"> 1069</span>            <a class="code hl_function" href="namespace_u_s_topo_search__prod.html#a2a4e32a7e190d24140a7b794c29a8b28">createPDF</a>(<span class="stringliteral">&quot;7.5&quot;</span>,dict7575,dict7575_s,<span class="stringliteral">&quot;map_&quot;</span> + OrderNumText + <span class="stringliteral">&quot;_75.pdf&quot;</span>)</div>
<div class="line"><a id="l01070" name="l01070"></a><span class="lineno"> 1070</span>            <a class="code hl_function" href="namespace_u_s_topo_search__prod.html#a2a4e32a7e190d24140a7b794c29a8b28">createPDF</a>(<span class="stringliteral">&quot;15&quot;</span>,dict1515,dict1515_s,<span class="stringliteral">&quot;map_&quot;</span> + OrderNumText + <span class="stringliteral">&quot;_15.pdf&quot;</span>)</div>
<div class="line"><a id="l01071" name="l01071"></a><span class="lineno"> 1071</span> </div>
<div class="line"><a id="l01072" name="l01072"></a><span class="lineno"><a class="line" href="namespace_u_s_topo_search__prod.html#a8b4fb8e932e5ae109d3085b48722c972"> 1072</a></span>        summarypdf = os.path.join(scratch,<span class="stringliteral">&#39;summary.pdf&#39;</span>)</div>
<div class="line"><a id="l01073" name="l01073"></a><span class="lineno"><a class="line" href="namespace_u_s_topo_search__prod.html#a997632e9d3d1e4c5403dca3158ca87b3"> 1073</a></span>        tabledata = []</div>
<div class="line"><a id="l01074" name="l01074"></a><span class="lineno"><a class="line" href="namespace_u_s_topo_search__prod.html#a295acb6165cdbfb68ba9a39f7a7a5368"> 1074</a></span>        summarydata = []</div>
<div class="line"><a id="l01075" name="l01075"></a><span class="lineno"><a class="line" href="namespace_u_s_topo_search__prod.html#a288bf36a4331f869e18aa12d9275287f"> 1075</a></span>        topoSource = <span class="stringliteral">&#39;USGS&#39;</span></div>
<div class="line"><a id="l01076" name="l01076"></a><span class="lineno"> 1076</span> </div>
<div class="line"><a id="l01077" name="l01077"></a><span class="lineno"> 1077</span>        <span class="keywordflow">if</span> is_aei == <span class="stringliteral">&#39;Y&#39;</span>:</div>
<div class="line"><a id="l01078" name="l01078"></a><span class="lineno"><a class="line" href="namespace_u_s_topo_search__prod.html#a827b8d0cea19fb29fe5cd9f1b4a51113"> 1078</a></span>            tempyears = comb7515_s.keys()</div>
<div class="line"><a id="l01079" name="l01079"></a><span class="lineno"><a class="line" href="namespace_u_s_topo_search__prod.html#a7a90beed2a94d965ee4ef219947c43b6"> 1079</a></span>            tempyears.sort(reverse = <span class="keyword">False</span>)</div>
<div class="line"><a id="l01080" name="l01080"></a><span class="lineno"> 1080</span>            <span class="keywordflow">for</span> year <span class="keywordflow">in</span> tempyears:</div>
<div class="line"><a id="l01081" name="l01081"></a><span class="lineno"> 1081</span>                <span class="keywordflow">if</span> year != <span class="stringliteral">&quot;&quot;</span>:</div>
<div class="line"><a id="l01082" name="l01082"></a><span class="lineno"> 1082</span>                    <span class="keywordflow">if</span> comb7515_s[year][0].split(<span class="stringliteral">&#39;_&#39;</span>)[-2] == <span class="stringliteral">&#39;24000&#39;</span>:</div>
<div class="line"><a id="l01083" name="l01083"></a><span class="lineno"> 1083</span>                        tabledata.append([year,<span class="stringliteral">&#39;7.5&#39;</span>])</div>
<div class="line"><a id="l01084" name="l01084"></a><span class="lineno"> 1084</span>                        summarydata.append([year,<span class="stringliteral">&#39;7.5&#39;</span>,topoSource])</div>
<div class="line"><a id="l01085" name="l01085"></a><span class="lineno"> 1085</span>                    <span class="keywordflow">elif</span> comb7515_s[year][0].split(<span class="stringliteral">&#39;_&#39;</span>)[-2] == <span class="stringliteral">&#39;62500&#39;</span>:</div>
<div class="line"><a id="l01086" name="l01086"></a><span class="lineno"> 1086</span>                        tabledata.append([year,<span class="stringliteral">&#39;15&#39;</span>])</div>
<div class="line"><a id="l01087" name="l01087"></a><span class="lineno"> 1087</span>                        summarydata.append([year,<span class="stringliteral">&#39;15&#39;</span>,topoSource])</div>
<div class="line"><a id="l01088" name="l01088"></a><span class="lineno"> 1088</span>                    <span class="keywordflow">else</span>:</div>
<div class="line"><a id="l01089" name="l01089"></a><span class="lineno"> 1089</span>                        tabledata.append([year,<span class="stringliteral">&#39;7.5&#39;</span>])</div>
<div class="line"><a id="l01090" name="l01090"></a><span class="lineno"> 1090</span>                        summarydata.append([year,<span class="stringliteral">&#39;7.5&#39;</span>,topoSource])</div>
<div class="line"><a id="l01091" name="l01091"></a><span class="lineno"> 1091</span>            tempyears = <span class="keywordtype">None</span></div>
<div class="line"><a id="l01092" name="l01092"></a><span class="lineno"> 1092</span> </div>
<div class="line"><a id="l01093" name="l01093"></a><span class="lineno"> 1093</span>        <span class="keywordflow">else</span>:</div>
<div class="line"><a id="l01094" name="l01094"></a><span class="lineno"> 1094</span>            tempyears = dict7575.keys()</div>
<div class="line"><a id="l01095" name="l01095"></a><span class="lineno"> 1095</span>            tempyears.sort(reverse = <span class="keyword">True</span>)</div>
<div class="line"><a id="l01096" name="l01096"></a><span class="lineno"> 1096</span>            <span class="keywordflow">for</span> year <span class="keywordflow">in</span> tempyears:</div>
<div class="line"><a id="l01097" name="l01097"></a><span class="lineno"> 1097</span>                <span class="keywordflow">if</span> year != <span class="stringliteral">&quot;&quot;</span>:</div>
<div class="line"><a id="l01098" name="l01098"></a><span class="lineno"> 1098</span>                    tabledata.append([year,<span class="stringliteral">&#39;7.5&#39;</span>])</div>
<div class="line"><a id="l01099" name="l01099"></a><span class="lineno"> 1099</span>                    summarydata.append([year,<span class="stringliteral">&#39;7.5&#39;</span>,topoSource])</div>
<div class="line"><a id="l01100" name="l01100"></a><span class="lineno"> 1100</span>            tempyears = <span class="keywordtype">None</span></div>
<div class="line"><a id="l01101" name="l01101"></a><span class="lineno"> 1101</span> </div>
<div class="line"><a id="l01102" name="l01102"></a><span class="lineno"> 1102</span>            tempyears = dict1515.keys()</div>
<div class="line"><a id="l01103" name="l01103"></a><span class="lineno"> 1103</span>            tempyears.sort(reverse = <span class="keyword">True</span>)</div>
<div class="line"><a id="l01104" name="l01104"></a><span class="lineno"> 1104</span>            <span class="keywordflow">for</span> year <span class="keywordflow">in</span> tempyears:</div>
<div class="line"><a id="l01105" name="l01105"></a><span class="lineno"> 1105</span>                <span class="keywordflow">if</span> year != <span class="stringliteral">&quot;&quot;</span>:</div>
<div class="line"><a id="l01106" name="l01106"></a><span class="lineno"> 1106</span>                    tabledata.append([year,<span class="stringliteral">&#39;15&#39;</span>])</div>
<div class="line"><a id="l01107" name="l01107"></a><span class="lineno"> 1107</span>                    summarydata.append([year,<span class="stringliteral">&#39;15&#39;</span>,topoSource])</div>
<div class="line"><a id="l01108" name="l01108"></a><span class="lineno"> 1108</span>            tempyears = <span class="keywordtype">None</span></div>
<div class="line"><a id="l01109" name="l01109"></a><span class="lineno"> 1109</span> </div>
<div class="line"><a id="l01110" name="l01110"></a><span class="lineno"><a class="line" href="namespace_u_s_topo_search__prod.html#a4e4bf8279220b7aeade1e494dc916486"> 1110</a></span>        pagesize = portrait(letter)</div>
<div class="line"><a id="l01111" name="l01111"></a><span class="lineno"> 1111</span>        [PAGE_WIDTH,PAGE_HEIGHT]=pagesize[:2]</div>
<div class="line"><a id="l01112" name="l01112"></a><span class="lineno"><a class="line" href="namespace_u_s_topo_search__prod.html#ada69121fdff73bd8736953b757f849cd"> 1112</a></span>        PAGE_WIDTH=int(PAGE_WIDTH)</div>
<div class="line"><a id="l01113" name="l01113"></a><span class="lineno"><a class="line" href="namespace_u_s_topo_search__prod.html#a929c341657b49556f765b46e3b963854"> 1113</a></span>        PAGE_HEIGHT=int(PAGE_HEIGHT)</div>
<div class="line"><a id="l01114" name="l01114"></a><span class="lineno"> 1114</span> </div>
<div class="line"><a id="l01115" name="l01115"></a><span class="lineno"><a class="line" href="namespace_u_s_topo_search__prod.html#afa4524019a185b509eaef650f0e4a7e9"> 1115</a></span>        styles = getSampleStyleSheet()</div>
<div class="line"><a id="l01116" name="l01116"></a><span class="lineno"> 1116</span> </div>
<div class="line"><a id="l01117" name="l01117"></a><span class="lineno"><a class="line" href="namespace_u_s_topo_search__prod.html#a9eb3d2941e8e43397b5a2f7f87624ccb"> 1117</a></span>        coverPDF = os.path.join(scratch,<span class="stringliteral">&quot;cover.pdf&quot;</span>)</div>
<div class="line"><a id="l01118" name="l01118"></a><span class="lineno"> 1118</span>        <a class="code hl_function" href="namespace_u_s_topo_search__prod.html#a8978d27d7fad9f078b8704e8ce2ca876">goCoverPage</a>(coverPDF)</div>
<div class="line"><a id="l01119" name="l01119"></a><span class="lineno"> 1119</span>        <a class="code hl_function" href="namespace_u_s_topo_search__prod.html#ad3a195c7e937aa78014835dfe8448284">goSummaryPage</a>(summarypdf,tabledata)</div>
<div class="line"><a id="l01120" name="l01120"></a><span class="lineno"> 1120</span> </div>
<div class="line"><a id="l01121" name="l01121"></a><span class="lineno"><a class="line" href="namespace_u_s_topo_search__prod.html#a7bfaac84bf0fd1f3390910596caa358f"> 1121</a></span>        output = PdfFileWriter()</div>
<div class="line"><a id="l01122" name="l01122"></a><span class="lineno"><a class="line" href="namespace_u_s_topo_search__prod.html#a95c2e7945078e2365163a289c9d593fe"> 1122</a></span>        coverPages = PdfFileReader(open(coverPDF,<span class="stringliteral">&#39;rb&#39;</span>))</div>
<div class="line"><a id="l01123" name="l01123"></a><span class="lineno"><a class="line" href="namespace_u_s_topo_search__prod.html#a5e082d76024b3d2abf30017deaff62a7"> 1123</a></span>        summaryPages = PdfFileReader(open(os.path.join(scratch,summarypdf),<span class="stringliteral">&#39;rb&#39;</span>))</div>
<div class="line"><a id="l01124" name="l01124"></a><span class="lineno"> 1124</span>        output.addPage(coverPages.getPage(0))</div>
<div class="line"><a id="l01125" name="l01125"></a><span class="lineno"> 1125</span>        coverPages= <span class="keywordtype">None</span></div>
<div class="line"><a id="l01126" name="l01126"></a><span class="lineno"> 1126</span>        output.addPage(summaryPages.getPage(0))</div>
<div class="line"><a id="l01127" name="l01127"></a><span class="lineno"> 1127</span>        summaryPages=<span class="keywordtype">None</span></div>
<div class="line"><a id="l01128" name="l01128"></a><span class="lineno"> 1128</span>        output.addBookmark(<span class="stringliteral">&quot;Cover Page&quot;</span>,0)</div>
<div class="line"><a id="l01129" name="l01129"></a><span class="lineno"> 1129</span>        output.addBookmark(<span class="stringliteral">&quot;Summary&quot;</span>,1)</div>
<div class="line"><a id="l01130" name="l01130"></a><span class="lineno"> 1130</span> </div>
<div class="line"><a id="l01131" name="l01131"></a><span class="lineno"> 1131</span><span class="comment"># Save Summary ##########################################################</span></div>
<div class="line"><a id="l01132" name="l01132"></a><span class="lineno"><a class="line" href="namespace_u_s_topo_search__prod.html#aa656515934f2d29d3292640de4d5f308"> 1132</a></span>        summarylist = {<span class="stringliteral">&quot;ORDER_ID&quot;</span>:OrderIDText,<span class="stringliteral">&quot;FILENAME&quot;</span>:pdfreport,<span class="stringliteral">&quot;SUMMARY&quot;</span>:summarydata}</div>
<div class="line"><a id="l01133" name="l01133"></a><span class="lineno"> 1133</span>        <span class="comment"># print (summarylist)</span></div>
<div class="line"><a id="l01134" name="l01134"></a><span class="lineno"><a class="line" href="namespace_u_s_topo_search__prod.html#a9864c625caebeb73492617f806650ee2"> 1134</a></span>        topassorc = json.dumps(summarylist,ensure_ascii=<span class="keyword">False</span>)</div>
<div class="line"><a id="l01135" name="l01135"></a><span class="lineno"> 1135</span>        <span class="keywordflow">try</span>:</div>
<div class="line"><a id="l01136" name="l01136"></a><span class="lineno"> 1136</span>            con = cx_Oracle.connect(connectionString)</div>
<div class="line"><a id="l01137" name="l01137"></a><span class="lineno"> 1137</span>            cur = con.cursor()</div>
<div class="line"><a id="l01138" name="l01138"></a><span class="lineno"> 1138</span> </div>
<div class="line"><a id="l01139" name="l01139"></a><span class="lineno"><a class="line" href="namespace_u_s_topo_search__prod.html#aeef163746a773e35105803337f45094a"> 1139</a></span>            orc_return = cur.callfunc(<span class="stringliteral">&#39;eris_gis.AddTopoSummary&#39;</span>, str, (str(topassorc),))</div>
<div class="line"><a id="l01140" name="l01140"></a><span class="lineno"> 1140</span>            <span class="keywordflow">if</span> orc_return == <span class="stringliteral">&#39;Success&#39;</span>:</div>
<div class="line"><a id="l01141" name="l01141"></a><span class="lineno"> 1141</span>                <span class="keywordflow">print</span> (<span class="stringliteral">&quot;Summary successfully populated to Oracle&quot;</span>)</div>
<div class="line"><a id="l01142" name="l01142"></a><span class="lineno"> 1142</span>            <span class="keywordflow">else</span>:</div>
<div class="line"><a id="l01143" name="l01143"></a><span class="lineno"> 1143</span>                <span class="keywordflow">print</span> (<span class="stringliteral">&quot;Summary failed to populate to Oracle, check DB admin&quot;</span>)</div>
<div class="line"><a id="l01144" name="l01144"></a><span class="lineno"> 1144</span>        <span class="keywordflow">except</span> Exception <span class="keyword">as</span> e:</div>
<div class="line"><a id="l01145" name="l01145"></a><span class="lineno"> 1145</span>            logger.error(<span class="stringliteral">&quot;Function error, &quot;</span> + str(e))</div>
<div class="line"><a id="l01146" name="l01146"></a><span class="lineno"> 1146</span>            <span class="keywordflow">raise</span></div>
<div class="line"><a id="l01147" name="l01147"></a><span class="lineno"> 1147</span>        <span class="keywordflow">finally</span>:</div>
<div class="line"><a id="l01148" name="l01148"></a><span class="lineno"> 1148</span>            cur.close()</div>
<div class="line"><a id="l01149" name="l01149"></a><span class="lineno"> 1149</span>            con.close()</div>
<div class="line"><a id="l01150" name="l01150"></a><span class="lineno"> 1150</span> </div>
<div class="line"><a id="l01151" name="l01151"></a><span class="lineno"> 1151</span>        <span class="keywordflow">if</span> is_aei == <span class="stringliteral">&#39;Y&#39;</span>:</div>
<div class="line"><a id="l01152" name="l01152"></a><span class="lineno"> 1152</span> </div>
<div class="line"><a id="l01153" name="l01153"></a><span class="lineno"><a class="line" href="namespace_u_s_topo_search__prod.html#ab780fd6e6f75483e9a3b2dbdfbaa0c14"> 1153</a></span>            j = 0</div>
<div class="line"><a id="l01154" name="l01154"></a><span class="lineno"> 1154</span>            <span class="keywordflow">if</span> len(comb7515) &gt; 0:</div>
<div class="line"><a id="l01155" name="l01155"></a><span class="lineno"><a class="line" href="namespace_u_s_topo_search__prod.html#a483055e65a2e00b3b465e192f8d667e4"> 1155</a></span>                map1575Pages = PdfFileReader(open(os.path.join(scratch,<span class="stringliteral">&quot;map_&quot;</span> + OrderNumText+<span class="stringliteral">&quot;_7515.pdf&quot;</span>),<span class="stringliteral">&#39;rb&#39;</span>))</div>
<div class="line"><a id="l01156" name="l01156"></a><span class="lineno"><a class="line" href="namespace_u_s_topo_search__prod.html#a4957dadfe4b04d1f36082051485e610a"> 1156</a></span>                years = comb7515.keys()</div>
<div class="line"><a id="l01157" name="l01157"></a><span class="lineno"> 1157</span>                years.sort(reverse = <span class="keyword">False</span>)</div>
<div class="line"><a id="l01158" name="l01158"></a><span class="lineno"> 1158</span>                print(<span class="stringliteral">&quot;==========years 7515&quot;</span>)</div>
<div class="line"><a id="l01159" name="l01159"></a><span class="lineno"> 1159</span>                <span class="keywordflow">for</span> year <span class="keywordflow">in</span> years:</div>
<div class="line"><a id="l01160" name="l01160"></a><span class="lineno"> 1160</span>                    <span class="keywordflow">if</span> year == <span class="stringliteral">&quot;&quot;</span>:</div>
<div class="line"><a id="l01161" name="l01161"></a><span class="lineno"> 1161</span>                        years.remove(<span class="stringliteral">&quot;&quot;</span>)</div>
<div class="line"><a id="l01162" name="l01162"></a><span class="lineno"> 1162</span>                print(years)</div>
<div class="line"><a id="l01163" name="l01163"></a><span class="lineno"> 1163</span> </div>
<div class="line"><a id="l01164" name="l01164"></a><span class="lineno"> 1164</span>                <span class="keywordflow">for</span> year <span class="keywordflow">in</span> years:</div>
<div class="line"><a id="l01165" name="l01165"></a><span class="lineno"><a class="line" href="namespace_u_s_topo_search__prod.html#a544aa385a1ed61f2bd1a4d89d32783b4"> 1165</a></span>                    page = map1575Pages.getPage(j)</div>
<div class="line"><a id="l01166" name="l01166"></a><span class="lineno"> 1166</span>                    output.addPage(page)</div>
<div class="line"><a id="l01167" name="l01167"></a><span class="lineno"> 1167</span>                    <span class="keywordflow">if</span> comb7515_s[year][0].split(<span class="stringliteral">&#39;_&#39;</span>)[-2] <span class="keywordflow">in</span> [<span class="stringliteral">&#39;24000&#39;</span>,<span class="stringliteral">&#39;31680&#39;</span>] <span class="keywordflow">and</span> year &lt; 2008:</div>
<div class="line"><a id="l01168" name="l01168"></a><span class="lineno"><a class="line" href="namespace_u_s_topo_search__prod.html#a6291d1995278f642441a2356e60389de"> 1168</a></span>                        seriesbkm = <span class="stringliteral">&#39;7.5&#39;</span></div>
<div class="line"><a id="l01169" name="l01169"></a><span class="lineno"> 1169</span>                    <span class="keywordflow">elif</span> comb7515_s[year][0].split(<span class="stringliteral">&#39;_&#39;</span>)[-2] == <span class="stringliteral">&#39;62500&#39;</span>:</div>
<div class="line"><a id="l01170" name="l01170"></a><span class="lineno"> 1170</span>                        seriesbkm = <span class="stringliteral">&#39;15&#39;</span></div>
<div class="line"><a id="l01171" name="l01171"></a><span class="lineno"> 1171</span>                    <span class="keywordflow">else</span>:</div>
<div class="line"><a id="l01172" name="l01172"></a><span class="lineno"> 1172</span>                        seriesbkm = <span class="stringliteral">&#39;7.5&#39;</span></div>
<div class="line"><a id="l01173" name="l01173"></a><span class="lineno"> 1173</span>                    output.addBookmark(year+<span class="stringliteral">&quot;_&quot;</span>+seriesbkm,j+2)</div>
<div class="line"><a id="l01174" name="l01174"></a><span class="lineno"> 1174</span>                    j=j+1</div>
<div class="line"><a id="l01175" name="l01175"></a><span class="lineno"> 1175</span>                    page = <span class="keywordtype">None</span></div>
<div class="line"><a id="l01176" name="l01176"></a><span class="lineno"> 1176</span> </div>
<div class="line"><a id="l01177" name="l01177"></a><span class="lineno"> 1177</span>        <span class="keywordflow">else</span>:</div>
<div class="line"><a id="l01178" name="l01178"></a><span class="lineno"><a class="line" href="namespace_u_s_topo_search__prod.html#a62590b24b2beae7ca3e58cebfdbffd65"> 1178</a></span>            i=0</div>
<div class="line"><a id="l01179" name="l01179"></a><span class="lineno"> 1179</span>            <span class="keywordflow">if</span> len(dict7575) &gt; 0:</div>
<div class="line"><a id="l01180" name="l01180"></a><span class="lineno"><a class="line" href="namespace_u_s_topo_search__prod.html#afd23bdce6c8d728f4b4a34efc97f35c6"> 1180</a></span>                map7575Pages = PdfFileReader(open(os.path.join(scratch,<span class="stringliteral">&quot;map_&quot;</span> + OrderNumText+<span class="stringliteral">&quot;_75.pdf&quot;</span>),<span class="stringliteral">&#39;rb&#39;</span>))</div>
<div class="line"><a id="l01181" name="l01181"></a><span class="lineno"> 1181</span>                years = dict7575.keys()</div>
<div class="line"><a id="l01182" name="l01182"></a><span class="lineno"> 1182</span>                years.sort(reverse = <span class="keyword">True</span>)</div>
<div class="line"><a id="l01183" name="l01183"></a><span class="lineno"> 1183</span>                print(<span class="stringliteral">&quot;==========years 7575&quot;</span>)</div>
<div class="line"><a id="l01184" name="l01184"></a><span class="lineno"> 1184</span>                <span class="keywordflow">for</span> year <span class="keywordflow">in</span> years:</div>
<div class="line"><a id="l01185" name="l01185"></a><span class="lineno"> 1185</span>                    <span class="keywordflow">if</span> year == <span class="stringliteral">&quot;&quot;</span>:</div>
<div class="line"><a id="l01186" name="l01186"></a><span class="lineno"> 1186</span>                        years.remove(<span class="stringliteral">&quot;&quot;</span>)</div>
<div class="line"><a id="l01187" name="l01187"></a><span class="lineno"> 1187</span>                print(years)</div>
<div class="line"><a id="l01188" name="l01188"></a><span class="lineno"> 1188</span> </div>
<div class="line"><a id="l01189" name="l01189"></a><span class="lineno"> 1189</span>                <span class="keywordflow">for</span> year <span class="keywordflow">in</span> years:</div>
<div class="line"><a id="l01190" name="l01190"></a><span class="lineno"> 1190</span>                    page = map7575Pages.getPage(i)</div>
<div class="line"><a id="l01191" name="l01191"></a><span class="lineno"> 1191</span>                    <span class="comment"># if is_nova == &#39;N&#39;:</span></div>
<div class="line"><a id="l01192" name="l01192"></a><span class="lineno"> 1192</span>                    <span class="comment">#    page.mergePage(logopage)</span></div>
<div class="line"><a id="l01193" name="l01193"></a><span class="lineno"> 1193</span>                    output.addPage(page)</div>
<div class="line"><a id="l01194" name="l01194"></a><span class="lineno"> 1194</span>                    <span class="comment"># output.addPage(map7575Pages.getPage(i))</span></div>
<div class="line"><a id="l01195" name="l01195"></a><span class="lineno"> 1195</span>                    output.addBookmark(year+<span class="stringliteral">&quot;_7.5&quot;</span>,i+2)   <span class="comment"># i+1 to accomodate the summary page</span></div>
<div class="line"><a id="l01196" name="l01196"></a><span class="lineno"> 1196</span>                    i = i + 1</div>
<div class="line"><a id="l01197" name="l01197"></a><span class="lineno"> 1197</span>                    page = <span class="keywordtype">None</span></div>
<div class="line"><a id="l01198" name="l01198"></a><span class="lineno"> 1198</span> </div>
<div class="line"><a id="l01199" name="l01199"></a><span class="lineno"> 1199</span>            j=0</div>
<div class="line"><a id="l01200" name="l01200"></a><span class="lineno"> 1200</span>            <span class="keywordflow">if</span> len(dict1515) &gt; 0:</div>
<div class="line"><a id="l01201" name="l01201"></a><span class="lineno"><a class="line" href="namespace_u_s_topo_search__prod.html#a22d751e5fb7ca8d5a379d07b14b4c362"> 1201</a></span>                map1515Pages = PdfFileReader(open(os.path.join(scratch,<span class="stringliteral">&quot;map_&quot;</span> + OrderNumText+<span class="stringliteral">&quot;_15.pdf&quot;</span>),<span class="stringliteral">&#39;rb&#39;</span>))</div>
<div class="line"><a id="l01202" name="l01202"></a><span class="lineno"> 1202</span>                years = dict1515.keys()</div>
<div class="line"><a id="l01203" name="l01203"></a><span class="lineno"> 1203</span>                years.sort(reverse = <span class="keyword">True</span>)</div>
<div class="line"><a id="l01204" name="l01204"></a><span class="lineno"> 1204</span>                print(<span class="stringliteral">&quot;==========years 1515&quot;</span>)</div>
<div class="line"><a id="l01205" name="l01205"></a><span class="lineno"> 1205</span>                <span class="keywordflow">for</span> year <span class="keywordflow">in</span> years:</div>
<div class="line"><a id="l01206" name="l01206"></a><span class="lineno"> 1206</span>                    <span class="keywordflow">if</span> year == <span class="stringliteral">&quot;&quot;</span>:</div>
<div class="line"><a id="l01207" name="l01207"></a><span class="lineno"> 1207</span>                        years.remove(<span class="stringliteral">&quot;&quot;</span>)</div>
<div class="line"><a id="l01208" name="l01208"></a><span class="lineno"> 1208</span>                print(years)</div>
<div class="line"><a id="l01209" name="l01209"></a><span class="lineno"> 1209</span> </div>
<div class="line"><a id="l01210" name="l01210"></a><span class="lineno"> 1210</span>                <span class="keywordflow">for</span> year <span class="keywordflow">in</span> years:</div>
<div class="line"><a id="l01211" name="l01211"></a><span class="lineno"> 1211</span>                    page = map1515Pages.getPage(j)</div>
<div class="line"><a id="l01212" name="l01212"></a><span class="lineno"> 1212</span>                    <span class="comment"># page.mergePage(logopage)</span></div>
<div class="line"><a id="l01213" name="l01213"></a><span class="lineno"> 1213</span>                    output.addPage(page)</div>
<div class="line"><a id="l01214" name="l01214"></a><span class="lineno"> 1214</span>                    <span class="comment"># output.addPage(map1515Pages.getPage(j))</span></div>
<div class="line"><a id="l01215" name="l01215"></a><span class="lineno"> 1215</span>                    output.addBookmark(year+<span class="stringliteral">&quot;_15&quot;</span>,i+j+2)  <span class="comment"># +1 to accomodate the summary page</span></div>
<div class="line"><a id="l01216" name="l01216"></a><span class="lineno"> 1216</span>                    j = j + 1</div>
<div class="line"><a id="l01217" name="l01217"></a><span class="lineno"> 1217</span>                    page = <span class="keywordtype">None</span></div>
<div class="line"><a id="l01218" name="l01218"></a><span class="lineno"> 1218</span> </div>
<div class="line"><a id="l01219" name="l01219"></a><span class="lineno"><a class="line" href="namespace_u_s_topo_search__prod.html#a05812671f98daa5eb2cb7ae6ee8b9ed2"> 1219</a></span>        outputStream = open(os.path.join(scratch,pdfreport),<span class="stringliteral">&quot;wb&quot;</span>)</div>
<div class="line"><a id="l01220" name="l01220"></a><span class="lineno"> 1220</span>        output.setPageMode(<span class="stringliteral">&#39;/UseOutlines&#39;</span>)</div>
<div class="line"><a id="l01221" name="l01221"></a><span class="lineno"> 1221</span>        output.write(outputStream)</div>
<div class="line"><a id="l01222" name="l01222"></a><span class="lineno"> 1222</span>        outputStream.close()</div>
<div class="line"><a id="l01223" name="l01223"></a><span class="lineno"> 1223</span>        output = <span class="keywordtype">None</span></div>
<div class="line"><a id="l01224" name="l01224"></a><span class="lineno"> 1224</span>        summaryPages = <span class="keywordtype">None</span></div>
<div class="line"><a id="l01225" name="l01225"></a><span class="lineno"> 1225</span>        map7575Pages = <span class="keywordtype">None</span></div>
<div class="line"><a id="l01226" name="l01226"></a><span class="lineno"> 1226</span>        map1515Pages = <span class="keywordtype">None</span></div>
<div class="line"><a id="l01227" name="l01227"></a><span class="lineno"> 1227</span> </div>
<div class="line"><a id="l01228" name="l01228"></a><span class="lineno"> 1228</span>        <span class="keywordflow">print</span> (<span class="stringliteral">&quot;#5 &quot;</span> + time.strftime(<span class="stringliteral">&#39;%Y-%m-%d %H:%M:%S&#39;</span>, time.localtime()))</div>
<div class="line"><a id="l01229" name="l01229"></a><span class="lineno"> 1229</span> </div>
<div class="line"><a id="l01230" name="l01230"></a><span class="lineno"> 1230</span>        <span class="keywordflow">if</span> len(copydirs) &gt; 0:</div>
<div class="line"><a id="l01231" name="l01231"></a><span class="lineno"> 1231</span>            shutil.copy(os.path.join(scratch,pdfreport),os.path.join(scratch,deliverfolder))</div>
<div class="line"><a id="l01232" name="l01232"></a><span class="lineno"> 1232</span>            shutil.copy(readmefile,os.path.join(scratch,deliverfolder))</div>
<div class="line"><a id="l01233" name="l01233"></a><span class="lineno"><a class="line" href="namespace_u_s_topo_search__prod.html#ac9e11a55461f702496081598ea81c3dd"> 1233</a></span>            myZipFile = zipfile.ZipFile(os.path.join(scratch,OrderNumText+<span class="stringliteral">&quot;_US_Topo.zip&quot;</span>),<span class="stringliteral">&quot;w&quot;</span>)</div>
<div class="line"><a id="l01234" name="l01234"></a><span class="lineno"> 1234</span>            <a class="code hl_function" href="namespace_u_s_topo_search__prod.html#a6606cbc50b96adcf15588a7e3f29b812">zipdir</a>(os.path.join(scratch,deliverfolder),myZipFile)</div>
<div class="line"><a id="l01235" name="l01235"></a><span class="lineno"> 1235</span>            myZipFile.close()</div>
<div class="line"><a id="l01236" name="l01236"></a><span class="lineno"> 1236</span> </div>
<div class="line"><a id="l01237" name="l01237"></a><span class="lineno"><a class="line" href="namespace_u_s_topo_search__prod.html#a46f27485277ae48be1ebbbc5ca1c6dc0"> 1237</a></span>        needViewer = <span class="stringliteral">&#39;N&#39;</span></div>
<div class="line"><a id="l01238" name="l01238"></a><span class="lineno"> 1238</span>        <span class="comment"># check if need to copy data for Topo viewer</span></div>
<div class="line"><a id="l01239" name="l01239"></a><span class="lineno"> 1239</span>        <span class="keywordflow">try</span>:</div>
<div class="line"><a id="l01240" name="l01240"></a><span class="lineno"> 1240</span>            con = cx_Oracle.connect(connectionString)</div>
<div class="line"><a id="l01241" name="l01241"></a><span class="lineno"> 1241</span>            cur = con.cursor()</div>
<div class="line"><a id="l01242" name="l01242"></a><span class="lineno"> 1242</span> </div>
<div class="line"><a id="l01243" name="l01243"></a><span class="lineno"> 1243</span>            cur.execute(<span class="stringliteral">&quot;select topo_viewer from order_viewer where order_id =&quot;</span> + str(OrderIDText))</div>
<div class="line"><a id="l01244" name="l01244"></a><span class="lineno"> 1244</span>            t = cur.fetchone()</div>
<div class="line"><a id="l01245" name="l01245"></a><span class="lineno"> 1245</span>            <span class="keywordflow">if</span> t != <span class="keywordtype">None</span>:</div>
<div class="line"><a id="l01246" name="l01246"></a><span class="lineno"> 1246</span>                needViewer = t[0]</div>
<div class="line"><a id="l01247" name="l01247"></a><span class="lineno"> 1247</span> </div>
<div class="line"><a id="l01248" name="l01248"></a><span class="lineno"> 1248</span>        <span class="keywordflow">finally</span>:</div>
<div class="line"><a id="l01249" name="l01249"></a><span class="lineno"> 1249</span>            cur.close()</div>
<div class="line"><a id="l01250" name="l01250"></a><span class="lineno"> 1250</span>            con.close()</div>
<div class="line"><a id="l01251" name="l01251"></a><span class="lineno"> 1251</span> </div>
<div class="line"><a id="l01252" name="l01252"></a><span class="lineno"> 1252</span>        <span class="keywordflow">if</span> needViewer == <span class="stringliteral">&#39;Y&#39;</span>:</div>
<div class="line"><a id="l01253" name="l01253"></a><span class="lineno"><a class="line" href="namespace_u_s_topo_search__prod.html#a9e8fb4a5a5492899e46593554f966593"> 1253</a></span>            metadata = []</div>
<div class="line"><a id="l01254" name="l01254"></a><span class="lineno"><a class="line" href="namespace_u_s_topo_search__prod.html#a836a5d10fcb51b74820b479d0fd8fc1f"> 1254</a></span>            srGoogle = arcpy.SpatialReference(3857)   <span class="comment"># web mercator</span></div>
<div class="line"><a id="l01255" name="l01255"></a><span class="lineno"> 1255</span>            arcpy.AddMessage(<span class="stringliteral">&quot;Viewer is needed. Need to copy data to obi002&quot;</span>)</div>
<div class="line"><a id="l01256" name="l01256"></a><span class="lineno"><a class="line" href="namespace_u_s_topo_search__prod.html#aee493b23db66a9710d7e4b00f089474f"> 1256</a></span>            viewerdir = os.path.join(scratch,OrderNumText+<span class="stringliteral">&#39;_topo&#39;</span>)</div>
<div class="line"><a id="l01257" name="l01257"></a><span class="lineno"> 1257</span>            <span class="keywordflow">if</span> <span class="keywordflow">not</span> os.path.exists(viewerdir):</div>
<div class="line"><a id="l01258" name="l01258"></a><span class="lineno"> 1258</span>                os.mkdir(viewerdir)</div>
<div class="line"><a id="l01259" name="l01259"></a><span class="lineno"><a class="line" href="namespace_u_s_topo_search__prod.html#a3fa05e0285e1f5ab480bd0f9cc5bc39d"> 1259</a></span>            tempdir = os.path.join(scratch,<span class="stringliteral">&#39;viewertemp&#39;</span>)</div>
<div class="line"><a id="l01260" name="l01260"></a><span class="lineno"> 1260</span>            <span class="keywordflow">if</span> <span class="keywordflow">not</span> os.path.exists(tempdir):</div>
<div class="line"><a id="l01261" name="l01261"></a><span class="lineno"> 1261</span>                os.mkdir(tempdir)</div>
<div class="line"><a id="l01262" name="l01262"></a><span class="lineno"> 1262</span>            <span class="comment"># need to reorganize deliver directory</span></div>
<div class="line"><a id="l01263" name="l01263"></a><span class="lineno"> 1263</span> </div>
<div class="line"><a id="l01264" name="l01264"></a><span class="lineno"><a class="line" href="namespace_u_s_topo_search__prod.html#a0dd0297ff40d0d1c779969b7fabcf3b1"> 1264</a></span>            dirs = filter(os.path.isdir, glob.glob(os.path.join(scratch,deliverfolder)+<span class="stringliteral">&#39;\*_7.5_*&#39;</span>))</div>
<div class="line"><a id="l01265" name="l01265"></a><span class="lineno"> 1265</span>            <span class="keywordflow">if</span> len(dirs) &gt; 0:</div>
<div class="line"><a id="l01266" name="l01266"></a><span class="lineno"> 1266</span>                <span class="keywordflow">if</span> <span class="keywordflow">not</span> os.path.exists(os.path.join(viewerdir,<span class="stringliteral">&quot;75&quot;</span>)):</div>
<div class="line"><a id="l01267" name="l01267"></a><span class="lineno"> 1267</span>                    os.mkdir(os.path.join(viewerdir,<span class="stringliteral">&quot;75&quot;</span>))</div>
<div class="line"><a id="l01268" name="l01268"></a><span class="lineno"> 1268</span>                <span class="comment"># get the extent to use. use one uniform for now</span></div>
<div class="line"><a id="l01269" name="l01269"></a><span class="lineno"><a class="line" href="namespace_u_s_topo_search__prod.html#a745971308d6eeb4b6dc31b845ebb29ba"> 1269</a></span>                year = dirs[0].split(<span class="stringliteral">&#39;_7.5_&#39;</span>)[0][-4:]</div>
<div class="line"><a id="l01270" name="l01270"></a><span class="lineno"><a class="line" href="namespace_u_s_topo_search__prod.html#a85fcf2ce11ceda624d2692891932a22f"> 1270</a></span>                mxdname = <span class="stringliteral">&#39;75_&#39;</span>+year+<span class="stringliteral">&#39;.mxd&#39;</span></div>
<div class="line"><a id="l01271" name="l01271"></a><span class="lineno"><a class="line" href="namespace_u_s_topo_search__prod.html#ac735bf8fccf481bf5157ae8517fd2d09"> 1271</a></span>                mxd = arcpy.mapping.MapDocument(os.path.join(scratch,mxdname))</div>
<div class="line"><a id="l01272" name="l01272"></a><span class="lineno"><a class="line" href="namespace_u_s_topo_search__prod.html#aebc5dcb6db5e101afb0e934bca9288eb"> 1272</a></span>                df = arcpy.mapping.ListDataFrames(mxd,<span class="stringliteral">&quot;*&quot;</span>)[0]    <span class="comment"># the spatial reference here is UTM zone #, need to change to WGS84 Web Mercator</span></div>
<div class="line"><a id="l01273" name="l01273"></a><span class="lineno"><a class="line" href="namespace_u_s_topo_search__prod.html#a9a334379c1df1ab3de0170cd357e72a6"> 1273</a></span>                df.spatialReference = srGoogle</div>
<div class="line"><a id="l01274" name="l01274"></a><span class="lineno"><a class="line" href="namespace_u_s_topo_search__prod.html#a3d60f177aa03d0e7ef3fe3e6d54dde71"> 1274</a></span>                extent = df.extent</div>
<div class="line"><a id="l01275" name="l01275"></a><span class="lineno"> 1275</span> </div>
<div class="line"><a id="l01276" name="l01276"></a><span class="lineno"> 1276</span>                del df, mxd</div>
<div class="line"><a id="l01277" name="l01277"></a><span class="lineno"><a class="line" href="namespace_u_s_topo_search__prod.html#aadf010bda40055410ff07bdbc1070984"> 1277</a></span>                XMAX = extent.XMax</div>
<div class="line"><a id="l01278" name="l01278"></a><span class="lineno"><a class="line" href="namespace_u_s_topo_search__prod.html#af20ff60f51a414b3c43986ec06feb363"> 1278</a></span>                XMIN = extent.XMin</div>
<div class="line"><a id="l01279" name="l01279"></a><span class="lineno"><a class="line" href="namespace_u_s_topo_search__prod.html#a719bec25c7e431d53f43181d0edec9ff"> 1279</a></span>                YMAX = extent.YMax</div>
<div class="line"><a id="l01280" name="l01280"></a><span class="lineno"><a class="line" href="namespace_u_s_topo_search__prod.html#a264fb98b6493e897ec3fd0b80077d9a7"> 1280</a></span>                YMIN = extent.YMin</div>
<div class="line"><a id="l01281" name="l01281"></a><span class="lineno"><a class="line" href="namespace_u_s_topo_search__prod.html#aeca9479169f3fab429c64447190b5e17"> 1281</a></span>                pnt1 = arcpy.Point(XMIN, YMIN)</div>
<div class="line"><a id="l01282" name="l01282"></a><span class="lineno"><a class="line" href="namespace_u_s_topo_search__prod.html#ae1a53856783c7b031f230612c8b4295d"> 1282</a></span>                pnt2 = arcpy.Point(XMIN, YMAX)</div>
<div class="line"><a id="l01283" name="l01283"></a><span class="lineno"><a class="line" href="namespace_u_s_topo_search__prod.html#af035e229ef92acbb72c957455632d85b"> 1283</a></span>                pnt3 = arcpy.Point(XMAX, YMAX)</div>
<div class="line"><a id="l01284" name="l01284"></a><span class="lineno"><a class="line" href="namespace_u_s_topo_search__prod.html#a3a1df25a83875ec97686ae4acbad9951"> 1284</a></span>                pnt4 = arcpy.Point(XMAX, YMIN)</div>
<div class="line"><a id="l01285" name="l01285"></a><span class="lineno"> 1285</span>                array = arcpy.Array()</div>
<div class="line"><a id="l01286" name="l01286"></a><span class="lineno"> 1286</span>                array.add(pnt1)</div>
<div class="line"><a id="l01287" name="l01287"></a><span class="lineno"> 1287</span>                array.add(pnt2)</div>
<div class="line"><a id="l01288" name="l01288"></a><span class="lineno"> 1288</span>                array.add(pnt3)</div>
<div class="line"><a id="l01289" name="l01289"></a><span class="lineno"> 1289</span>                array.add(pnt4)</div>
<div class="line"><a id="l01290" name="l01290"></a><span class="lineno"> 1290</span>                array.add(pnt1)</div>
<div class="line"><a id="l01291" name="l01291"></a><span class="lineno"><a class="line" href="namespace_u_s_topo_search__prod.html#a5b4616f963f613c38f6c6861709fc14f"> 1291</a></span>                polygon = arcpy.Polygon(array)</div>
<div class="line"><a id="l01292" name="l01292"></a><span class="lineno"> 1292</span>                arcpy.CopyFeatures_management(polygon, os.path.join(tempdir, <span class="stringliteral">&quot;Extent75.shp&quot;</span>))</div>
<div class="line"><a id="l01293" name="l01293"></a><span class="lineno"> 1293</span>                arcpy.DefineProjection_management(os.path.join(tempdir, <span class="stringliteral">&quot;Extent75.shp&quot;</span>), srGoogle)</div>
<div class="line"><a id="l01294" name="l01294"></a><span class="lineno"> 1294</span> </div>
<div class="line"><a id="l01295" name="l01295"></a><span class="lineno"> 1295</span>                arcpy.Project_management(os.path.join(tempdir, <span class="stringliteral">&quot;Extent75.shp&quot;</span>), os.path.join(tempdir,<span class="stringliteral">&quot;Extent75_WGS84.shp&quot;</span>), srWGS84)</div>
<div class="line"><a id="l01296" name="l01296"></a><span class="lineno"><a class="line" href="namespace_u_s_topo_search__prod.html#a1fb0f3fafb01c3842ed2c2209916eb82"> 1296</a></span>                desc = arcpy.Describe(os.path.join(tempdir, <span class="stringliteral">&quot;Extent75_WGS84.shp&quot;</span>))</div>
<div class="line"><a id="l01297" name="l01297"></a><span class="lineno"><a class="line" href="namespace_u_s_topo_search__prod.html#a781cec7d971cc607b6bf0c7e8d048e28"> 1297</a></span>                lat_sw = desc.extent.YMin</div>
<div class="line"><a id="l01298" name="l01298"></a><span class="lineno"><a class="line" href="namespace_u_s_topo_search__prod.html#a2afa27cedad032054784b50e1ec78aa2"> 1298</a></span>                long_sw = desc.extent.XMin</div>
<div class="line"><a id="l01299" name="l01299"></a><span class="lineno"><a class="line" href="namespace_u_s_topo_search__prod.html#ac095aa7bf521a17d090e12730a370df4"> 1299</a></span>                lat_ne = desc.extent.YMax</div>
<div class="line"><a id="l01300" name="l01300"></a><span class="lineno"><a class="line" href="namespace_u_s_topo_search__prod.html#a502f885daca7341102f2ce81a63424e9"> 1300</a></span>                long_ne = desc.extent.XMax</div>
<div class="line"><a id="l01301" name="l01301"></a><span class="lineno"> 1301</span>                <span class="comment"># clip_envelope = str(extent75.XMin) + &quot; &quot; + str(extent75.YMin) + &quot; &quot; + str(extent75.XMax) + &quot; &quot; + str(extent75.YMax)</span></div>
<div class="line"><a id="l01302" name="l01302"></a><span class="lineno"> 1302</span>            <span class="comment"># arcpy.env.compression = &quot;JPEG 85&quot;</span></div>
<div class="line"><a id="l01303" name="l01303"></a><span class="lineno"> 1303</span> </div>
<div class="line"><a id="l01304" name="l01304"></a><span class="lineno"><a class="line" href="namespace_u_s_topo_search__prod.html#aaadd510b8f8418394300660b0107bbee"> 1304</a></span>            arcpy.env.outputCoordinateSystem = srGoogle</div>
<div class="line"><a id="l01305" name="l01305"></a><span class="lineno"> 1305</span>            <span class="comment"># arcpy.env.extent = extent</span></div>
<div class="line"><a id="l01306" name="l01306"></a><span class="lineno"> 1306</span>            <span class="keywordflow">if</span> is_aei == <span class="stringliteral">&#39;Y&#39;</span>:</div>
<div class="line"><a id="l01307" name="l01307"></a><span class="lineno"> 1307</span>                <span class="keywordflow">for</span> year <span class="keywordflow">in</span> comb7515.keys():</div>
<div class="line"><a id="l01308" name="l01308"></a><span class="lineno"> 1308</span>                    <span class="keywordflow">if</span> os.path.exists(os.path.join(scratch,<span class="stringliteral">&#39;75_&#39;</span>+str(year)+<span class="stringliteral">&#39;.mxd&#39;</span>)):</div>
<div class="line"><a id="l01309" name="l01309"></a><span class="lineno"> 1309</span>                        mxdname = os.path.join(scratch,<span class="stringliteral">&#39;75_&#39;</span>+str(year)+<span class="stringliteral">&#39;.mxd&#39;</span>)</div>
<div class="line"><a id="l01310" name="l01310"></a><span class="lineno"> 1310</span>                        mxd = arcpy.mapping.MapDocument(mxdname)</div>
<div class="line"><a id="l01311" name="l01311"></a><span class="lineno"> 1311</span>                        df = arcpy.mapping.ListDataFrames(mxd)[0]    <span class="comment"># the spatial reference here is UTM zone #, need to change to WGS84 Web Mercator</span></div>
<div class="line"><a id="l01312" name="l01312"></a><span class="lineno"> 1312</span>                        df.spatialReference = srGoogle</div>
<div class="line"><a id="l01313" name="l01313"></a><span class="lineno"> 1313</span> </div>
<div class="line"><a id="l01314" name="l01314"></a><span class="lineno"> 1314</span>                        <span class="comment"># queryLayer = arcpy.mapping.ListLayers(mxd,&quot;Buffer Outline&quot;,df)[0]</span></div>
<div class="line"><a id="l01315" name="l01315"></a><span class="lineno"> 1315</span>                        <span class="comment"># df.extent = queryLayer.getSelectedExtent(False)</span></div>
<div class="line"><a id="l01316" name="l01316"></a><span class="lineno"> 1316</span> </div>
<div class="line"><a id="l01317" name="l01317"></a><span class="lineno"><a class="line" href="namespace_u_s_topo_search__prod.html#ae1e3cfdffa2f16e2cfba9bd82b0f014e"> 1317</a></span>                        imagename = str(year)+<span class="stringliteral">&quot;.jpg&quot;</span></div>
<div class="line"><a id="l01318" name="l01318"></a><span class="lineno"> 1318</span>                        <span class="comment"># arcpy.mapping.ExportToJPEG(mxd, os.path.join(scratch, viewerdir, imagename), df,df_export_width= 14290,df_export_height=16000, color_mode=&#39;8-BIT_GRAYSCALE&#39;,world_file = True) #by default, the jpeg quality is 100</span></div>
<div class="line"><a id="l01319" name="l01319"></a><span class="lineno"><a class="line" href="namespace_u_s_topo_search__prod.html#a6933f7a79540b7d467a380425bd6b81f"> 1319</a></span>                        arcpy.mapping.ExportToJPEG(mxd, os.path.join(scratch, viewerdir,<span class="stringliteral">&quot;75&quot;</span>, imagename), df,df_export_width= 3573,df_export_height=4000, color_mode=<span class="stringliteral">&#39;24-BIT_TRUE_COLOR&#39;</span>,world_file = <span class="keyword">True</span>, jpeg_quality=50)<span class="comment">#,df_export_width= 14290,df_export_height=16000, color_mode=&#39;8-BIT_GRAYSCALE&#39;,world_file = True, jpeg_quality=100)</span></div>
<div class="line"><a id="l01320" name="l01320"></a><span class="lineno"> 1320</span> </div>
<div class="line"><a id="l01321" name="l01321"></a><span class="lineno"> 1321</span>                        desc = arcpy.Describe(os.path.join(viewerdir,<span class="stringliteral">&quot;75&quot;</span>,imagename))</div>
<div class="line"><a id="l01322" name="l01322"></a><span class="lineno"><a class="line" href="namespace_u_s_topo_search__prod.html#abac98e207a839e785c461ee814f782ca"> 1322</a></span>                        featbound = arcpy.Polygon(arcpy.Array([desc.extent.lowerLeft, desc.extent.lowerRight, desc.extent.upperRight, desc.extent.upperLeft]),</div>
<div class="line"><a id="l01323" name="l01323"></a><span class="lineno"> 1323</span>                                            srGoogle)</div>
<div class="line"><a id="l01324" name="l01324"></a><span class="lineno"> 1324</span>                        del desc</div>
<div class="line"><a id="l01325" name="l01325"></a><span class="lineno"> 1325</span> </div>
<div class="line"><a id="l01326" name="l01326"></a><span class="lineno"><a class="line" href="namespace_u_s_topo_search__prod.html#afc2c4cea71e39f87a36831d87b8bef17"> 1326</a></span>                        tempfeat = os.path.join(tempdir, <span class="stringliteral">&quot;tilebnd_&quot;</span>+str(year)+ <span class="stringliteral">&quot;.shp&quot;</span>)</div>
<div class="line"><a id="l01327" name="l01327"></a><span class="lineno"> 1327</span> </div>
<div class="line"><a id="l01328" name="l01328"></a><span class="lineno"> 1328</span>                        arcpy.Project_management(featbound, tempfeat, srWGS84) <span class="comment">#function requires output not be in_memory</span></div>
<div class="line"><a id="l01329" name="l01329"></a><span class="lineno"> 1329</span>                        del featbound</div>
<div class="line"><a id="l01330" name="l01330"></a><span class="lineno"> 1330</span>                        desc = arcpy.Describe(tempfeat)</div>
<div class="line"><a id="l01331" name="l01331"></a><span class="lineno"> 1331</span> </div>
<div class="line"><a id="l01332" name="l01332"></a><span class="lineno"><a class="line" href="namespace_u_s_topo_search__prod.html#a3f8f72d1d72bac3ea33c50fa7a1e9f4d"> 1332</a></span>                        metaitem = {}</div>
<div class="line"><a id="l01333" name="l01333"></a><span class="lineno"> 1333</span>                        metaitem[<span class="stringliteral">&#39;type&#39;</span>] = <span class="stringliteral">&#39;topo75&#39;</span></div>
<div class="line"><a id="l01334" name="l01334"></a><span class="lineno"> 1334</span>                        metaitem[<span class="stringliteral">&#39;imagename&#39;</span>] = imagename[:-4]+<span class="stringliteral">&#39;.jpg&#39;</span></div>
<div class="line"><a id="l01335" name="l01335"></a><span class="lineno"> 1335</span>                        metaitem[<span class="stringliteral">&#39;lat_sw&#39;</span>] = desc.extent.YMin</div>
<div class="line"><a id="l01336" name="l01336"></a><span class="lineno"> 1336</span>                        metaitem[<span class="stringliteral">&#39;long_sw&#39;</span>] = desc.extent.XMin</div>
<div class="line"><a id="l01337" name="l01337"></a><span class="lineno"> 1337</span>                        metaitem[<span class="stringliteral">&#39;lat_ne&#39;</span>] = desc.extent.YMax</div>
<div class="line"><a id="l01338" name="l01338"></a><span class="lineno"> 1338</span>                        metaitem[<span class="stringliteral">&#39;long_ne&#39;</span>] = desc.extent.XMax</div>
<div class="line"><a id="l01339" name="l01339"></a><span class="lineno"> 1339</span> </div>
<div class="line"><a id="l01340" name="l01340"></a><span class="lineno"> 1340</span>                        metadata.append(metaitem)</div>
<div class="line"><a id="l01341" name="l01341"></a><span class="lineno"> 1341</span>                        del mxd, df</div>
<div class="line"><a id="l01342" name="l01342"></a><span class="lineno"> 1342</span>                    <span class="keywordflow">elif</span> os.path.exists(os.path.join(scratch,<span class="stringliteral">&#39;15_&#39;</span>+str(year)+<span class="stringliteral">&#39;.mxd&#39;</span>)):</div>
<div class="line"><a id="l01343" name="l01343"></a><span class="lineno"> 1343</span>                        <span class="keywordflow">if</span> <span class="keywordflow">not</span> os.path.exists(os.path.join(viewerdir,<span class="stringliteral">&quot;150&quot;</span>)):</div>
<div class="line"><a id="l01344" name="l01344"></a><span class="lineno"> 1344</span>                            os.mkdir(os.path.join(viewerdir,<span class="stringliteral">&quot;150&quot;</span>))</div>
<div class="line"><a id="l01345" name="l01345"></a><span class="lineno"> 1345</span>                        mxdname = os.path.join(scratch,<span class="stringliteral">&#39;15_&#39;</span>+str(year)+<span class="stringliteral">&#39;.mxd&#39;</span>)</div>
<div class="line"><a id="l01346" name="l01346"></a><span class="lineno"> 1346</span>                        mxd = arcpy.mapping.MapDocument(mxdname)</div>
<div class="line"><a id="l01347" name="l01347"></a><span class="lineno"> 1347</span>                        df = arcpy.mapping.ListDataFrames(mxd)[0]    <span class="comment"># the spatial reference here is UTM zone #, need to change to WGS84 Web Mercator</span></div>
<div class="line"><a id="l01348" name="l01348"></a><span class="lineno"> 1348</span>                        df.spatialReference = srGoogle</div>
<div class="line"><a id="l01349" name="l01349"></a><span class="lineno"> 1349</span> </div>
<div class="line"><a id="l01350" name="l01350"></a><span class="lineno"> 1350</span>                        imagename = str(year)+<span class="stringliteral">&quot;.jpg&quot;</span></div>
<div class="line"><a id="l01351" name="l01351"></a><span class="lineno"> 1351</span>                        <span class="comment"># arcpy.mapping.ExportToJPEG(mxd, os.path.join(scratch, viewerdir, imagename), df,df_export_width= 14290,df_export_height=16000, color_mode=&#39;8-BIT_GRAYSCALE&#39;,world_file = True) #by default, the jpeg quality is 100</span></div>
<div class="line"><a id="l01352" name="l01352"></a><span class="lineno"> 1352</span>                        arcpy.mapping.ExportToJPEG(mxd, os.path.join(scratch, viewerdir,<span class="stringliteral">&quot;150&quot;</span>, imagename), df,df_export_width= 3573,df_export_height=4000, color_mode=<span class="stringliteral">&#39;24-BIT_TRUE_COLOR&#39;</span>,world_file = <span class="keyword">True</span>, jpeg_quality=50)<span class="comment">#,df_export_width= 14290,df_export_height=16000, color_mode=&#39;8-BIT_GRAYSCALE&#39;,world_file = True, jpeg_quality=100)</span></div>
<div class="line"><a id="l01353" name="l01353"></a><span class="lineno"> 1353</span> </div>
<div class="line"><a id="l01354" name="l01354"></a><span class="lineno"> 1354</span>                        desc = arcpy.Describe(os.path.join(viewerdir,<span class="stringliteral">&quot;150&quot;</span>,imagename))</div>
<div class="line"><a id="l01355" name="l01355"></a><span class="lineno"> 1355</span>                        featbound = arcpy.Polygon(arcpy.Array([desc.extent.lowerLeft, desc.extent.lowerRight, desc.extent.upperRight, desc.extent.upperLeft]),srGoogle)</div>
<div class="line"><a id="l01356" name="l01356"></a><span class="lineno"> 1356</span>                        del desc</div>
<div class="line"><a id="l01357" name="l01357"></a><span class="lineno"> 1357</span> </div>
<div class="line"><a id="l01358" name="l01358"></a><span class="lineno"> 1358</span>                        tempfeat = os.path.join(tempdir, <span class="stringliteral">&quot;tilebnd_&quot;</span>+str(year)+ <span class="stringliteral">&quot;.shp&quot;</span>)</div>
<div class="line"><a id="l01359" name="l01359"></a><span class="lineno"> 1359</span> </div>
<div class="line"><a id="l01360" name="l01360"></a><span class="lineno"> 1360</span>                        arcpy.Project_management(featbound, tempfeat, srWGS84) <span class="comment">#function requires output not be in_memory</span></div>
<div class="line"><a id="l01361" name="l01361"></a><span class="lineno"> 1361</span>                        del featbound</div>
<div class="line"><a id="l01362" name="l01362"></a><span class="lineno"> 1362</span>                        desc = arcpy.Describe(tempfeat)</div>
<div class="line"><a id="l01363" name="l01363"></a><span class="lineno"> 1363</span> </div>
<div class="line"><a id="l01364" name="l01364"></a><span class="lineno"> 1364</span>                        metaitem = {}</div>
<div class="line"><a id="l01365" name="l01365"></a><span class="lineno"> 1365</span>                        metaitem[<span class="stringliteral">&#39;type&#39;</span>] = <span class="stringliteral">&#39;topo150&#39;</span></div>
<div class="line"><a id="l01366" name="l01366"></a><span class="lineno"> 1366</span>                        metaitem[<span class="stringliteral">&#39;imagename&#39;</span>] = imagename[:-4]+<span class="stringliteral">&#39;.jpg&#39;</span></div>
<div class="line"><a id="l01367" name="l01367"></a><span class="lineno"> 1367</span>                        metaitem[<span class="stringliteral">&#39;lat_sw&#39;</span>] = desc.extent.YMin</div>
<div class="line"><a id="l01368" name="l01368"></a><span class="lineno"> 1368</span>                        metaitem[<span class="stringliteral">&#39;long_sw&#39;</span>] = desc.extent.XMin</div>
<div class="line"><a id="l01369" name="l01369"></a><span class="lineno"> 1369</span>                        metaitem[<span class="stringliteral">&#39;lat_ne&#39;</span>] = desc.extent.YMax</div>
<div class="line"><a id="l01370" name="l01370"></a><span class="lineno"> 1370</span>                        metaitem[<span class="stringliteral">&#39;long_ne&#39;</span>] = desc.extent.XMax</div>
<div class="line"><a id="l01371" name="l01371"></a><span class="lineno"> 1371</span> </div>
<div class="line"><a id="l01372" name="l01372"></a><span class="lineno"> 1372</span>                        metadata.append(metaitem)</div>
<div class="line"><a id="l01373" name="l01373"></a><span class="lineno"> 1373</span>                        del mxd, df</div>
<div class="line"><a id="l01374" name="l01374"></a><span class="lineno"> 1374</span>                    arcpy.env.outputCoordinateSystem = <span class="keywordtype">None</span></div>
<div class="line"><a id="l01375" name="l01375"></a><span class="lineno"> 1375</span> </div>
<div class="line"><a id="l01376" name="l01376"></a><span class="lineno"> 1376</span>            <span class="keywordflow">else</span>:</div>
<div class="line"><a id="l01377" name="l01377"></a><span class="lineno"> 1377</span>                <span class="keywordflow">for</span> year <span class="keywordflow">in</span> dict7575.keys():</div>
<div class="line"><a id="l01378" name="l01378"></a><span class="lineno"> 1378</span>                    print(year)</div>
<div class="line"><a id="l01379" name="l01379"></a><span class="lineno"> 1379</span>                    mxdname = glob.glob(os.path.join(scratch,<span class="stringliteral">&#39;75_&#39;</span>+str(year)+<span class="stringliteral">&#39;.mxd&#39;</span>))[0]</div>
<div class="line"><a id="l01380" name="l01380"></a><span class="lineno"> 1380</span>                    mxd = arcpy.mapping.MapDocument(mxdname)</div>
<div class="line"><a id="l01381" name="l01381"></a><span class="lineno"> 1381</span>                    df = arcpy.mapping.ListDataFrames(mxd)[0]    <span class="comment"># the spatial reference here is UTM zone #, need to change to WGS84 Web Mercator</span></div>
<div class="line"><a id="l01382" name="l01382"></a><span class="lineno"> 1382</span>                    df.spatialReference = srGoogle</div>
<div class="line"><a id="l01383" name="l01383"></a><span class="lineno"> 1383</span> </div>
<div class="line"><a id="l01384" name="l01384"></a><span class="lineno"> 1384</span>                    <span class="comment"># queryLayer = arcpy.mapping.ListLayers(mxd,&quot;Buffer Outline&quot;,df)[0]</span></div>
<div class="line"><a id="l01385" name="l01385"></a><span class="lineno"> 1385</span>                    <span class="comment"># df.extent = queryLayer.getSelectedExtent(False)</span></div>
<div class="line"><a id="l01386" name="l01386"></a><span class="lineno"> 1386</span> </div>
<div class="line"><a id="l01387" name="l01387"></a><span class="lineno"> 1387</span>                    imagename = str(year)+<span class="stringliteral">&quot;.jpg&quot;</span></div>
<div class="line"><a id="l01388" name="l01388"></a><span class="lineno"> 1388</span>                    <span class="comment"># arcpy.mapping.ExportToJPEG(mxd, os.path.join(scratch, viewerdir, imagename), df,df_export_width= 14290,df_export_height=16000, color_mode=&#39;8-BIT_GRAYSCALE&#39;,world_file = True) #by default, the jpeg quality is 100</span></div>
<div class="line"><a id="l01389" name="l01389"></a><span class="lineno"> 1389</span>                    arcpy.mapping.ExportToJPEG(mxd, os.path.join(scratch, viewerdir,<span class="stringliteral">&quot;75&quot;</span>, imagename), df,df_export_width= 3573,df_export_height=4000, color_mode=<span class="stringliteral">&#39;24-BIT_TRUE_COLOR&#39;</span>,world_file = <span class="keyword">True</span>, jpeg_quality=50)<span class="comment">#,df_export_width= 14290,df_export_height=16000, color_mode=&#39;8-BIT_GRAYSCALE&#39;,world_file = True, jpeg_quality=100)</span></div>
<div class="line"><a id="l01390" name="l01390"></a><span class="lineno"> 1390</span> </div>
<div class="line"><a id="l01391" name="l01391"></a><span class="lineno"> 1391</span>                    desc = arcpy.Describe(os.path.join(viewerdir,<span class="stringliteral">&quot;75&quot;</span>,imagename))</div>
<div class="line"><a id="l01392" name="l01392"></a><span class="lineno"> 1392</span>                    featbound = arcpy.Polygon(arcpy.Array([desc.extent.lowerLeft, desc.extent.lowerRight, desc.extent.upperRight, desc.extent.upperLeft]),</div>
<div class="line"><a id="l01393" name="l01393"></a><span class="lineno"> 1393</span>                                        srGoogle)</div>
<div class="line"><a id="l01394" name="l01394"></a><span class="lineno"> 1394</span>                    del desc</div>
<div class="line"><a id="l01395" name="l01395"></a><span class="lineno"> 1395</span> </div>
<div class="line"><a id="l01396" name="l01396"></a><span class="lineno"> 1396</span>                    tempfeat = os.path.join(tempdir, <span class="stringliteral">&quot;tilebnd_&quot;</span>+str(year)+ <span class="stringliteral">&quot;.shp&quot;</span>)</div>
<div class="line"><a id="l01397" name="l01397"></a><span class="lineno"> 1397</span> </div>
<div class="line"><a id="l01398" name="l01398"></a><span class="lineno"> 1398</span>                    arcpy.Project_management(featbound, tempfeat, srWGS84) <span class="comment">#function requires output not be in_memory</span></div>
<div class="line"><a id="l01399" name="l01399"></a><span class="lineno"> 1399</span>                    del featbound</div>
<div class="line"><a id="l01400" name="l01400"></a><span class="lineno"> 1400</span>                    desc = arcpy.Describe(tempfeat)</div>
<div class="line"><a id="l01401" name="l01401"></a><span class="lineno"> 1401</span> </div>
<div class="line"><a id="l01402" name="l01402"></a><span class="lineno"> 1402</span>                    metaitem = {}</div>
<div class="line"><a id="l01403" name="l01403"></a><span class="lineno"> 1403</span>                    metaitem[<span class="stringliteral">&#39;type&#39;</span>] = <span class="stringliteral">&#39;topo75&#39;</span></div>
<div class="line"><a id="l01404" name="l01404"></a><span class="lineno"> 1404</span>                    metaitem[<span class="stringliteral">&#39;imagename&#39;</span>] = imagename[:-4]+<span class="stringliteral">&#39;.jpg&#39;</span></div>
<div class="line"><a id="l01405" name="l01405"></a><span class="lineno"> 1405</span>                    metaitem[<span class="stringliteral">&#39;lat_sw&#39;</span>] = desc.extent.YMin</div>
<div class="line"><a id="l01406" name="l01406"></a><span class="lineno"> 1406</span>                    metaitem[<span class="stringliteral">&#39;long_sw&#39;</span>] = desc.extent.XMin</div>
<div class="line"><a id="l01407" name="l01407"></a><span class="lineno"> 1407</span>                    metaitem[<span class="stringliteral">&#39;lat_ne&#39;</span>] = desc.extent.YMax</div>
<div class="line"><a id="l01408" name="l01408"></a><span class="lineno"> 1408</span>                    metaitem[<span class="stringliteral">&#39;long_ne&#39;</span>] = desc.extent.XMax</div>
<div class="line"><a id="l01409" name="l01409"></a><span class="lineno"> 1409</span> </div>
<div class="line"><a id="l01410" name="l01410"></a><span class="lineno"> 1410</span>                    metadata.append(metaitem)</div>
<div class="line"><a id="l01411" name="l01411"></a><span class="lineno"> 1411</span>                    del mxd, df</div>
<div class="line"><a id="l01412" name="l01412"></a><span class="lineno"> 1412</span>                arcpy.env.outputCoordinateSystem = <span class="keywordtype">None</span></div>
<div class="line"><a id="l01413" name="l01413"></a><span class="lineno"> 1413</span> </div>
<div class="line"><a id="l01414" name="l01414"></a><span class="lineno"> 1414</span>                <span class="keywordflow">for</span> year <span class="keywordflow">in</span> dict1515.keys():</div>
<div class="line"><a id="l01415" name="l01415"></a><span class="lineno"> 1415</span>                    <span class="keywordflow">if</span> <span class="keywordflow">not</span> os.path.exists(os.path.join(viewerdir,<span class="stringliteral">&quot;150&quot;</span>)):</div>
<div class="line"><a id="l01416" name="l01416"></a><span class="lineno"> 1416</span>                        os.mkdir(os.path.join(viewerdir,<span class="stringliteral">&quot;150&quot;</span>))</div>
<div class="line"><a id="l01417" name="l01417"></a><span class="lineno"> 1417</span>                    mxdname = glob.glob(os.path.join(scratch,<span class="stringliteral">&#39;15_&#39;</span>+str(year)+<span class="stringliteral">&#39;.mxd&#39;</span>))[0]</div>
<div class="line"><a id="l01418" name="l01418"></a><span class="lineno"> 1418</span>                    mxd = arcpy.mapping.MapDocument(mxdname)</div>
<div class="line"><a id="l01419" name="l01419"></a><span class="lineno"> 1419</span>                    df = arcpy.mapping.ListDataFrames(mxd)[0]    <span class="comment"># the spatial reference here is UTM zone #, need to change to WGS84 Web Mercator</span></div>
<div class="line"><a id="l01420" name="l01420"></a><span class="lineno"> 1420</span>                    df.spatialReference = srGoogle</div>
<div class="line"><a id="l01421" name="l01421"></a><span class="lineno"> 1421</span> </div>
<div class="line"><a id="l01422" name="l01422"></a><span class="lineno"> 1422</span>                    imagename = str(year)+<span class="stringliteral">&quot;.jpg&quot;</span></div>
<div class="line"><a id="l01423" name="l01423"></a><span class="lineno"> 1423</span>                    <span class="comment"># arcpy.mapping.ExportToJPEG(mxd, os.path.join(scratch, viewerdir, imagename), df,df_export_width= 14290,df_export_height=16000, color_mode=&#39;8-BIT_GRAYSCALE&#39;,world_file = True) #by default, the jpeg quality is 100</span></div>
<div class="line"><a id="l01424" name="l01424"></a><span class="lineno"> 1424</span>                    arcpy.mapping.ExportToJPEG(mxd, os.path.join(scratch, viewerdir,<span class="stringliteral">&quot;150&quot;</span>, imagename), df,df_export_width= 3573,df_export_height=4000, color_mode=<span class="stringliteral">&#39;24-BIT_TRUE_COLOR&#39;</span>,world_file = <span class="keyword">True</span>, jpeg_quality=50)<span class="comment">#,df_export_width= 14290,df_export_height=16000, color_mode=&#39;8-BIT_GRAYSCALE&#39;,world_file = True, jpeg_quality=100)</span></div>
<div class="line"><a id="l01425" name="l01425"></a><span class="lineno"> 1425</span> </div>
<div class="line"><a id="l01426" name="l01426"></a><span class="lineno"> 1426</span>                    desc = arcpy.Describe(os.path.join(viewerdir,<span class="stringliteral">&quot;150&quot;</span>,imagename))</div>
<div class="line"><a id="l01427" name="l01427"></a><span class="lineno"> 1427</span>                    featbound = arcpy.Polygon(arcpy.Array([desc.extent.lowerLeft, desc.extent.lowerRight, desc.extent.upperRight, desc.extent.upperLeft]),srGoogle)</div>
<div class="line"><a id="l01428" name="l01428"></a><span class="lineno"> 1428</span>                    del desc</div>
<div class="line"><a id="l01429" name="l01429"></a><span class="lineno"> 1429</span> </div>
<div class="line"><a id="l01430" name="l01430"></a><span class="lineno"> 1430</span>                    tempfeat = os.path.join(tempdir, <span class="stringliteral">&quot;tilebnd_&quot;</span>+str(year)+ <span class="stringliteral">&quot;.shp&quot;</span>)</div>
<div class="line"><a id="l01431" name="l01431"></a><span class="lineno"> 1431</span> </div>
<div class="line"><a id="l01432" name="l01432"></a><span class="lineno"> 1432</span>                    arcpy.Project_management(featbound, tempfeat, srWGS84) <span class="comment">#function requires output not be in_memory</span></div>
<div class="line"><a id="l01433" name="l01433"></a><span class="lineno"> 1433</span>                    del featbound</div>
<div class="line"><a id="l01434" name="l01434"></a><span class="lineno"> 1434</span>                    desc = arcpy.Describe(tempfeat)</div>
<div class="line"><a id="l01435" name="l01435"></a><span class="lineno"> 1435</span> </div>
<div class="line"><a id="l01436" name="l01436"></a><span class="lineno"> 1436</span>                    metaitem = {}</div>
<div class="line"><a id="l01437" name="l01437"></a><span class="lineno"> 1437</span>                    metaitem[<span class="stringliteral">&#39;type&#39;</span>] = <span class="stringliteral">&#39;topo150&#39;</span></div>
<div class="line"><a id="l01438" name="l01438"></a><span class="lineno"> 1438</span>                    metaitem[<span class="stringliteral">&#39;imagename&#39;</span>] = imagename[:-4]+<span class="stringliteral">&#39;.jpg&#39;</span></div>
<div class="line"><a id="l01439" name="l01439"></a><span class="lineno"> 1439</span>                    metaitem[<span class="stringliteral">&#39;lat_sw&#39;</span>] = desc.extent.YMin</div>
<div class="line"><a id="l01440" name="l01440"></a><span class="lineno"> 1440</span>                    metaitem[<span class="stringliteral">&#39;long_sw&#39;</span>] = desc.extent.XMin</div>
<div class="line"><a id="l01441" name="l01441"></a><span class="lineno"> 1441</span>                    metaitem[<span class="stringliteral">&#39;lat_ne&#39;</span>] = desc.extent.YMax</div>
<div class="line"><a id="l01442" name="l01442"></a><span class="lineno"> 1442</span>                    metaitem[<span class="stringliteral">&#39;long_ne&#39;</span>] = desc.extent.XMax</div>
<div class="line"><a id="l01443" name="l01443"></a><span class="lineno"> 1443</span> </div>
<div class="line"><a id="l01444" name="l01444"></a><span class="lineno"> 1444</span>                    metadata.append(metaitem)</div>
<div class="line"><a id="l01445" name="l01445"></a><span class="lineno"> 1445</span>                    del mxd, df</div>
<div class="line"><a id="l01446" name="l01446"></a><span class="lineno"> 1446</span>                arcpy.env.outputCoordinateSystem = <span class="keywordtype">None</span></div>
<div class="line"><a id="l01447" name="l01447"></a><span class="lineno"> 1447</span> </div>
<div class="line"><a id="l01448" name="l01448"></a><span class="lineno"> 1448</span>            <span class="keywordflow">if</span> os.path.exists(os.path.join(viewerFolder, OrderNumText+<span class="stringliteral">&quot;_topo&quot;</span>)):</div>
<div class="line"><a id="l01449" name="l01449"></a><span class="lineno"> 1449</span>                shutil.rmtree(os.path.join(viewerFolder, OrderNumText+<span class="stringliteral">&quot;_topo&quot;</span>))</div>
<div class="line"><a id="l01450" name="l01450"></a><span class="lineno"> 1450</span>            shutil.copytree(os.path.join(scratch, OrderNumText+<span class="stringliteral">&quot;_topo&quot;</span>), os.path.join(viewerFolder, OrderNumText+<span class="stringliteral">&quot;_topo&quot;</span>))</div>
<div class="line"><a id="l01451" name="l01451"></a><span class="lineno"><a class="line" href="namespace_u_s_topo_search__prod.html#a74d1660a4209770c5531e60bfa1a6f14"> 1451</a></span>            url = topouploadurl + OrderNumText</div>
<div class="line"><a id="l01452" name="l01452"></a><span class="lineno"><a class="line" href="namespace_u_s_topo_search__prod.html#acaf48ba983d0eb0f490cf7dc7fdfdb68"> 1452</a></span>            response = urllib.urlopen(url)</div>
<div class="line"><a id="l01453" name="l01453"></a><span class="lineno"><a class="line" href="namespace_u_s_topo_search__prod.html#afde88be4e7f63a2b16516daff16f6418"> 1453</a></span>            response_json = json.loads(response.read())</div>
<div class="line"><a id="l01454" name="l01454"></a><span class="lineno"> 1454</span>            <span class="keywordflow">if</span> response_json[<span class="stringliteral">&#39;TopoUploadResult&#39;</span>] == <span class="stringliteral">&#39;OK&#39;</span>:</div>
<div class="line"><a id="l01455" name="l01455"></a><span class="lineno"> 1455</span>                arcpy.AddMessage(<span class="stringliteral">&#39;xplorer upload: &#39;</span>+ str(response_json[<span class="stringliteral">&#39;TopoUploadResult&#39;</span>]))</div>
<div class="line"><a id="l01456" name="l01456"></a><span class="lineno"> 1456</span>            <span class="keywordflow">else</span>:</div>
<div class="line"><a id="l01457" name="l01457"></a><span class="lineno"> 1457</span>                arcpy.AddError(<span class="stringliteral">&#39;xplorer upload: &#39;</span>+ str(response_json[<span class="stringliteral">&#39;TopoUploadResult&#39;</span>])+ <span class="stringliteral">&#39; &#39;</span>+OrderNumText)</div>
<div class="line"><a id="l01458" name="l01458"></a><span class="lineno"> 1458</span>            <span class="keywordflow">try</span>:</div>
<div class="line"><a id="l01459" name="l01459"></a><span class="lineno"> 1459</span>                con = cx_Oracle.connect(connectionString)</div>
<div class="line"><a id="l01460" name="l01460"></a><span class="lineno"> 1460</span>                cur = con.cursor()</div>
<div class="line"><a id="l01461" name="l01461"></a><span class="lineno"> 1461</span>                </div>
<div class="line"><a id="l01462" name="l01462"></a><span class="lineno"> 1462</span>                cur.callfunc(<span class="stringliteral">&#39;eris_gis.populateOverlayImageInfo&#39;</span>, str, (int(OrderIDText),str(metadata)))</div>
<div class="line"><a id="l01463" name="l01463"></a><span class="lineno"> 1463</span>            <span class="keywordflow">finally</span>:</div>
<div class="line"><a id="l01464" name="l01464"></a><span class="lineno"> 1464</span>                cur.close()</div>
<div class="line"><a id="l01465" name="l01465"></a><span class="lineno"> 1465</span>                con.close()</div>
<div class="line"><a id="l01466" name="l01466"></a><span class="lineno"> 1466</span> </div>
<div class="line"><a id="l01467" name="l01467"></a><span class="lineno"> 1467</span> </div>
<div class="line"><a id="l01468" name="l01468"></a><span class="lineno"> 1468</span>        <span class="keywordflow">else</span>:</div>
<div class="line"><a id="l01469" name="l01469"></a><span class="lineno"> 1469</span>            arcpy.AddMessage(<span class="stringliteral">&quot;No viewer is needed. Do nothing&quot;</span>)</div>
<div class="line"><a id="l01470" name="l01470"></a><span class="lineno"> 1470</span> </div>
<div class="line"><a id="l01471" name="l01471"></a><span class="lineno"> 1471</span>        <span class="comment"># see if need to provide the tiffs too</span></div>
<div class="line"><a id="l01472" name="l01472"></a><span class="lineno"> 1472</span>        <span class="keywordflow">if</span> len(copydirs) &gt; 0:</div>
<div class="line"><a id="l01473" name="l01473"></a><span class="lineno"> 1473</span>            <span class="keywordflow">if</span> os.path.exists(os.path.join(reportcheckFolder,<span class="stringliteral">&quot;TopographicMaps&quot;</span>,OrderNumText+<span class="stringliteral">&quot;_US_Topo.zip&quot;</span>)):</div>
<div class="line"><a id="l01474" name="l01474"></a><span class="lineno"> 1474</span>                os.remove(os.path.join(reportcheckFolder,<span class="stringliteral">&quot;TopographicMaps&quot;</span>,OrderNumText+<span class="stringliteral">&quot;_US_Topo.zip&quot;</span>))</div>
<div class="line"><a id="l01475" name="l01475"></a><span class="lineno"> 1475</span>            shutil.copyfile(os.path.join(scratch,OrderNumText+<span class="stringliteral">&quot;_US_Topo.zip&quot;</span>),os.path.join(reportcheckFolder,<span class="stringliteral">&quot;TopographicMaps&quot;</span>,OrderNumText+<span class="stringliteral">&quot;_US_Topo.zip&quot;</span>))</div>
<div class="line"><a id="l01476" name="l01476"></a><span class="lineno"> 1476</span>            arcpy.SetParameterAsText(3, os.path.join(scratch,OrderNumText+<span class="stringliteral">&quot;_US_Topo.zip&quot;</span>))</div>
<div class="line"><a id="l01477" name="l01477"></a><span class="lineno"> 1477</span>        <span class="keywordflow">else</span>:</div>
<div class="line"><a id="l01478" name="l01478"></a><span class="lineno"> 1478</span>            <span class="keywordflow">if</span> os.path.exists(os.path.join(reportcheckFolder,<span class="stringliteral">&quot;TopographicMaps&quot;</span>,pdfreport)):</div>
<div class="line"><a id="l01479" name="l01479"></a><span class="lineno"> 1479</span>                os.remove(os.path.join(reportcheckFolder,<span class="stringliteral">&quot;TopographicMaps&quot;</span>,pdfreport))</div>
<div class="line"><a id="l01480" name="l01480"></a><span class="lineno"> 1480</span>            shutil.copyfile(os.path.join(scratch, pdfreport),os.path.join(reportcheckFolder,<span class="stringliteral">&quot;TopographicMaps&quot;</span>,pdfreport))</div>
<div class="line"><a id="l01481" name="l01481"></a><span class="lineno"> 1481</span>            arcpy.SetParameterAsText(3, os.path.join(scratch,pdfreport))</div>
<div class="line"><a id="l01482" name="l01482"></a><span class="lineno"> 1482</span> </div>
<div class="line"><a id="l01483" name="l01483"></a><span class="lineno"> 1483</span>        <span class="keywordflow">try</span>:</div>
<div class="line"><a id="l01484" name="l01484"></a><span class="lineno"> 1484</span>            con = cx_Oracle.connect(connectionString)</div>
<div class="line"><a id="l01485" name="l01485"></a><span class="lineno"> 1485</span>            cur = con.cursor()</div>
<div class="line"><a id="l01486" name="l01486"></a><span class="lineno"> 1486</span> </div>
<div class="line"><a id="l01487" name="l01487"></a><span class="lineno"> 1487</span>            cur.callproc(<span class="stringliteral">&#39;eris_topo.processTopo&#39;</span>, (int(OrderIDText),))</div>
<div class="line"><a id="l01488" name="l01488"></a><span class="lineno"> 1488</span> </div>
<div class="line"><a id="l01489" name="l01489"></a><span class="lineno"> 1489</span>        <span class="keywordflow">finally</span>:</div>
<div class="line"><a id="l01490" name="l01490"></a><span class="lineno"> 1490</span>            cur.close()</div>
<div class="line"><a id="l01491" name="l01491"></a><span class="lineno"> 1491</span>            con.close()</div>
<div class="line"><a id="l01492" name="l01492"></a><span class="lineno"> 1492</span> </div>
<div class="line"><a id="l01493" name="l01493"></a><span class="lineno"> 1493</span>    logger.removeHandler(handler)</div>
<div class="line"><a id="l01494" name="l01494"></a><span class="lineno"> 1494</span>    handler.close()</div>
<div class="line"><a id="l01495" name="l01495"></a><span class="lineno"> 1495</span> </div>
<div class="line"><a id="l01496" name="l01496"></a><span class="lineno"> 1496</span><span class="keywordflow">except</span>:</div>
<div class="line"><a id="l01497" name="l01497"></a><span class="lineno"> 1497</span>    <span class="comment"># Get the traceback object</span></div>
<div class="line"><a id="l01498" name="l01498"></a><span class="lineno"><a class="line" href="namespace_u_s_topo_search__prod.html#a9e66f8648ef5c014824a70765e440184"> 1498</a></span>    tb = sys.exc_info()[2]</div>
<div class="line"><a id="l01499" name="l01499"></a><span class="lineno"><a class="line" href="namespace_u_s_topo_search__prod.html#ab7d1f979dd71ef891aff3682b7dd2ba8"> 1499</a></span>    tbinfo = traceback.format_tb(tb)[0]</div>
<div class="line"><a id="l01500" name="l01500"></a><span class="lineno"><a class="line" href="namespace_u_s_topo_search__prod.html#a58528f0f697af9e85f42739bb915ca9d"> 1500</a></span>    pymsg = <span class="stringliteral">&quot;Order ID: %s PYTHON ERRORS:\nTraceback info:\n&quot;</span>%OrderIDText + tbinfo + <span class="stringliteral">&quot;\nError Info:\n&quot;</span> + str(sys.exc_info()[1])</div>
<div class="line"><a id="l01501" name="l01501"></a><span class="lineno"> 1501</span>    arcpy.AddError(<span class="stringliteral">&quot;hit CC&#39;s error code in except: &quot;</span>)</div>
<div class="line"><a id="l01502" name="l01502"></a><span class="lineno"> 1502</span>    arcpy.AddError(pymsg)</div>
<div class="line"><a id="l01503" name="l01503"></a><span class="lineno"> 1503</span>    <span class="keywordflow">try</span>:</div>
<div class="line"><a id="l01504" name="l01504"></a><span class="lineno"> 1504</span>        con = cx_Oracle.connect(connectionString)</div>
<div class="line"><a id="l01505" name="l01505"></a><span class="lineno"> 1505</span>        cur = con.cursor()</div>
<div class="line"><a id="l01506" name="l01506"></a><span class="lineno"> 1506</span>        cur.callproc(<span class="stringliteral">&#39;eris_topo.InsertTopoAudit&#39;</span>, (OrderIDText, <span class="stringliteral">&#39;python-Error Handling&#39;</span>,pymsg))</div>
<div class="line"><a id="l01507" name="l01507"></a><span class="lineno"> 1507</span> </div>
<div class="line"><a id="l01508" name="l01508"></a><span class="lineno"> 1508</span>    <span class="keywordflow">finally</span>:</div>
<div class="line"><a id="l01509" name="l01509"></a><span class="lineno"> 1509</span>        cur.close()</div>
<div class="line"><a id="l01510" name="l01510"></a><span class="lineno"> 1510</span>        con.close()</div>
<div class="line"><a id="l01511" name="l01511"></a><span class="lineno"> 1511</span> </div>
<div class="line"><a id="l01512" name="l01512"></a><span class="lineno"> 1512</span>    <span class="keywordflow">raise</span>       <span class="comment"># raise the error again</span></div>
<div class="line"><a id="l01513" name="l01513"></a><span class="lineno"> 1513</span> </div>
<div class="line"><a id="l01514" name="l01514"></a><span class="lineno"> 1514</span>print(reportcheckFolder + <span class="stringliteral">&quot;\\TopographicMaps\\&quot;</span> + str(OrderNumText) + <span class="stringliteral">&quot;_US_Topo.pdf&quot;</span>)</div>
<div class="line"><a id="l01515" name="l01515"></a><span class="lineno"> 1515</span>print(<span class="stringliteral">&quot;DONE!&quot;</span>)</div>
<div class="ttc" id="anamespace_u_s_topo_search__prod_html_a26dc023affb68a675d2fc047155d2331"><div class="ttname"><a href="namespace_u_s_topo_search__prod.html#a26dc023affb68a675d2fc047155d2331">USTopoSearch_prod.createAnnotPdf</a></div><div class="ttdeci">def createAnnotPdf(geom_type, myShapePdf)</div><div class="ttdef"><b>Definition:</b> <a href="_u_s_topo_search__prod_8py_source.html#l00059">USTopoSearch_prod.py:59</a></div></div>
<div class="ttc" id="anamespace_u_s_topo_search__prod_html_a2a4e32a7e190d24140a7b794c29a8b28"><div class="ttname"><a href="namespace_u_s_topo_search__prod.html#a2a4e32a7e190d24140a7b794c29a8b28">USTopoSearch_prod.createPDF</a></div><div class="ttdeci">def createPDF(seriesText, diction, diction_s, outpdfname)</div><div class="ttdef"><b>Definition:</b> <a href="_u_s_topo_search__prod_8py_source.html#l00353">USTopoSearch_prod.py:353</a></div></div>
<div class="ttc" id="anamespace_u_s_topo_search__prod_html_a6606cbc50b96adcf15588a7e3f29b812"><div class="ttname"><a href="namespace_u_s_topo_search__prod.html#a6606cbc50b96adcf15588a7e3f29b812">USTopoSearch_prod.zipdir</a></div><div class="ttdeci">def zipdir(path, zip)</div><div class="ttdef"><b>Definition:</b> <a href="_u_s_topo_search__prod_8py_source.html#l00638">USTopoSearch_prod.py:638</a></div></div>
<div class="ttc" id="anamespace_u_s_topo_search__prod_html_a68bb920bc7c3a8c7520c4a09f83dcc4c"><div class="ttname"><a href="namespace_u_s_topo_search__prod.html#a68bb920bc7c3a8c7520c4a09f83dcc4c">USTopoSearch_prod.countSheets</a></div><div class="ttdeci">def countSheets(mapslist)</div><div class="ttdef"><b>Definition:</b> <a href="_u_s_topo_search__prod_8py_source.html#l00309">USTopoSearch_prod.py:309</a></div></div>
<div class="ttc" id="anamespace_u_s_topo_search__prod_html_a7c2621556ca96c02e4312e2987ec1baa"><div class="ttname"><a href="namespace_u_s_topo_search__prod.html#a7c2621556ca96c02e4312e2987ec1baa">USTopoSearch_prod.myFirstPage</a></div><div class="ttdeci">def myFirstPage(canvas, doc)</div><div class="ttdef"><b>Definition:</b> <a href="_u_s_topo_search__prod_8py_source.html#l00129">USTopoSearch_prod.py:129</a></div></div>
<div class="ttc" id="anamespace_u_s_topo_search__prod_html_a8978d27d7fad9f078b8704e8ce2ca876"><div class="ttname"><a href="namespace_u_s_topo_search__prod.html#a8978d27d7fad9f078b8704e8ce2ca876">USTopoSearch_prod.goCoverPage</a></div><div class="ttdeci">def goCoverPage(coverPdf)</div><div class="ttdef"><b>Definition:</b> <a href="_u_s_topo_search__prod_8py_source.html#l00287">USTopoSearch_prod.py:287</a></div></div>
<div class="ttc" id="anamespace_u_s_topo_search__prod_html_abc9326c792708acd12779af820381b41"><div class="ttname"><a href="namespace_u_s_topo_search__prod.html#abc9326c792708acd12779af820381b41">USTopoSearch_prod.myCoverPage</a></div><div class="ttdeci">def myCoverPage(canvas, doc)</div><div class="ttdef"><b>Definition:</b> <a href="_u_s_topo_search__prod_8py_source.html#l00240">USTopoSearch_prod.py:240</a></div></div>
<div class="ttc" id="anamespace_u_s_topo_search__prod_html_abf2fdbd132aebef3a75b8c5b2e7778c0"><div class="ttname"><a href="namespace_u_s_topo_search__prod.html#abf2fdbd132aebef3a75b8c5b2e7778c0">USTopoSearch_prod.server_loc_config</a></div><div class="ttdeci">def server_loc_config(configpath, environment)</div><div class="ttdef"><b>Definition:</b> <a href="_u_s_topo_search__prod_8py_source.html#l00037">USTopoSearch_prod.py:37</a></div></div>
<div class="ttc" id="anamespace_u_s_topo_search__prod_html_acbb1435522472ef5bb040353ce851352"><div class="ttname"><a href="namespace_u_s_topo_search__prod.html#acbb1435522472ef5bb040353ce851352">USTopoSearch_prod.reorgByYear</a></div><div class="ttdeci">def reorgByYear(mapslist)</div><div class="ttdef"><b>Definition:</b> <a href="_u_s_topo_search__prod_8py_source.html#l00327">USTopoSearch_prod.py:327</a></div></div>
<div class="ttc" id="anamespace_u_s_topo_search__prod_html_ad3a195c7e937aa78014835dfe8448284"><div class="ttname"><a href="namespace_u_s_topo_search__prod.html#ad3a195c7e937aa78014835dfe8448284">USTopoSearch_prod.goSummaryPage</a></div><div class="ttdeci">def goSummaryPage(summaryPdf, data)</div><div class="ttdef"><b>Definition:</b> <a href="_u_s_topo_search__prod_8py_source.html#l00160">USTopoSearch_prod.py:160</a></div></div>
<div class="ttc" id="anamespace_u_s_topo_search__prod_html_af5daa83a32a5322129ee46ab6d259df5"><div class="ttname"><a href="namespace_u_s_topo_search__prod.html#af5daa83a32a5322129ee46ab6d259df5">USTopoSearch_prod.annotatePdf</a></div><div class="ttdeci">def annotatePdf(mapPdf, myAnnotPdf)</div><div class="ttdef"><b>Definition:</b> <a href="_u_s_topo_search__prod_8py_source.html#l00110">USTopoSearch_prod.py:110</a></div></div>
<div class="ttc" id="anamespace_u_s_topo_search__prod_html_af83c368ccf3a3e3bdc0b3b8079045a4b"><div class="ttname"><a href="namespace_u_s_topo_search__prod.html#af83c368ccf3a3e3bdc0b3b8079045a4b">USTopoSearch_prod.dedupMaplist</a></div><div class="ttdeci">def dedupMaplist(mapslist)</div><div class="ttdef"><b>Definition:</b> <a href="_u_s_topo_search__prod_8py_source.html#l00292">USTopoSearch_prod.py:292</a></div></div>
</div><!-- fragment --></div><!-- contents -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="navelem"><a class="el" href="_u_s_topo_search__prod_8py.html">USTopoSearch_prod.py</a></li>
    <li class="footer">Generated by <a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.9.5 </li>
  </ul>
</div>
</body>
</html>
